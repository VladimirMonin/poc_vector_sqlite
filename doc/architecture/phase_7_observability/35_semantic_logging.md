# üìä Semantic Logging Architecture

> Dual-mode logging: Console (INFO+) –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞, File (TRACE) –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤

---

## üìå –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?

**Semantic Logging** ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–ª—è –¥–≤—É—Ö –∞—É–¥–∏—Ç–æ—Ä–∏–π:

- **–ß–µ–ª–æ–≤–µ–∫** (–∫–æ–Ω—Å–æ–ª—å): –∫—Ä–∞—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —ç–º–æ–¥–∑–∏, —É—Ä–æ–≤–µ–Ω—å INFO+
- **AI-–∞–≥–µ–Ω—Ç** (—Ñ–∞–π–ª): –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–º–ø—ã —Å TRACE-—É—Ä–æ–≤–Ω–µ–º –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

---

## üéØ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

**–ü—Ä–æ–±–ª–µ–º–∞**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ª–æ–≥–∏ –Ω–µ –ø–æ–¥—Ö–æ–¥—è—Ç –Ω–∏ —Ç–µ–º, –Ω–∏ –¥—Ä—É–≥–∏–º:

| –ê—É–¥–∏—Ç–æ—Ä–∏—è | –ß—Ç–æ –Ω—É–∂–Ω–æ | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π logging |
|-----------|-----------|---------------------|
| –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ | –ö—Ä–∞—Ç–∫–∏–µ —Å—Ç–∞—Ç—É—Å—ã, —Ü–≤–µ—Ç–∞ | ‚ùå –ú–æ–Ω–æ—Ç–æ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç |
| AI-–∞–≥–µ–Ω—Ç | –ü–æ–ª–Ω—ã–µ –ø–µ–π–ª–æ–∞–¥—ã, –ø—Ä–æ–º–ø—Ç—ã | ‚ùå –û–±—Ä–µ–∑–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è |
| Debug | –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏ | ‚ùå –°–ª–∏—à–∫–æ–º —à—É–º–Ω–æ –∏–ª–∏ —Ç–∏—Ö–æ |

**–†–µ—à–µ–Ω–∏–µ**: –†–∞–∑–¥–µ–ª—å–Ω—ã–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏.

---

## üîç –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü–æ—Ç–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏—è

```mermaid
graph LR
    A[logger.info] --> B[SemanticLogger]
    B --> C{–î–æ–±–∞–≤–ª—è–µ–º}
    C --> D[–ö–æ–Ω—Ç–µ–∫—Å—Ç batch-id]
    C --> E[–≠–º–æ–¥–∑–∏ –º–æ–¥—É–ª—è]
    D --> F[logging.Logger]
    E --> F
    F --> G[SensitiveFilter]
    G --> H[RichHandler Console]
    G --> I[FileHandler –§–∞–π–ª]
```

---

### –î–≤–∞ —Ö–µ–Ω–¥–ª–µ—Ä–∞ ‚Äî –¥–≤–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏

```mermaid
graph TB
    subgraph "–ö–æ–Ω—Å–æ–ª—å INFO+"
        C1[üß† Embedding 512 docs] 
        C2[üíæ Saved to storage]
        C3[üîç Search completed]
    end
    
    subgraph "–§–∞–π–ª TRACE"
        F1["TRACE: payload={'text': '...', 'model': '...'}"]
        F2["TRACE: response_tokens=1542, latency=0.3s"]
        F3["DEBUG: vector_dims=768, norm=1.0"]
    end
```

---

## üìê –£—Ä–æ–≤–µ–Ω—å TRACE

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω —É—Ä–æ–≤–µ–Ω—å –Ω–∏–∂–µ DEBUG?

| –£—Ä–æ–≤–µ–Ω—å | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|------------|
| DEBUG | 10 | "–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç" ‚Äî —à–∞–≥–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ |
| **TRACE** | **5** | "–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏" ‚Äî –¥–∞–º–ø—ã –¥–∞–Ω–Ω—ã—Ö |

**TRACE –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è**:

- –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ –≤ LLM
- –°—ã—Ä–æ–π JSON-–æ—Ç–≤–µ—Ç –æ—Ç API  
- –í–µ–∫—Ç–æ—Ä—ã (–ø–µ—Ä–≤—ã–µ N —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
- –†–∞–∑–º–µ—Ä—ã –±–∞—Ç—á–µ–π, —Ç–æ–∫–µ–Ω—ã

---

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Ä–æ–≤–Ω—è

```mermaid
sequenceDiagram
    participant M as Module
    participant L as logging
    participant Lg as Logger
    
    M->>L: addLevelName(5, "TRACE")
    M->>Lg: –ü–∞—Ç—á–∏–º Logger.trace()
    M->>L: logging.TRACE = 5
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: `logger.trace("payload", data=payload)` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥.

---

## üèóÔ∏è Adapter Pattern

### –ü–æ—á–µ–º—É –Ω–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ?

‚ùå **–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç Logger** ‚Äî —Å–ª–æ–∂–Ω–æ:

- Logger —Å–æ–∑–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ `logging.getLogger()`, –Ω–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
- –ù—É–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å Manager, Factory...
- –õ–æ–º–∞–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏

‚úÖ **Adapter (–æ–±—ë—Ä—Ç–∫–∞)** ‚Äî –ø—Ä–æ—Å—Ç–æ:

- –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Logger
- –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–æ–∏ –º–µ—Ç–æ–¥—ã (`bind()`, `trace_ai()`)
- –î–µ–ª–µ–≥–∏—Ä—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã

---

### –î–∏–∞–≥—Ä–∞–º–º–∞ –∞–¥–∞–ø—Ç–µ—Ä–∞

```mermaid
classDiagram
    class logging.Logger {
        +debug()
        +info()
        +warning()
        +error()
    }
    
    class SemanticLogger {
        -_logger: Logger
        -_context: dict
        +trace()
        +bind()
        +trace_ai()
        +error_with_context()
    }
    
    SemanticLogger --> logging.Logger : delegates
```

---

## üõ°Ô∏è SensitiveFilter

### –ü–æ–∑–∏—Ü–∏—è –≤ pipeline

```mermaid
graph LR
    A[–°–æ–æ–±—â–µ–Ω–∏–µ] --> B[SemanticLogger._log]
    B --> C[logging.Logger.log]
    C --> D[SensitiveFilter.filter]
    D --> E[Handler.emit]
```

**–í–∞–∂–Ω–æ**: Filter –º—É—Ç–∏—Ä—É–µ—Ç `record.msg` –∏ `record.args` **–¥–æ** –ø–µ—Ä–µ–¥–∞—á–∏ –≤ Handler.

---

### –ß—Ç–æ –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è

| –¢–∏–ø –∫–ª—é—á–∞ | –ü–∞—Ç—Ç–µ—Ä–Ω | –ü—Ä–∏–º–µ—Ä |
|-----------|---------|--------|
| Google API | `AIza...` | `AIzaSyD...abc ‚Üí ***REDACTED***` |
| OpenAI | `sk-...` | `sk-proj-abc... ‚Üí ***REDACTED***` |
| Groq | `gsk_...` | `gsk_abc123... ‚Üí ***REDACTED***` |
| Bearer | `bearer ...` | `bearer eyJ... ‚Üí ***REDACTED***` |

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ê—Å–ø–µ–∫—Ç | print() | logging | SemanticLogger |
|--------|---------|---------|----------------|
| –£—Ä–æ–≤–Ω–∏ | ‚ùå –ù–µ—Ç | ‚úÖ 5 —É—Ä–æ–≤–Ω–µ–π | ‚úÖ 6 —É—Ä–æ–≤–Ω–µ–π (TRACE) |
| –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è | ‚ùå –ù–µ—Ç | ‚ö†Ô∏è –ü–æ —É—Ä–æ–≤–Ω—é | ‚úÖ –ü–æ —É—Ä–æ–≤–Ω—é + —Å–µ–∫—Ä–µ—Ç—ã |
| –ö–æ–Ω—Ç–µ–∫—Å—Ç | ‚ùå –í—Ä—É—á–Ω—É—é | ‚ö†Ô∏è extra={} | ‚úÖ bind() –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| –í—ã–≤–æ–¥ | stdout | –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π | Dual: Console + File |
| AI-friendly | ‚ùå | ‚ö†Ô∏è | ‚úÖ TRACE –¥–ª—è –¥–∞–º–ø–æ–≤ |

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### LoggingConfig (Pydantic)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `level` | "INFO" | –£—Ä–æ–≤–µ–Ω—å –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏ |
| `file_level` | "TRACE" | –£—Ä–æ–≤–µ–Ω—å –¥–ª—è —Ñ–∞–π–ª–∞ |
| `log_file` | None | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `redact_secrets` | True | –ú–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å API-–∫–ª—é—á–∏ |
| `console_width` | 120 | –®–∏—Ä–∏–Ω–∞ –∫–æ–Ω—Å–æ–ª–∏ Rich |

---

### –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```mermaid
graph LR
    A[LoggingConfig] --> B[setup_logging]
    B --> C[RichHandler level=INFO]
    B --> D[FileHandler level=TRACE]
    B --> E[SensitiveFilter]
    E --> C
    E --> D
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

### 1. RichHandler –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

‚ùå **RichHandler –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç Formatter.format()**

–û–Ω –≤—ã–∑—ã–≤–∞–µ—Ç `getMessage()` –Ω–∞–ø—Ä—è–º—É—é, –ø–æ—ç—Ç–æ–º—É —ç–º–æ–¥–∑–∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ, –Ω–µ –≤ Formatter.

### 2. markup=False –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ

Rich –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç `[batch-123]` –∫–∞–∫ style tag. –û—Ç–∫–ª—é—á–∞–µ–º:

```
RichHandler(markup=False)
```

### 3. –õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

`get_logger()` –≤—ã–∑—ã–≤–∞–µ—Ç `setup_logging()` —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏. –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ª–æ–≥–≥–µ—Ä.

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **–°–ª–µ–¥—É—é—â–∏–π**: [Visual Semantics in Logs](36_visual_semantics_logs.md) ‚Äî —ç–º–æ–¥–∑–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç**: [Context Propagation](37_context_propagation.md) ‚Äî bind() –∏ –ø—Ä–æ–±—Ä–æ—Å ID
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: [Secret Redaction](38_secret_redaction.md) ‚Äî –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π

---

**[Visual Semantics in Logs](36_visual_semantics_logs.md) ‚Üí**
