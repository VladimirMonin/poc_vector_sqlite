# üëÅÔ∏è Visual Semantics in Logs

> EMOJI_MAP: –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –º–æ–¥—É–ª—è –∏ —É—Ä–æ–≤–Ω—è —á–µ—Ä–µ–∑ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã

---

## üìå –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?

**Visual Semantics** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç–º–æ–¥–∑–∏ –∫–∞–∫ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –º–∞—Ä–∫–µ—Ä–æ–≤ –≤ –ª–æ–≥–∞—Ö:

- üì• = pipeline/ingestion
- üß† = embedder/AI
- üíæ = storage/database
- ‚ùå = error

–ì–ª–∞–∑ –Ω–∞—Ö–æ–¥–∏—Ç –Ω—É–∂–Ω–æ–µ –∑–∞ **0.1 —Å–µ–∫—É–Ω–¥—ã** –≤–º–µ—Å—Ç–æ —á—Ç–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞.

---

## üéØ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

**–ü—Ä–æ–±–ª–µ–º–∞**: –¢–µ–∫—Å—Ç–æ–≤—ã–µ –ª–æ–≥–∏ —Ç—Ä–µ–±—É—é—Ç **—á—Ç–µ–Ω–∏—è**:

```
2024-12-03 10:15:32 INFO semantic_core.pipeline Processing document
2024-12-03 10:15:33 INFO semantic_core.embedder Generated embeddings
2024-12-03 10:15:33 ERROR semantic_core.storage Connection failed
2024-12-03 10:15:34 INFO semantic_core.pipeline Retry initiated
```

–ù—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å "–≥–¥–µ –æ—à–∏–±–∫–∞?".

**–†–µ—à–µ–Ω–∏–µ**: –í–∏–∑—É–∞–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã:

```
üì• Processing document
üß† Generated embeddings  
‚ùå Connection failed
üì• Retry initiated
```

–û—à–∏–±–∫–∞ –≤–∏–¥–Ω–∞ **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** ‚Äî –∫—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫ –≤—ã–¥–µ–ª—è–µ—Ç—Å—è.

---

## üîç EMOJI_MAP

### –ú–∞–ø–ø–∏–Ω–≥ –º–æ–¥—É–ª–µ–π

```mermaid
graph LR
    subgraph "–ü–∞—Ç—Ç–µ—Ä–Ω –≤ __name__"
        P1[pipeline]
        P2[embedder]
        P3[storage]
        P4[search]
        P5[image]
    end
    
    subgraph "–≠–º–æ–¥–∑–∏"
        E1[üì•]
        E2[üß†]
        E3[üíæ]
        E4[üîç]
        E5[üëÅÔ∏è]
    end
    
    P1 --> E1
    P2 --> E2
    P3 --> E3
    P4 --> E4
    P5 --> E5
```

---

### –ü–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ü–∞—Ç—Ç–µ—Ä–Ω | –≠–º–æ–¥–∑–∏ | –°–µ–º–∞–Ω—Ç–∏–∫–∞ |
|---------|--------|-----------|
| `pipeline`, `core` | üì• | Ingestion ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö |
| `parser`, `markdown` | üß∂ | Parsing ‚Äî —Ä–∞–∑–±–æ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã |
| `splitter` | ‚úÇÔ∏è | Splitting ‚Äî –Ω–∞—Ä–µ–∑–∫–∞ –Ω–∞ —á–∞–Ω–∫–∏ |
| `embed`, `gemini` | üß† | AI ‚Äî –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
| `batch`, `queue` | üì¶ | Queue ‚Äî –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á |
| `storage`, `peewee` | üíæ | Storage ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| `search` | üîç | Search ‚Äî –ø–æ–∏—Å–∫ |
| `image`, `vision` | üëÅÔ∏è | Vision ‚Äî –∞–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |
| `audio` | üéôÔ∏è | Audio ‚Äî –∞—É–¥–∏–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ |
| `video` | üé¨ | Video ‚Äî –≤–∏–¥–µ–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ |
| `rate`, `limit` | üõ°Ô∏è | Protection ‚Äî –∑–∞—â–∏—Ç–∞ API |
| *fallback* | üìå | Unknown ‚Äî –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–æ–¥—É–ª—å |

---

## üé≠ LEVEL_EMOJI

### –£—Ä–æ–≤–Ω–∏ –æ—à–∏–±–æ–∫

| –£—Ä–æ–≤–µ–Ω—å | –≠–º–æ–¥–∑–∏ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
|---------|--------|-------------------|
| CRITICAL | üíÄ | –°–∏—Å—Ç–µ–º–∞ –ø–∞–¥–∞–µ—Ç |
| ERROR | ‚ùå | –û–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å |
| WARNING | ‚ö†Ô∏è | –ß—Ç–æ-—Ç–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ |
| DEBUG | üîß | –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ |
| TRACE | üî¨ | –ú–∏–∫—Ä–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: INFO –Ω–µ –∏–º–µ–µ—Ç —Å–≤–æ–µ–≥–æ —ç–º–æ–¥–∑–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —ç–º–æ–¥–∑–∏ –º–æ–¥—É–ª—è.

---

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —ç–º–æ–¥–∑–∏

```mermaid
graph TD
    A[–°–æ–æ–±—â–µ–Ω–∏–µ] --> B{–£—Ä–æ–≤–µ–Ω—å >= WARNING?}
    B -->|–î–∞| C[LEVEL_EMOJI]
    B -->|–ù–µ—Ç| D[MODULE_EMOJI]
    
    C --> E["‚ùå Connection failed"]
    D --> F["üß† Embeddings ready"]
```

**–õ–æ–≥–∏–∫–∞**: –û—à–∏–±–∫–∏ –≤–∞–∂–Ω–µ–µ –º–æ–¥—É–ª—è ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º ‚ùå/‚ö†Ô∏è –≤–º–µ—Å—Ç–æ –º–æ–¥—É–ª—å–Ω–æ–≥–æ —ç–º–æ–¥–∑–∏.

---

## üìê –ê–ª–≥–æ—Ä–∏—Ç–º get_module_emoji()

### –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —ç–º–æ–¥–∑–∏

```mermaid
graph LR
    A["__name__"] --> B["semantic_core.pipeline"]
    B --> C{–°–æ–¥–µ—Ä–∂–∏—Ç 'pipeline'?}
    C -->|–î–∞| D[üì•]
    C -->|–ù–µ—Ç| E{–°–æ–¥–µ—Ä–∂–∏—Ç 'embed'?}
    E -->|–î–∞| F[üß†]
    E -->|–ù–µ—Ç| G{...}
    G --> H[üìå fallback]
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–¥—ë—Ç –ø–æ **–≤—Ö–æ–∂–¥–µ–Ω–∏—é –ø–æ–¥—Å—Ç—Ä–æ–∫–∏**, –Ω–µ –ø–æ —Ç–æ—á–Ω–æ–º—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é:

- `semantic_core.infrastructure.gemini.embedder` ‚Üí —Å–æ–¥–µ—Ä–∂–∏—Ç `embed` ‚Üí üß†
- `semantic_core.processing.parsers.markdown` ‚Üí —Å–æ–¥–µ—Ä–∂–∏—Ç `parser` ‚Üí üß∂

---

## üé® –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

```
{emoji} [{context_ids}] {original_message}
```

**–ü—Ä–∏–º–µ—Ä—ã**:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|------------|-----------|
| üì• + batch-123 + "Loaded" | `üì• [batch-123] Loaded` |
| üß† + doc-42/chunk-5 + "Embedded" | `üß† [doc-42/chunk-5] Embedded` |
| ‚ùå + task-99 + "Failed" | `‚ùå [task-99] Failed` |

---

### –ì–¥–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —ç–º–æ–¥–∑–∏

```mermaid
sequenceDiagram
    participant U as User Code
    participant S as SemanticLogger
    participant L as logging.Logger
    participant H as RichHandler
    
    U->>S: logger.info("message")
    S->>S: emoji = get_module_emoji()
    S->>S: msg = f"{emoji} {message}"
    S->>L: log(level, msg)
    L->>H: emit(record)
    H->>H: –í—ã–≤–æ–¥–∏—Ç –∫–∞–∫ –µ—Å—Ç—å
```

**–í–∞–∂–Ω–æ**: –≠–º–æ–¥–∑–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `SemanticLogger._log()`, –Ω–µ –≤ Formatter.

---

## ‚ö†Ô∏è RichHandler Quirks

### –ü—Ä–æ–±–ª–µ–º–∞ —Å Formatter

‚ùå **RichHandler –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç `Formatter.format()`**:

–û–Ω –≤—ã–∑—ã–≤–∞–µ—Ç `record.getMessage()` –Ω–∞–ø—Ä—è–º—É—é –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–∞–º. –ö–∞—Å—Ç–æ–º–Ω—ã–π Formatter –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

‚úÖ **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª—è–µ–º —ç–º–æ–¥–∑–∏ –≤ **—Å–æ–æ–±—â–µ–Ω–∏–µ**, –¥–æ –ø–µ—Ä–µ–¥–∞—á–∏ –≤ Logger:

```mermaid
graph LR
    A[SemanticLogger] --> B["msg = üì• + original"]
    B --> C[Logger.log]
    C --> D[RichHandler]
    D --> E["üì• Processing..."]
```

---

## üìä –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞

```
üì• Starting pipeline for 5 documents
üß∂ Parsing markdown structure
‚úÇÔ∏è Split into 23 chunks
üß† Generating embeddings...
üß† [batch-001] Batch sent to Gemini
‚ö†Ô∏è [batch-001] Rate limit warning, backing off
üß† [batch-001] Embeddings received
üíæ Storing 23 vectors
üîç Index ready for search
```

**–ü–∞—Ç—Ç–µ—Ä–Ω —á—Ç–µ–Ω–∏—è**:

1. –ì–ª–∞–∑ —Å–∫–æ–ª—å–∑–∏—Ç –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é (—ç–º–æ–¥–∑–∏)
2. ‚ö†Ô∏è —Å—Ä–∞–∑—É –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ
3. –ß–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏

---

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º –ª–æ–≥–æ–º

| –≠–º–æ–¥–∑–∏ –ª–æ–≥ | –¢–µ–∫—Å—Ç–æ–≤—ã–π –ª–æ–≥ |
|------------|---------------|
| üì• Starting... | INFO semantic_core.pipeline Starting... |
| ‚ö†Ô∏è Rate limit | WARNING semantic_core.embedder Rate limit |
| ‚ùå Failed | ERROR semantic_core.storage Failed |

**–≠–∫–æ–Ω–æ–º–∏—è**: ~40% —à–∏—Ä–∏–Ω—ã —Å—Ç—Ä–æ–∫–∏, –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

### 1. –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –º–∞–ø–ø–∏–Ω–≥–∞

–û–¥–∏–Ω –º–æ–¥—É–ª—å = –æ–¥–∏–Ω —ç–º–æ–¥–∑–∏. –ï—Å–ª–∏ `embedder` = üß†, —Ç–æ –≤–µ–∑–¥–µ üß†.

### 2. Fallback –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π

–ù–æ–≤—ã–π –º–æ–¥—É–ª—å –±–µ–∑ –º–∞–ø–ø–∏–Ω–≥–∞ –ø–æ–ª—É—á–∞–µ—Ç üìå. –≠—Ç–æ —Å–∏–≥–Ω–∞–ª –¥–æ–±–∞–≤–∏—Ç—å –≤ EMOJI_MAP.

### 3. –ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å

15 –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –ë–æ–ª—å—à–µ ‚Äî —Ç–µ—Ä—è–µ—Ç—Å—è —Å–º—ã—Å–ª –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–ª–∏—á–µ–Ω–∏—è.

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **–ü—Ä–µ–¥—ã–¥—É—â–∏–π**: [Semantic Logging Architecture](35_semantic_logging.md)
- **–°–ª–µ–¥—É—é—â–∏–π**: [Context Propagation](37_context_propagation.md) ‚Äî bind() –∏ `[batch-id]`
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: [Secret Redaction](38_secret_redaction.md)

---

**‚Üê [Semantic Logging Architecture](35_semantic_logging.md)** | **[Context Propagation](37_context_propagation.md) ‚Üí**
