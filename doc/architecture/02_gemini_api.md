# ü§ñ Gemini API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

## üìå –ß—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º **Google Gemini API** (—á–µ—Ä–µ–∑ AI Studio) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–µ–∫—Ç–æ—Ä–æ–≤.

**–ú–æ–¥–µ–ª—å**: `models/text-embedding-004`  
**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: `google-generativeai` (Python SDK)

---

## üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ API-–∫–ª—é—á–∞

1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ [Google AI Studio](https://aistudio.google.com/apikey)
2. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π API-–∫–ª—é—á
3. –î–æ–±–∞–≤—å –≤ `.env`:

```env
GEMINI_API_KEY=—Ç–≤–æ–π_–∫–ª—é—á_–∑–¥–µ—Å—å
```

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ

```python
# config.py
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    gemini_api_key: str  # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
    embedding_model: str = "models/text-embedding-004"
    embedding_dimension: int = 768  # MRL-—Ä–µ–∂–∏–º
```

---

## üéØ Task Types: –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –ø–æ–∏—Å–∫

Gemini –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **—Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∑–∞–¥–∞—á** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤–µ–∫—Ç–æ—Ä–æ–≤:

```python
from semantic_core import EmbeddingGenerator

gen = EmbeddingGenerator()

# –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (—Ç–æ, —á—Ç–æ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º)
doc_vector = gen.embed_document("Python ‚Äî —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è")
# task_type="RETRIEVAL_DOCUMENT"

# –î–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ (—Ç–æ, —á—Ç–æ –∏—â–µ–º)
query_vector = gen.embed_query("–∫–∞–∫ –Ω–∞–ø–∏—Å–∞—Ç—å —Ü–∏–∫–ª?")
# task_type="RETRIEVAL_QUERY"
```

### üìä –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É task types

```mermaid
graph TD
    A[RETRIEVAL_DOCUMENT] --> B[–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è<br/>–î–ª–∏–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã, —Å—Ç–∞—Ç—å–∏]
    C[RETRIEVAL_QUERY] --> D[–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞<br/>–ö–æ—Ä–æ—Ç–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã]
    
    B --> E[–ò–Ω–¥–µ–∫—Å –≤ –ë–î]
    D --> E
    E --> F[–ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ]
    
    style A fill:#34a853
    style C fill:#4285f4
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?**
- –ó–∞–ø—Ä–æ—Å—ã –æ–±—ã—á–Ω–æ **–∫–æ—Ä–æ—Ç–∫–∏–µ** ("–Ω–∞–π–¥–∏ —Ä–µ—Ü–µ–ø—Ç –±–æ—Ä—â–∞")
- –î–æ–∫—É–º–µ–Ω—Ç—ã ‚Äî **–¥–ª–∏–Ω–Ω—ã–µ** (–≤—Å—è —Å—Ç–∞—Ç—å—è –æ –±–æ—Ä—â–µ)
- –†–∞–∑–Ω—ã–µ task types —É—á–∏—Ç—ã–≤–∞—é—Ç —ç—Ç—É –∞—Å–∏–º–º–µ—Ç—Ä–∏—é!

---

## üìè –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –≤–µ–∫—Ç–æ—Ä–æ–≤ (MRL)

### Matryoshka Representation Learning

Gemini –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **—É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏** –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞:

```python
# –ü–æ–ª–Ω–∞—è —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º)
full_vector = gen.embed_document(text)  # 768 —á–∏—Å–µ–ª

# MRL: –æ–±—Ä–µ–∑–∞–µ–º –¥–æ 768 (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ API)
# output_dimensionality=768
```

**–ù–∞—à –≤—ã–±–æ—Ä**: 768 –∏–∑–º–µ—Ä–µ–Ω–∏–π (–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç—å/–∫–∞—á–µ—Å—Ç–≤–æ)

| –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å | –ö–∞—á–µ—Å—Ç–≤–æ | –°–∫–æ—Ä–æ—Å—Ç—å | –†–∞–∑–º–µ—Ä –ë–î |
|-------------|----------|----------|-----------|
| 256         | ‚≠ê‚≠ê      | üöÄüöÄüöÄ    | üíæ        |
| **768**     | ‚≠ê‚≠ê‚≠ê    | üöÄüöÄ      | üíæüíæ      |
| 3072        | ‚≠ê‚≠ê‚≠ê‚≠ê  | üöÄ        | üíæüíæüíæüíæ  |

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ª–∏–º–∏—Ç—ã

### 1. **–õ–∏–º–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –∑–∞–ø—Ä–æ—Å: ~2000**

```python
# ‚ùå –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (>2000 —Ç–æ–∫–µ–Ω–æ–≤)
huge_text = "..." * 10000
vector = gen.embed_document(huge_text)  # –ú–æ–∂–µ—Ç –æ–±—Ä–µ–∑–∞—Ç—å—Å—è!

# ‚úÖ –†–∞–∑—É–º–Ω—ã–π —Ä–∞–∑–º–µ—Ä
normal_text = "Python ‚Äî —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö"
vector = gen.embed_document(normal_text)
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π chunking (—Ä–∞–∑–±–∏–≤–∫—É –Ω–∞ —á–∞—Å—Ç–∏).

### 2. **Rate Limits (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier)**

- **15 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É**
- **1500 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å**

–î–ª—è production –Ω—É–∂–µ–Ω –ø–ª–∞—Ç–Ω—ã–π API –∏–ª–∏ –¥—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å.

---

## üî¢ –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å API

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ

```python
# semantic_core/embeddings.py
import google.generativeai as genai

class EmbeddingGenerator:
    def __init__(self):
        genai.configure(api_key=settings.gemini_api_key)
        self.model_name = "models/text-embedding-004"
        self.dimension = 768
    
    def embed_document(self, text: str) -> np.ndarray:
        result = genai.embed_content(
            model=self.model_name,
            content=text,
            task_type="RETRIEVAL_DOCUMENT",  # ‚Üê –î–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
            output_dimensionality=self.dimension  # ‚Üê MRL
        )
        
        embedding = np.array(result['embedding'], dtype=np.float32)
        return self._normalize_vector(embedding)
    
    def embed_query(self, text: str) -> np.ndarray:
        result = genai.embed_content(
            model=self.model_name,
            content=text,
            task_type="RETRIEVAL_QUERY",  # ‚Üê –î–ª—è –ø–æ–∏—Å–∫–∞
            output_dimensionality=self.dimension
        )
        
        embedding = np.array(result['embedding'], dtype=np.float32)
        return self._normalize_vector(embedding)
```

---

## üìä –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```mermaid
sequenceDiagram
    participant App as –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    participant Gen as EmbeddingGenerator
    participant API as Gemini API
    
    App->>Gen: embed_document("Python —Ü–∏–∫–ª—ã")
    Gen->>API: POST /embed<br/>task_type=RETRIEVAL_DOCUMENT
    API-->>Gen: [0.023, -0.145, ..., 0.891]
    Gen->>Gen: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–∞
    Gen-->>App: np.array(768 —á–∏—Å–µ–ª)
```

---

## üéì –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏

### –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

| –ú–æ–¥–µ–ª—å | –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å | –õ–∏–º–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤ | –¶–µ–Ω–∞ |
|--------|-------------|---------------|------|
| **text-embedding-004** | 768 (MRL) | ~2000 | Free/Paid |
| text-embedding-005 (–±—É–¥—É—â–µ–µ) | 1024? | ? | ? |
| OpenAI text-embedding-3-small | 1536 | 8191 | $0.02/1M |
| Sentence Transformers (–ª–æ–∫–∞–ª—å–Ω–æ) | 384-768 | ‚àû | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ |

**–î–ª—è POC**: Gemini –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç (–±—ã—Å—Ç—Ä–æ, –±–µ—Å–ø–ª–∞—Ç–Ω–æ, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ).

---

## ‚öôÔ∏è –ë–µ–∑ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–í–∞–∂–Ω–æ**: `text-embedding-004` ‚Äî —ç—Ç–æ **—Ç–æ–ª—å–∫–æ —ç–º–±–µ–¥–¥–∏–Ω–≥-–º–æ–¥–µ–ª—å**, –±–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏.

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–µ–∫—Å—Ç–∞), –∏—Å–ø–æ–ª—å–∑—É–π –æ—Ç–¥–µ–ª—å–Ω—É—é –º–æ–¥–µ–ª—å:
```python
# –≠—Ç–æ –ù–ï –Ω–∞—à —Å–ª—É—á–∞–π!
# genai.classify_text(...)  # –¢–∞–∫–æ–≥–æ –º–µ—Ç–æ–¥–∞ –Ω–µ—Ç
```

–ù–∞—à –ø–æ–∏—Å–∫ –æ—Å–Ω–æ–≤–∞–Ω **—Ç–æ–ª—å–∫–æ –Ω–∞ –≤–µ–∫—Ç–æ—Ä–Ω–æ–º —Å—Ö–æ–¥—Å—Ç–≤–µ**, –±–µ–∑ –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π.

---

## üîó –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–¢–µ–ø–µ—Ä—å —É–∑–Ω–∞–π, [**–∫–∞–∫ –≤–µ–∫—Ç–æ—Ä—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ SQLite**](03_sqlite_vec.md) ‚Üí
