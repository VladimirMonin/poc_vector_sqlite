# üîê Secret Redaction in Logs

> SensitiveDataFilter: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ API-–∫–ª—é—á–µ–π –Ω–∞ —É—Ä–æ–≤–Ω–µ Filter

---

## üìå –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?

**Secret Redaction** ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ –∑–∞–º–µ–Ω—ã —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (API-–∫–ª—é—á–µ–π, —Ç–æ–∫–µ–Ω–æ–≤) –Ω–∞ `***REDACTED***` –≤ –ª–æ–≥–∞—Ö.

–†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## üéØ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

**–ü—Ä–æ–±–ª–µ–º–∞**: API-–∫–ª—é—á–∏ —É—Ç–µ–∫–∞—é—Ç –≤ –ª–æ–≥–∏:

```
DEBUG: Request headers: {'Authorization': 'Bearer AIzaSyD...xyz'}
ERROR: API call failed with key sk-proj-abc123...
```

–õ–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Sentry, —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª–∞—Ö, –≤–∏–¥–Ω—ã –≤ –∫–æ–Ω—Å–æ–ª–∏.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:

- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏ (—á—É–∂–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞
- –ù–∞—Ä—É—à–µ–Ω–∏–µ compliance (PCI DSS, SOC2)

**–†–µ—à–µ–Ω–∏–µ**: –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ logging.Filter.

---

## üîç –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü–æ–∑–∏—Ü–∏—è –≤ pipeline

```mermaid
graph LR
    A[logger.info] --> B[Logger]
    B --> C[SensitiveFilter]
    C --> D{–°–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–∫—Ä–µ—Ç?}
    D -->|–î–∞| E[–ó–∞–º–µ–Ω—è–µ–º –Ω–∞ REDACTED]
    D -->|–ù–µ—Ç| F[–ü—Ä–æ–ø—É—Å–∫–∞–µ–º]
    E --> G[Handler]
    F --> G
```

---

### –ü–æ—á–µ–º—É Filter, –∞ –Ω–µ Formatter?

```mermaid
sequenceDiagram
    participant L as Logger
    participant F as Filter
    participant Fmt as Formatter
    participant H as Handler
    
    L->>F: filter(record)
    Note over F: –ú—É—Ç–∏—Ä—É–µ–º record.msg
    F->>H: emit(record)
    H->>Fmt: format(record)
    Note over Fmt: –£–∂–µ –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–æ!
```

**–ü—Ä–∏—á–∏–Ω–∞**: Filter –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–¥–æ** Formatter –∏ **–¥–æ** Handler. –°–µ–∫—Ä–µ—Ç –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –≤—ã–≤–æ–¥–∞.

---

## üé≠ –ü–∞—Ç—Ç–µ—Ä–Ω—ã API-–∫–ª—é—á–µ–π

### –¢–∞–±–ª–∏—Ü–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

| –ü—Ä–æ–≤–∞–π–¥–µ—Ä | –ü—Ä–µ—Ñ–∏–∫—Å | –î–ª–∏–Ω–∞ | Regex |
|-----------|---------|-------|-------|
| Google | `AIza` | 39 | `AIza[0-9A-Za-z_-]{35}` |
| OpenAI | `sk-` | 51+ | `sk-[0-9a-zA-Z]{20,}` |
| OpenAI Project | `sk-proj-` | 50+ | `sk-proj-[0-9a-zA-Z_-]{20,}` |
| Groq | `gsk_` | 56+ | `gsk_[0-9a-zA-Z]{50,}` |
| xAI/Grok | `xai-` | 30+ | `xai-[0-9a-zA-Z]{20,}` |
| Bearer | `bearer` | varies | `bearer\s+[a-zA-Z0-9_-]{20,}` |

---

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

```mermaid
graph TD
    subgraph "–í—Ö–æ–¥"
        A["AIzaSyD-abc123...xyz"]
        B["sk-proj-secret123..."]
        C["gsk_verylongtoken..."]
    end
    
    subgraph "–í—ã—Ö–æ–¥"
        D["***REDACTED***"]
        E["***REDACTED***"]
        F["***REDACTED***"]
    end
    
    A --> D
    B --> E
    C --> F
```

---

## üìê –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### –ß—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è

| –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –û–±—Ä–∞–±–æ—Ç–∫–∞ |
|------------|-----------|
| `str` | –ü—Ä—è–º–∞—è –∑–∞–º–µ–Ω–∞ –ø–æ regex |
| `dict` | –†–µ–∫—É—Ä—Å–∏—è –ø–æ values |
| `list` | –†–µ–∫—É—Ä—Å–∏—è –ø–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º |
| `tuple` | –†–µ–∫—É—Ä—Å–∏—è ‚Üí tuple |
| –û—Å—Ç–∞–ª—å–Ω–æ–µ | –ü—Ä–æ–ø—É—Å–∫–∞–µ–º |

---

### –î–∏–∞–≥—Ä–∞–º–º–∞ —Ä–µ–∫—É—Ä—Å–∏–∏

```mermaid
graph TD
    A[sanitize] --> B{–¢–∏–ø?}
    B -->|str| C[regex.sub]
    B -->|dict| D[for v in values]
    B -->|list| E[for item in list]
    B -->|tuple| F[tuple –∏–∑ list]
    B -->|other| G[return as-is]
    
    D --> A
    E --> A
    F --> A
```

---

### –ü—Ä–∏–º–µ—Ä —Å –≤–ª–æ–∂–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

**–í—Ö–æ–¥**:

```python
{
    "config": {
        "api_key": "AIzaSyD-secret-key-here",
        "tokens": ["sk-abc123...", "safe-value"]
    }
}
```

**–í—ã—Ö–æ–¥**:

```python
{
    "config": {
        "api_key": "***REDACTED***",
        "tokens": ["***REDACTED***", "safe-value"]
    }
}
```

---

## üîß –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è Filter

### record.msg

```mermaid
graph LR
    A["record.msg"] --> B{–°—Ç—Ä–æ–∫–∞?}
    B -->|–î–∞| C[sanitize]
    C --> D["record.msg = result"]
```

### record.args

```mermaid
graph LR
    A["record.args"] --> B{tuple?}
    B -->|–î–∞| C[sanitize –∫–∞–∂–¥—ã–π arg]
    C --> D["record.args = tuple(...)"]
```

**–í–∞–∂–Ω–æ**: `args` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è `%s` —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```python
logger.info("Key: %s", api_key)  # args = (api_key,)
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏—è

### –î–æ –∏ –ø–æ—Å–ª–µ

| –ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ | –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞ |
|-------------------|---------------|
| `Using key AIzaSyD-abc...` | `Using key ***REDACTED***` |
| `Auth: Bearer eyJhbG...` | `Auth: ***REDACTED***` |
| `{"key": "sk-proj-..."}` | `{"key": "***REDACTED***"}` |
| `Safe message` | `Safe message` |

---

### –ß–∞—Å—Ç–∏—á–Ω–æ–µ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ

–ú–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –∫–ª—é—á**, –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:

```
Request to https://api.openai.com with key sk-abc123... failed

‚Üì

Request to https://api.openai.com with key ***REDACTED*** failed
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

### 1. –ü–æ—Ä—è–¥–æ–∫ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ

`sk-proj-` –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è **–¥–æ** `sk-`, –∏–Ω–∞—á–µ:

```
sk-proj-abc... ‚Üí sk-***REDACTED***-abc...  ‚ùå
```

**–†–µ—à–µ–Ω–∏–µ**: –ë–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã ‚Äî –ø–µ—Ä–≤—ã–º–∏.

---

### 2. False positives

–ü–∞—Ç—Ç–µ—Ä–Ω `sk-` –º–æ–∂–µ—Ç –ø–æ–π–º–∞—Ç—å –Ω–µ-–∫–ª—é—á–∏:

```
"Disk: 500GB" ‚Üí OK
"Task-id: sk-something" ‚Üí –ú–æ–∂–µ—Ç –∑–∞—Ü–µ–ø–∏—Ç—å ‚ö†Ô∏è
```

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ `{20,}` —É–º–µ–Ω—å—à–∞–µ—Ç –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è.

---

### 3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

Regex –Ω–∞ –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã.

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**:

- –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º regex –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Filter
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `re.IGNORECASE` —Ç–æ–ª—å–∫–æ –¥–ª—è `bearer`

---

### 4. –ß—Ç–æ –ù–ï –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è

‚ùå **–ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è**:

- –ö–ª—é—á–∏ –≤ exception stack traces
- –ö–ª—é—á–∏ –≤ repr() –æ–±—ä–µ–∫—Ç–æ–≤
- –ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∫–ª—é—á–∏ –≤ exception messages.

---

## üîó –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ

```python
LoggingConfig(
    redact_secrets=True  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
)
```

–ü—Ä–∏ `False` Filter –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ handlers.

---

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `SECRET_PATTERNS` –≤ `filters.py`:

```python
SECRET_PATTERNS = [
    r"AIza[0-9A-Za-z_-]{35}",
    r"sk-[0-9a-zA-Z]{20,}",
    # –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π:
    r"my-corp-key-[a-z0-9]{32}",
]
```

---

## üìà –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–µ–∫—Ä–µ—Ç–∞

```mermaid
graph LR
    A[–°–µ–∫—Ä–µ—Ç –≤ –∫–æ–¥–µ] --> B[logger.info]
    B --> C[SensitiveFilter]
    C --> D[REDACTED]
    D --> E[Console]
    D --> F[File]
    D --> G[Sentry]
    
    style C fill:#90EE90
    style D fill:#90EE90
```

–°–µ–∫—Ä–µ—Ç **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–∫–∏–¥–∞–µ—Ç** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **–ü—Ä–µ–¥—ã–¥—É—â–∏–π**: [Context Propagation](37_context_propagation.md)
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: [Semantic Logging Architecture](35_semantic_logging.md)
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: [Visual Semantics in Logs](36_visual_semantics_logs.md)

---

**‚Üê [Context Propagation](37_context_propagation.md)** | **[–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](00_overview.md)**
