# üîê API Key Management: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–∏–ª–ª–∏–Ω–≥–∞

> –ö–∞–∫ –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞—Ç—Ä–∞—Ç—ã –º–µ–∂–¥—É —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

---

## üìå –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?

**GoogleKeyring** ‚Äî —ç—Ç–æ domain –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç –¥–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö API –∫–ª—é—á–∞ Google Gemini: –æ–¥–∏–Ω –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, –≤—Ç–æ—Ä–æ–π –¥–ª—è batch processing.

–ü—Ä–æ—Å—Ç–∞—è –∏–¥–µ—è: **—Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ = —Ä–∞–∑–¥–µ–ª—å–Ω—ã–π –±–∏–ª–ª–∏–Ω–≥ –≤ Google Cloud Console**.

---

## üéØ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

**–ü—Ä–æ–±–ª–µ–º–∞:**

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç—ã –≤–Ω–µ–¥—Ä–∏–ª Batch API –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ 50% –Ω–∞ –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü—Ä–æ—à—ë–ª –º–µ—Å—è—Ü, —Ç—ã –∑–∞—Ö–æ–¥–∏—à—å –≤ –±–∏–ª–ª–∏–Ω–≥... –∏ –≤–∏–¥–∏—à—å –æ–±—â—É—é —Å—É–º–º—É. **–ù–æ –∫–∞–∫ –ø–æ–Ω—è—Ç—å, —Å–∫–æ–ª—å–∫–æ –∏–º–µ–Ω–Ω–æ —Å—ç–∫–æ–Ω–æ–º–∏–ª –±–∞—Ç—á–∏–Ω–≥?**

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –æ–¥–∏–Ω API –∫–ª—é—á –¥–ª—è –≤—Å–µ–≥–æ, Google –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É —Å—á—ë—Ç–∞:

```
Gemini API (text-embedding-004): $25.00
```

–ù–µ–ø–æ–Ω—è—Ç–Ω–æ, —Å–∫–æ–ª—å–∫–æ –∏–∑ —ç—Ç–æ–≥–æ –æ–±—ã—á–Ω—ã–π `embed_content()`, –∞ —Å–∫–æ–ª—å–∫–æ ‚Äî Batch API.

**–†–µ—à–µ–Ω–∏–µ:**

–î–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö API –∫–ª—é—á–∞ ‚Üí –¥–≤–µ —Å—Ç—Ä–æ–∫–∏ –≤ –±–∏–ª–ª–∏–Ω–≥–µ:

```
Gemini API (Key 1 - default):     $15.00  ‚Üê –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
Gemini API (Key 2 - batch):       $5.00   ‚Üê Batch processing (50% –¥–µ—à–µ–≤–ª–µ!)
```

–¢–µ–ø–µ—Ä—å —Ç—ã **–≤–∏–¥–∏—à—å —ç–∫–æ–Ω–æ–º–∏—é –Ω–∞–ø—Ä—è–º—É—é** –≤ —Å—á—ë—Ç–µ.

---

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞

```mermaid
graph TB
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç –∑–∞–º–µ—Ç–∫—É] --> B{–†–µ–∂–∏–º?}
    B -->|mode='sync'| C[GeminiEmbedder]
    B -->|mode='async'| D[BatchManager]
    
    C --> E[default_key<br/>$0.025/1M tokens]
    D --> F[batch_key<br/>$0.0125/1M tokens]
    
    E --> G[Google Cloud Project]
    F --> G
    
    G --> H[–ë–∏–ª–ª–∏–Ω–≥ Console]
    H --> I[Key 1: $15.00]
    H --> J[Key 2: $5.00]
    
    style E fill:#ff9999
    style F fill:#99ff99
    style I fill:#ff9999
    style J fill:#99ff99
```

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∫–ª—é—á–µ–π

1. **–°–æ–∑–¥–∞–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å –¥–≤–∞ API –∫–ª—é—á–∞ –≤ Google AI Studio
2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –°–æ—Ö—Ä–∞–Ω—è–µ—à—å –≤ `.env` –∏–ª–∏ secrets manager
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** Pipeline –≤—ã–±–∏—Ä–∞–µ—Ç –∫–ª—é—á –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –ü—Ä–æ–≤–µ—Ä—è–µ—à—å —Ä–∞–∑–¥–µ–ª—å–Ω—ã–π –±–∏–ª–ª–∏–Ω–≥ –≤ Google Cloud Console

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –û–¥–∏–Ω –∫–ª—é—á | GoogleKeyring (–¥–≤–∞ –∫–ª—é—á–∞) |
|----------|-----------|---------------------------|
| **–í–∏–¥–∏–º–æ—Å—Ç—å —ç–∫–æ–Ω–æ–º–∏–∏** | ‚ùå –ù–µ–ø–æ–Ω—è—Ç–Ω–æ | ‚úÖ –†–∞–∑–¥–µ–ª—å–Ω—ã–π –±–∏–ª–ª–∏–Ω–≥ |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | ‚ö†Ô∏è –ï—Å–ª–∏ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω ‚Äî –ø–æ—Ç–µ—Ä—è –≤—Å–µ–≥–æ | ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è blast radius |
| **–ö–≤–æ—Ç—ã** | ‚ö†Ô∏è –û–±—â–∞—è –∫–≤–æ—Ç–∞ –Ω–∞ –≤—Å—ë | ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ª–∏–º–∏—Ç—ã |
| **–ê–Ω–∞–ª–∏–∑ –∑–∞—Ç—Ä–∞—Ç** | ‚ùå –†—É—á–Ω–æ–π –ø–æ–¥—Å—á—ë—Ç | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤ Console |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å setup** | ‚úÖ –û–¥–∏–Ω –∫–ª—é—á –≤ .env | ‚ö†Ô∏è –î–≤–∞ –∫–ª—é—á–∞ –≤ .env |

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

GoogleKeyring **–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ batch_key** –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ BatchManager:

- –ï—Å–ª–∏ `batch_key = None` ‚Üí **ValueError**
- –ü–æ—á–µ–º—É —Å—Ç—Ä–æ–≥–æ? –ü–æ—Ç–æ–º—É —á—Ç–æ –±–µ–∑ –∫–ª—é—á–∞ BatchManager –Ω–µ —Å–º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è –≤ Google

**–ê–Ω–∞–ª–æ–≥–∏—è:** –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–µ–Ω–µ–≥ –Ω–∞ —Å—á—ë—Ç–µ –ø–µ—Ä–µ–¥ –ø–æ–∫—É–ø–∫–æ–π –±–∏–ª–µ—Ç–∞.

---

### 2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Ä–æ—Ç–∞—Ü–∏—è

**–•—Ä–∞–Ω–µ–Ω–∏–µ:**

- ‚ùå **–ù–ï –∫–æ–º–º–∏—Ç—å** –∫–ª—é—á–∏ –≤ Git
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.env` (–ª–æ–∫–∞–ª—å–Ω–æ) –∏–ª–∏ AWS Secrets Manager (production)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å IP –≤ Google Cloud Console (whitelist)

**–†–æ—Ç–∞—Ü–∏—è:**

–ï—Å–ª–∏ –∫–ª—é—á —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω:

1. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π –∫–ª—é—á –≤ Google AI Studio
2. –û–±–Ω–æ–≤–∏ `.env` –∏–ª–∏ secrets manager
3. –£–¥–∞–ª–∏ —Å—Ç–∞—Ä—ã–π –∫–ª—é—á –∏–∑ Google Console
4. **–í–∞–∂–Ω–æ:** batch_key –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç default_key

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –ï—Å–ª–∏ —É—Ç—ë–∫ batch_key, –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ **–æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å batch jobs**, –Ω–æ –Ω–µ –¥–µ–ª–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã.

---

### 3. –ö–≤–æ—Ç—ã –∏ –ª–∏–º–∏—Ç—ã

Google Gemini API –∏–º–µ–µ—Ç **rate limits** (–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É):

| –õ–∏–º–∏—Ç | –ó–Ω–∞—á–µ–Ω–∏–µ |
|-------|----------|
| Requests per minute (RPM) | 1500 |
| Tokens per minute (TPM) | 1M |

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –æ–¥–∏–Ω –∫–ª—é—á, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∏ batch –∑–∞–ø—Ä–æ—Å—ã **–¥–µ–ª—è—Ç –æ–±—â—É—é –∫–≤–æ—Ç—É**.

**–†–µ—à–µ–Ω–∏–µ:** –î–≤–∞ –∫–ª—é—á–∞ ‚Üí **—É–¥–≤–æ–µ–Ω–∏–µ –∫–≤–æ—Ç—ã**:

- default_key: 1500 RPM –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- batch_key: 1500 RPM –¥–ª—è batch processing

**–ê–Ω–∞–ª–æ–≥–∏—è:** –ö–∞–∫ –¥–≤–∞ –∫–∞–Ω–∞–ª–∞ –≤ Wi-Fi —Ä–æ—É—Ç–µ—Ä–µ ‚Äî –Ω–µ –º–µ—à–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥—É.

---

### 4. –ë–∏–ª–ª–∏–Ω–≥ –ø—Ä–æ–µ–∫—Ç—ã

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å **–¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö Google Cloud –ø—Ä–æ–µ–∫—Ç–∞**:

- –ü—Ä–æ–µ–∫—Ç A (default_key) ‚Äî –¥–ª—è production —Ç—Ä–∞—Ñ–∏–∫–∞
- –ü—Ä–æ–µ–∫—Ç B (batch_key) ‚Äî –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è budgets (alerts –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏)
- ‚úÖ –†–∞–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–µ–∫—Ç–∞–º–∏
- ‚úÖ –õ–µ–≥—á–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞—Ç—Ä–∞—Ç—ã –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**

- ‚ö†Ô∏è –ë–æ–ª—å—à–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –¥–≤–∞ –ø—Ä–æ–µ–∫—Ç–∞

---

## üéì –ê–Ω–∞–ª–æ–≥–∏—è –∏–∑ –∂–∏–∑–Ω–∏

–ü—Ä–µ–¥—Å—Ç–∞–≤—å –∫–∞—Ñ–µ —Å –¥–≤—É–º—è –∫–∞—Å—Å–∞–º–∏:

- **–ö–∞—Å—Å–∞ 1 (default_key):** –î–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–∫–∞–∑—ã–≤–∞—é—Ç "–Ω–∞ –≤—ã–Ω–æ—Å" (–±—ã—Å—Ç—Ä–æ, –¥–æ—Ä–æ–∂–µ)
- **–ö–∞—Å—Å–∞ 2 (batch_key):** –î–ª—è –ø—Ä–µ–¥–∑–∞–∫–∞–∑–æ–≤ –æ–ø—Ç–æ–º —Å–æ —Å–∫–∏–¥–∫–æ–π 50% (–º–µ–¥–ª–µ–Ω–Ω–µ–µ, –¥–µ—à–µ–≤–ª–µ)

–í–ª–∞–¥–µ–ª–µ—Ü –∫–∞—Ñ–µ —Ö–æ—á–µ—Ç –∑–Ω–∞—Ç—å: **—Å–∫–æ–ª—å–∫–æ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∂–¥–∞—è –∫–∞—Å—Å–∞**?

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É –∫–∞—Å—Å—É ‚Äî –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ. –î–≤–µ –∫–∞—Å—Å—ã ‚Üí **—Ä–∞–∑–¥–µ–ª—å–Ω—ã–π —É—á—ë—Ç –≤—ã—Ä—É—á–∫–∏** –≤ –∫–æ–Ω—Ü–µ –¥–Ω—è.

---

## üîó –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ —Ç—ã –ø–æ–Ω–∏–º–∞–µ—à—å **–∑–∞—á–µ–º** –Ω—É–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π, –ø–µ—Ä–µ–π–¥—ë–º –∫ —Ç–æ–º—É, **–∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**:

‚Üí [**20. Async Processing: From Sync to Queue**](20_async_processing.md)

---

**‚Üê [–ù–∞–∑–∞–¥ –∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](00_overview.md)**
