# üîÑ Batch API: –û—Ç –∑–∞–≥–ª—É—à–∫–∏ –∫ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏

> –ö–∞–∫ GeminiBatchClient –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª—Å—è –∏–∑ NotImplementedError –≤ —Ä–∞–±–æ—Ç–∞—é—â—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

---

## üìå –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?

**Phase 10** ‚Äî —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ Google Batch API –≤–º–µ—Å—Ç–æ –∑–∞–≥–ª—É—à–∫–∏ –∏–∑ Phase 5. 

Phase 5 —Å–æ–∑–¥–∞–ª–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É (BatchManager, BatchJobModel, —Å—Ç–∞—Ç—É—Å—ã —á–∞–Ω–∫–æ–≤), –Ω–æ —Å–∞–º –∫–ª–∏–µ–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–ª `NotImplementedError`.

Phase 10 –∑–∞–º–µ–Ω–∏–ª–∞ –∑–∞–≥–ª—É—à–∫—É —Ä–∞–±–æ—Ç–∞—é—â–∏–º –∫–æ–¥–æ–º –∏ –æ–±–Ω–∞—Ä—É–∂–∏–ª–∞ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è.

---

## üéØ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

**–ü—Ä–æ–±–ª–µ–º–∞:** Batch API –æ–±–µ—â–∞–µ—Ç 50% —ç–∫–æ–Ω–æ–º–∏—é, –Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | Phase 5 | Phase 10 |
|-----------|---------|----------|
| `BatchJobModel` | ‚úÖ –ì–æ—Ç–æ–≤ | ‚úÖ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| `BatchManager` | ‚úÖ –ì–æ—Ç–æ–≤ | ‚úÖ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| `GeminiBatchClient` | ‚ùå –ó–∞–≥–ª—É—à–∫–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |

**–†–µ—à–µ–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç—Ä–∏ –º–µ—Ç–æ–¥–∞ –∫–ª–∏–µ–Ω—Ç–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º Google API.

---

## üîç –ß—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫?

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –î—Ä—É–≥–æ–π SDK

```mermaid
graph LR
    A[–°—Ç–∞—Ä—ã–π SDK] --> B[google.generativeai]
    C[–ù–æ–≤—ã–π SDK] --> D[google.genai]
    
    B --> E[embed_content]
    D --> F[batches.create]
    
    style D fill:#99ff99
    style F fill:#99ff99
```

Batch API –¥–æ—Å—Ç—É–ø–µ–Ω **—Ç–æ–ª—å–∫–æ** –≤ –Ω–æ–≤–æ–º SDK `google-genai`. 
–°—Ç–∞—Ä—ã–π `google-generativeai` –µ–≥–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç.

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –î—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç JSONL

| –ê—Å–ø–µ–∫—Ç | –û–∂–∏–¥–∞–Ω–∏–µ (Phase 5) | –†–µ–∞–ª—å–Ω–æ—Å—Ç—å |
|--------|-------------------|------------|
| ID —á–∞–Ω–∫–∞ | `custom_id` | `key` |
| –ö–æ–Ω—Ç–µ–Ω—Ç | `content` (–æ–±—ä–µ–∫—Ç) | `contents` (–º–∞—Å—Å–∏–≤!) |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –í–Ω–µ –∑–∞–ø—Ä–æ—Å–∞ | –í–Ω—É—Ç—Ä–∏ `request.config` |

**–ö—Ä–∏—Ç–∏—á–Ω–æ:** `content` vs `contents` ‚Äî –æ–¥–Ω–∞ –±—É–∫–≤–∞, –Ω–æ API –º–æ–ª—á–∞ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ú–æ–¥–µ–ª—å –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Batch API

```
400 INVALID_ARGUMENT: Model does not support asyncBatchEmbedContent
```

**–û—Ç–∫—Ä—ã—Ç–∏–µ:** `text-embedding-004` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Batch API!

| –ú–æ–¥–µ–ª—å | Sync | Batch |
|--------|------|-------|
| `text-embedding-004` | ‚úÖ | ‚ùå |
| `gemini-embedding-001` | ‚úÖ | ‚úÖ |

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ `gemini-embedding-001`.

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

### –ö–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞

| –ó–∞–ø—Ä–æ—Å | text-embedding-004 | gemini-embedding-001 | –†–∞–∑–Ω–∏—Ü–∞ |
|--------|-------------------|---------------------|---------|
| SQL –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | 0.59 | 0.67 | **+14%** |
| –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ | 0.48 | 0.51 | **+6%** |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | 0.56 | 0.62 | **+10%** |

**–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–æ:** `gemini-embedding-001` –æ–∫–∞–∑–∞–ª–∞—Å—å **–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–µ–µ**!

---

### –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –∏ MRL

`gemini-embedding-001` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–∞—ë—Ç 3072-–º–µ—Ä–Ω—ã–µ –≤–µ–∫—Ç–æ—Ä–∞.

–ù–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **Matryoshka Representation Learning**:

| –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å | –ö–∞—á–µ—Å—Ç–≤–æ | –ü–∞–º—è—Ç—å |
|-------------|----------|--------|
| 3072 | 100% | 100% |
| 768 | ~98% | 25% |
| 256 | ~94% | 8% |

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `output_dimensionality=768` ‚Äî —Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ö–µ–º–æ–π.

---

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –º–æ–¥–µ–ª–µ–π

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç:** –ú–æ–∂–Ω–æ –ª–∏ —Å–º–µ—à–∏–≤–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏?

```
Cross-model similarity: -0.05
```

**–û—Ç–≤–µ—Ç: –ù–ï–¢.** –≠—Ç–æ —Ö—É–∂–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —à—É–º–∞!

**–í—ã–≤–æ–¥:** –ü—Ä–∏ —Å–º–µ–Ω–µ –º–æ–¥–µ–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è.

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

### 1. –î–≤–∞ SDK —Å–æ—Å—É—â–µ—Å—Ç–≤—É—é—Ç

```python
# embedder.py (sync)
import google.generativeai as genai

# batching.py (batch)
from google import genai
```

–≠—Ç–æ —Ä–∞–∑–Ω—ã–µ –ø–∞–∫–µ—Ç—ã, –Ω–æ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤–º–µ—Å—Ç–µ –≤ –æ–¥–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ.

---

### 2. –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è embeddings

–í–º–µ—Å—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ `batches.create()` –µ—Å—Ç—å `batches.create_embeddings()`:

- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `inlined_requests` ‚Äî –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞
- –ú–µ–Ω—å—à–µ —à–∞–≥–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

---

### 3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ

–î–ª—è embeddings batch —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤:

```
batch_job.dest.inlined_embed_content_responses
```

–ê –Ω–µ –≤ `batch_job.responses`.

---

## üîó –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

Batch API —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `gemini-embedding-001`, –Ω–æ sync embeddings –≤—Å—ë –µ—â—ë –∏—Å–ø–æ–ª—å–∑—É—é—Ç `text-embedding-004`.

–≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å. –ù—É–∂–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è sync embeddings.

‚Üí [**51. –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ gemini-embedding-001**](51_model_migration.md)

---

**‚Üê [–ù–∞–∑–∞–¥ –∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](00_overview.md)**
