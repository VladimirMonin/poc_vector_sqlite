# üîé –¢–∏–ø—ã –ø–æ–∏—Å–∫–∞: –≤–µ–∫—Ç–æ—Ä–Ω—ã–π vs –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π

## üìå –î–≤–∞ –ø–æ–¥—Ö–æ–¥–∞ –∫ –ø–æ–∏—Å–∫—É

–í –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫**, –∫–æ–º–±–∏–Ω–∏—Ä—É—é—â–∏–π –¥–≤–∞ –º–µ—Ç–æ–¥–∞:

1. **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫** (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π) ‚Äî –ø–æ —Å–º—ã—Å–ª—É
2. **–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫** (FTS5) ‚Äî –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º

---

## üß† –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (Semantic Search)

### –°—É—Ç—å

–ò—â–µ—Ç –ø–æ **—Å–º—ã—Å–ª—É**, –∞ –Ω–µ –ø–æ —Ç–æ—á–Ω—ã–º —Å–ª–æ–≤–∞–º.

```python
results = Note.vector_search("–∫–∞–∫ –Ω–∞–ø–∏—Å–∞—Ç—å —Ü–∏–∫–ª", limit=5)
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

```mermaid
graph LR
    A[–ó–∞–ø—Ä–æ—Å:<br/>'–∫–∞–∫ –Ω–∞–ø–∏—Å–∞—Ç—å —Ü–∏–∫–ª'] --> B[Gemini API]
    B --> C[–í–µ–∫—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞<br/>768D]
    C --> D[–ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ<br/>—Å –≤–µ–∫—Ç–æ—Ä–∞–º–∏ –ë–î]
    D --> E[–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:<br/>1. –¶–∏–∫–ª—ã –≤ Python<br/>2. For loop<br/>3. While]
    
    style C fill:#4285f4,color:#fff
```

### SQL-–∑–∞–ø—Ä–æ—Å

```sql
SELECT 
    main.id,
    vec_distance_cosine(vec.embedding, ?) as distance
FROM notes main
INNER JOIN notes_vec vec ON main.id = vec.id
ORDER BY distance ASC
LIMIT 5;
```

### –ü—Ä–∏–º–µ—Ä—ã

| –ó–∞–ø—Ä–æ—Å | –ù–∞–π–¥—ë—Ç |
|--------|--------|
| "—Ü–∏–∫–ª –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏" | "for loop", "while", "–∏—Ç–µ—Ä–∞—Ü–∏—è" |
| "—Ä–µ—Ü–µ–ø—Ç –±–æ—Ä—â–∞" | "—É–∫—Ä–∞–∏–Ω—Å–∫–∏–π —Å—É–ø", "—Å–≤–µ–∫–ª–∞", "–≤–∞—Ä–∫–∞" |
| "AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç" | "ChatGPT", "–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫", "–±–æ—Ç" |

### –ü–ª—é—Å—ã ‚úÖ

- **–ü–æ–Ω–∏–º–∞–µ—Ç —Å–∏–Ω–æ–Ω–∏–º—ã**: "—Ü–∏–∫–ª" = "loop" = "–∏—Ç–µ—Ä–∞—Ü–∏—è"
- **–ö—Ä–æ—Å—Å-—è–∑—ã–∫–æ–≤–æ–π**: "—Å–æ–±–∞–∫–∞" –±–ª–∏–∑–∫–æ –∫ "dog"
- **–£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç**: "–±–∞–Ω–∫ –¥–µ–Ω–µ–≥" ‚â† "–±–∞–Ω–∫ —Å–∫–∞–º–µ–π–∫–∞"

### –ú–∏–Ω—É—Å—ã ‚ùå

- **–ú–µ–¥–ª–µ–Ω–Ω–µ–µ FTS** (–ª–∏–Ω–µ–π–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
- **–ù–µ—Ç —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è**: –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ä–µ–¥–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã
- **–ó–∞–≤–∏—Å–∏—Ç –æ—Ç API**: –Ω—É–∂–µ–Ω –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–ª—è Gemini

---

## üìù –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (FTS5)

### –°—É—Ç—å

–ò—â–µ—Ç **—Ç–æ—á–Ω—ã–µ —Å–ª–æ–≤–∞ –∏ –∏—Ö —Ñ–æ—Ä–º—ã** —á–µ—Ä–µ–∑ –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å.

```python
results = Note.fulltext_search("—Å–∫—Ä–∏–ø—Ç", limit=5)
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

```mermaid
graph LR
    A[–ó–∞–ø—Ä–æ—Å: '—Å–∫—Ä–∏–ø—Ç'] --> B[–¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è]
    B --> C[–ò–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å]
    C --> D[–°–ø–∏—Å–æ–∫ rowid<br/>–≥–¥–µ –µ—Å—Ç—å '—Å–∫—Ä–∏–ø—Ç']
    D --> E[–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ BM25]
    E --> F[–†–µ–∑—É–ª—å—Ç–∞—Ç—ã]
    
    style C fill:#34a853,color:#fff
```

### SQL-–∑–∞–ø—Ä–æ—Å

```sql
SELECT 
    main.id,
    fts.rank as rank
FROM notes main
INNER JOIN notes_fts fts ON main.id = fts.rowid
WHERE notes_fts MATCH '—Å–∫—Ä–∏–ø—Ç'
ORDER BY rank
LIMIT 5;
```

### –°–æ–∑–¥–∞–Ω–∏–µ FTS-—Ç–∞–±–ª–∏—Ü—ã

```sql
CREATE VIRTUAL TABLE notes_fts USING fts5(
    id UNINDEXED,
    title,
    content,
    content=notes,
    content_rowid=id
);
```

**–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä—ã**:

```sql
CREATE TRIGGER notes_fts_insert 
AFTER INSERT ON notes BEGIN
    INSERT INTO notes_fts(rowid, title, content)
    VALUES (new.id, new.title, new.content);
END;
```

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å FTS5

```python
# –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫
Note.fulltext_search("python")

# –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
Note.fulltext_search("python AND —Ü–∏–∫–ª")
Note.fulltext_search("python OR javascript")
Note.fulltext_search("python NOT java")

# –ü—Ä–µ—Ñ–∏–∫—Å–Ω—ã–π –ø–æ–∏—Å–∫
Note.fulltext_search("–ø—Ä–æ–≥—Ä–∞–º*")  # –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ–≥—Ä–∞–º–º–∞

# –§—Ä–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫
Note.fulltext_search('"for loop"')
```

### –ü–ª—é—Å—ã ‚úÖ

- **–û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π**: O(log n) —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å
- **–¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ**: –Ω–∞–π–¥—ë—Ç —Ä–µ–¥–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã
- **–ù–µ –Ω—É–∂–µ–Ω –∏–Ω—Ç–µ—Ä–Ω–µ—Ç**: –≤—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏**: "–ø—Ä–æ–≥—Ä–∞–º–º–∞" –Ω–∞–π–¥—ë—Ç "–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ"

### –ú–∏–Ω—É—Å—ã ‚ùå

- **–ù–µ –ø–æ–Ω–∏–º–∞–µ—Ç —Å–∏–Ω–æ–Ω–∏–º—ã**: "—Ü–∏–∫–ª" ‚â† "loop"
- **–ù–µ—Ç —Å–µ–º–∞–Ω—Ç–∏–∫–∏**: "–±–æ—Ä—â" –Ω–µ –Ω–∞–π–¥—ë—Ç "—É–∫—Ä–∞–∏–Ω—Å–∫–∏–π —Å—É–ø"
- **–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–µ**: "–∫–∞–∫ –Ω–∞–ø–∏—Å–∞—Ç—å —Ü–∏–∫–ª" ‚â† "—Å–æ–∑–¥–∞–Ω–∏–µ —Ü–∏–∫–ª–æ–≤"

---

## ‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ | –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π FTS5 |
|----------|-----------------|---------------------|
| **–°–∫–æ—Ä–æ—Å—Ç—å** | üê¢ –ú–µ–¥–ª–µ–Ω–Ω–æ (50-300ms) | üöÄ –ë—ã—Å—Ç—Ä–æ (<10ms) |
| **–°–∏–Ω–æ–Ω–∏–º—ã** | ‚úÖ –ü–æ–Ω–∏–º–∞–µ—Ç | ‚ùå –ù–µ –ø–æ–Ω–∏–º–∞–µ—Ç |
| **–¢–æ—á–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê –°–º—ã—Å–ª–æ–≤–∞—è | ‚≠ê‚≠ê‚≠ê‚≠ê –ë—É–∫–≤–∞–ª—å–Ω–∞—è |
| **–ò–Ω—Ç–µ—Ä–Ω–µ—Ç** | ‚ö†Ô∏è –ù—É–∂–µ–Ω (Gemini) | ‚úÖ –ù–µ –Ω—É–∂–µ–Ω |
| **–†–µ–¥–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã** | ‚ùå –ú–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å | ‚úÖ –ù–∞–π–¥—ë—Ç —Ç–æ—á–Ω–æ |
| **–†–∞–∑–º–µ—Ä –ë–î** | +3KB –Ω–∞ –≤–µ–∫—Ç–æ—Ä | +~30% –Ω–∞ –∏–Ω–¥–µ–∫—Å |

---

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ?

### –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫

- **–í–æ–ø—Ä–æ—Å–Ω–æ-–æ—Ç–≤–µ—Ç–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã**: "–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å X?"
- **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑**: "–Ω–∞–π–¥–∏ –ø–æ—Ö–æ–∂–∏–µ —Å—Ç–∞—Ç—å–∏"
- **–ö—Ä–æ—Å—Å-—è–∑—ã–∫–æ–≤–æ–π –ø–æ–∏—Å–∫**: —Ä—É—Å—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å ‚Üí –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å—Ç–∞—Ç—å–∏

### –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫

- **–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–≥–∞–º**: "#—Å—Ä–æ—á–Ω–æ", "#–∫–æ–¥"
- **–¢–æ—á–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã**: "SQLAlchemy", "React.useEffect"
- **–ü—Ä–µ—Ñ–∏–∫—Å—ã**: "–ø—Ä–æ–≥—Ä–∞–º*" ‚Üí –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (–Ω–∞—à –ø–æ–¥—Ö–æ–¥!)

–ö–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç –æ–±–∞ –º–µ—Ç–æ–¥–∞ —á–µ—Ä–µ–∑ **RRF** (Reciprocal Rank Fusion):
- FTS5 –Ω–∞—Ö–æ–¥–∏—Ç —Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (#—Å—Ä–æ—á–Ω–æ)
- –í–µ–∫—Ç–æ—Ä –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ —Å–º—ã—Å–ª—É (—Å–∫—Ä–∏–ø—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö)
- RRF –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Üí **–ª—É—á—à–µ–µ –∏–∑ –¥–≤—É—Ö –º–∏—Ä–æ–≤**!

---

## üìä –ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–ó–∞–ø—Ä–æ—Å**: "—Å—Ä–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç"

### –¢–æ–ª—å–∫–æ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫

```
1. –£–ª—É—á—à–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø–æ–∏—Å–∫–∞     (–±–ª–∏–∑–∫–æ –ø–æ —Å–º—ã—Å–ª—É –∫ "—Å–∫—Ä–∏–ø—Ç")
2. –°–∫—Ä–∏–ø—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö        (—Ç–æ—á–Ω–æ–µ —Å–ª–æ–≤–æ "—Å–∫—Ä–∏–ø—Ç")
3. –¶–∏–∫–ª—ã –≤ Python                 (—Ç–æ–∂–µ –ø—Ä–æ –∫–æ–¥)
```

### –¢–æ–ª—å–∫–æ FTS5

```
1. –°–∫—Ä–∏–ø—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö  (#—Å—Ä–æ—á–Ω–æ, "—Å–∫—Ä–∏–ø—Ç" ‚Äî –æ–±–∞ —Å–ª–æ–≤–∞ –µ—Å—Ç—å!)
2. (–¥—Ä—É–≥–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å)
```

### –ì–∏–±—Ä–∏–¥–Ω—ã–π (RRF)

```
1. –°–∫—Ä–∏–ø—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö        (—Ç–æ–ø –≤ –æ–±–æ–∏—Ö –º–µ—Ç–æ–¥–∞—Ö!)
2. –£–ª—É—á—à–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø–æ–∏—Å–∫–∞     (#—Å—Ä–æ—á–Ω–æ –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ FTS)
3. –¶–∏–∫–ª—ã –≤ Python                 (–≤–µ–∫—Ç–æ—Ä + —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å)
```

---

## üîó –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–£–∑–Ω–∞–π –ø–æ–¥—Ä–æ–±–Ω–µ–µ, [**–∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (RRF)**](05_hybrid_search_rrf.md) ‚Üí
