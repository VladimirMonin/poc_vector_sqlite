# üëÅÔ∏è Gemini Vision Integration

> –ö–∞–∫ Gemini Vision API –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## üìå –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?

**GeminiImageAnalyzer** ‚Äî –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è Gemini Vision API, –∫–æ—Ç–æ—Ä—ã–π:

1. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Gemini —Å –ø—Ä–æ–º–ø—Ç–æ–º
3. –ü–æ–ª—É—á–∞–µ—Ç **—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON** —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º

–†–µ–∑—É–ª—å—Ç–∞—Ç: —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

---

## üéØ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

**–ü—Ä–æ–±–ª–µ–º–∞**: Gemini Vision –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç. –ù–∞–º –Ω—É–∂–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: –æ–ø–∏—Å–∞–Ω–∏–µ, alt-text, –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, OCR.

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ–º `response_schema` –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ JSON-—Ñ–æ—Ä–º–∞—Ç–∞. Gemini **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ** –≤–µ—Ä–Ω—ë—Ç –¥–∞–Ω–Ω—ã–µ –≤ –Ω—É–∂–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ.

---

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

```mermaid
sequenceDiagram
    participant App as –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    participant Analyzer as GeminiImageAnalyzer
    participant Gemini as Gemini Vision API
    
    App->>Analyzer: analyze(path, prompt, context)
    Analyzer->>Analyzer: –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    Analyzer->>Analyzer: –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç
    Analyzer->>Gemini: generate_content(image + prompt)
    Note over Gemini: response_schema = ImageAnalysisSchema
    Gemini-->>Analyzer: JSON {description, alt_text, keywords, ocr_text}
    Analyzer->>Analyzer: –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø–∞—Ä—Å–∏–Ω–≥
    Analyzer-->>App: MediaAnalysisResult
```

---

## üì¶ Structured JSON Output

### –ü—Ä–æ–±–ª–µ–º–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

‚ùå **–ë–µ–∑ schema** ‚Äî Gemini –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á—Ç–æ —Ö–æ—á–µ—Ç:

```
"–ù–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∫—Ä–∞—Å–Ω–∞—è –º–∞—à–∏–Ω–∞. –≠—Ç–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—å –º–∞—Ä–∫–∏ Toyota. 
–í–∏–¥–µ–Ω –Ω–æ–º–µ—Ä–Ω–æ–π –∑–Ω–∞–∫ ABC-123. –§–æ–Ω ‚Äî –≥–æ—Ä–æ–¥—Å–∫–∞—è —É–ª–∏—Ü–∞."
```

–ö–∞–∫ –∏–∑ —ç—Ç–æ–≥–æ –∏–∑–≤–ª–µ—á—å alt-text? –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞? OCR?

---

### –†–µ—à–µ–Ω–∏–µ: response_schema

‚úÖ **–° schema** ‚Äî Gemini –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON:

```json
{
  "description": "–ö—Ä–∞—Å–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å Toyota –Ω–∞ –≥–æ—Ä–æ–¥—Å–∫–æ–π —É–ª–∏—Ü–µ",
  "alt_text": "–§–æ—Ç–æ –∫—Ä–∞—Å–Ω–æ–π –º–∞—à–∏–Ω—ã",
  "keywords": ["–∞–≤—Ç–æ–º–æ–±–∏–ª—å", "Toyota", "–∫—Ä–∞—Å–Ω—ã–π", "—É–ª–∏—Ü–∞"],
  "ocr_text": "ABC-123"
}
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**: Gemini API –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `response_schema`, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–∂–∏–¥–∞–µ–º—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –ú–æ–¥–µ–ª—å **–æ–±—è–∑–∞–Ω–∞** –≤–µ—Ä–Ω—É—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π JSON —ç—Ç–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---

### –°—Ö–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|--------------|----------|
| `description` | string | ‚úÖ | –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è |
| `alt_text` | string | ‚úÖ | –ö—Ä–∞—Ç–∫–∏–π alt-text (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) |
| `keywords` | array[string] | ‚úÖ | 3-7 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ |
| `ocr_text` | string | ‚ùå | –†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å) |

---

## üé® –ü—Ä–æ–º–ø—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥

### –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç

–ü—Ä–æ–º–ø—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä—ë—Ö —á–∞—Å—Ç–µ–π:

1. **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è** ‚Äî —á—Ç–æ –¥–µ–ª–∞—Ç—å
2. **–ö–æ–Ω—Ç–µ–∫—Å—Ç** ‚Äî –æ—Ç–∫—É–¥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
3. **User Prompt** ‚Äî —É—Ç–æ—á–Ω–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –µ—Å—Ç—å)

```
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –≤–µ—Ä–Ω–∏:
1. –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
2. –ö—Ä–∞—Ç–∫–∏–π alt-text –¥–ª—è accessibility
3. 3-7 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤/—Ç–µ–≥–æ–≤
4. –õ—é–±–æ–π —Ç–µ–∫—Å—Ç –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ (OCR)

–ö–æ–Ω—Ç–µ–∫—Å—Ç: {context_text}
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: {user_prompt}
```

---

### –í–ª–∏—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

| –ö–æ–Ω—Ç–µ–∫—Å—Ç | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|-----------|
| –ë–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | "–î–∏–∞–≥—Ä–∞–º–º–∞ —Å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞–º–∏ –∏ —Å—Ç—Ä–µ–ª–∫–∞–º–∏" |
| "Django ORM" | "UML –¥–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤ Django –º–æ–¥–µ–ª–µ–π User –∏ Profile" |
| "–†–∞–∑–¥–µ–ª: API Reference" | "Sequence –¥–∏–∞–≥—Ä–∞–º–º–∞ REST API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ /users" |

**–í—ã–≤–æ–¥**: –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (Phase 4) –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –æ–ø–∏—Å–∞–Ω–∏–π.

---

## üßÆ –†–∞—Å—á—ë—Ç —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –ê–ª–≥–æ—Ä–∏—Ç–º Gemini

Gemini –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç–∞–π–ª–∏–Ω–≥** –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤:

```mermaid
graph TD
    A[–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ] --> B{–†–∞–∑–º–µ—Ä ‚â§ 384√ó384?}
    B -->|–î–∞| C[258 —Ç–æ–∫–µ–Ω–æ–≤]
    B -->|–ù–µ—Ç| D[–†–∞–∑–±–∏—Ç—å –Ω–∞ —Ç–∞–π–ª—ã]
    D --> E[–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–π–ª–æ–≤ √ó 258]
```

---

### –§–æ—Ä–º—É–ª–∞ —Ç–∞–π–ª–∏–Ω–≥–∞

1. **–ú–∞–ª–µ–Ω—å–∫–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** (‚â§ 384√ó384): —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ **258 —Ç–æ–∫–µ–Ω–æ–≤**

2. **–ë–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**:
   - `crop_unit = min(width, height) / 1.5`
   - `tiles_x = ceil(width / crop_unit)`
   - `tiles_y = ceil(height / crop_unit)`
   - **–¢–æ–∫–µ–Ω—ã = tiles_x √ó tiles_y √ó 258**

---

### –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á—ë—Ç–∞

| –†–∞–∑–º–µ—Ä | –¢–∞–π–ª–æ–≤ | –¢–æ–∫–µ–Ω–æ–≤ |
|--------|--------|---------|
| 200√ó200 | 1 | 258 |
| 384√ó384 | 1 | 258 |
| 800√ó600 | 2√ó2 = 4 | 1032 |
| 1920√ó1080 | 3√ó2 = 6 | 1548 |
| 3840√ó2160 (4K) | 4√ó3 = 12 | 3096 |

---

### –°—Ç–æ–∏–º–æ—Å—Ç—å

| –ú–æ–¥–µ–ª—å | –¶–µ–Ω–∞ –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤ |
|--------|-------------------|
| gemini-2.5-flash | $0.10 |
| gemini-2.5-pro | $1.25 |

**–ü—Ä–∏–º–µ—Ä**: 1000 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π 1080p √ó 1548 —Ç–æ–∫–µ–Ω–æ–≤ = 1.5M —Ç–æ–∫–µ–Ω–æ–≤

- Flash: **$0.15**
- Pro: **$1.88**

**–í—ã–≤–æ–¥**: –î–ª—è –º–∞—Å—Å–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ Flash —ç–∫–æ–Ω–æ–º–∏—Ç **12√ó**.

---

## ‚öôÔ∏è –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Flash | Pro |
|----------|-------|-----|
| –°–∫–æ—Ä–æ—Å—Ç—å | üöÄ –ë—ã—Å—Ç—Ä–µ–µ | üê¢ –ú–µ–¥–ª–µ–Ω–Ω–µ–µ |
| –°—Ç–æ–∏–º–æ—Å—Ç—å | üí∞ $0.10/1M | üí∏ $1.25/1M |
| –ö–∞—á–µ—Å—Ç–≤–æ OCR | ‚úÖ –•–æ—Ä–æ—à–æ | ‚úÖ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| –°–ª–æ–∂–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã | ‚ö†Ô∏è –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ | ‚úÖ –õ—É—á—à–µ |
| –ú–µ–ª–∫–∏–π —Ç–µ–∫—Å—Ç | ‚ö†Ô∏è –ú–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å | ‚úÖ –¢–æ—á–Ω–µ–µ |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: `gemini-2.5-flash`

**–ö–æ–≥–¥–∞ Pro**: –ö—Ä–∏—Ç–∏—á–Ω—ã–π OCR (–¥–æ–∫—É–º–µ–Ω—Ç—ã, —Å–∫—Ä–∏–Ω—à–æ—Ç—ã —Å –∫–æ–¥–æ–º), —Å–ª–æ–∂–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã.

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

### 1. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

| –§–æ—Ä–º–∞—Ç | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ |
|--------|-----------|
| JPEG | ‚úÖ |
| PNG | ‚úÖ |
| WebP | ‚úÖ |
| GIF | ‚úÖ (–ø–µ—Ä–≤—ã–π –∫–∞–¥—Ä) |
| HEIC | ‚úÖ |
| BMP | ‚ùå |
| TIFF | ‚ùå |

---

### 2. –õ–∏–º–∏—Ç—ã —Ä–∞–∑–º–µ—Ä–∞

- **–ú–∞–∫—Å–∏–º—É–º**: 20MB –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–æ 1920px –ø–æ –±–æ–ª—å—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ

–ë–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è = –±–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤ = –¥–æ—Ä–æ–∂–µ. –ö–∞—á–µ—Å—Ç–≤–æ –æ–ø–∏—Å–∞–Ω–∏—è –Ω–µ —É–ª—É—á—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ 1920px.

---

### 3. Retry –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

`GeminiImageAnalyzer` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@retry_with_backoff`:

- 429 (rate limit) ‚Üí retry —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
- 503 (service unavailable) ‚Üí retry
- ValueError ‚Üí **–Ω–µ retry** (–æ—à–∏–±–∫–∞ –≤ –¥–∞–Ω–Ω—ã—Ö)

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [Resilience Patterns](27_resilience_patterns.md)

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **–ü—Ä–µ–¥—ã–¥—É—â–∏–π**: [Media Processing Architecture](25_media_processing_architecture.md)
- **–°–ª–µ–¥—É—é—â–∏–π**: [Resilience Patterns](27_resilience_patterns.md)
- **Rate Limiting**: [Rate Limiting](28_rate_limiting.md)

---

**‚Üê [Media Processing Architecture](25_media_processing_architecture.md)** | **[Resilience Patterns](27_resilience_patterns.md) ‚Üí**
