# üñºÔ∏è Media Processing Architecture

> –ö–∞–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏: –æ—Ç —Ñ–∞–π–ª–∞ –¥–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ —á–∞–Ω–∫–∞

---

## üìå –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?

**Media Processing** ‚Äî –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–∏ –≤ –±—É–¥—É—â–µ–º –∞—É–¥–∏–æ/–≤–∏–¥–µ–æ) —Å –ø–æ–º–æ—â—å—é Gemini Vision API –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–∞–∫ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö —á–∞–Ω–∫–æ–≤.

–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è: **–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ ‚Üí –≤–µ–∫—Ç–æ—Ä ‚Üí –ø–æ–∏—Å–∫**.

---

## üéØ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

**–ü—Ä–æ–±–ª–µ–º–∞**: –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å Markdown-–¥–æ–∫—É–º–µ–Ω—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏. –ü—Ä–∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–º –ø–æ–∏—Å–∫–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è ‚Äî –∏—â–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç.

**–†–µ—à–µ–Ω–∏–µ**: Gemini Vision –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞—ë—Ç:
- **–û–ø–∏—Å–∞–Ω–∏–µ** (—á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–æ)
- **Alt-text** (–∫—Ä–∞—Ç–∫–∞—è –ø–æ–¥–ø–∏—Å—å)
- **–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞** (—Ç–µ–≥–∏)
- **OCR-—Ç–µ–∫—Å—Ç** (–µ—Å–ª–∏ –µ—Å—Ç—å –Ω–∞–¥–ø–∏—Å–∏)

–≠—Ç–æ—Ç —Ç–µ–∫—Å—Ç –≤–µ–∫—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –∏ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –ø–æ–∏—Å–∫–µ –Ω–∞—Ä–∞–≤–Ω–µ —Å –æ–±—ã—á–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ª–æ—ë–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     SemanticCore                            ‚îÇ
‚îÇ                   ingest_image()                            ‚îÇ
‚îÇ              process_media_queue()                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  Core Layer                                 ‚îÇ
‚îÇ              MediaQueueProcessor                            ‚îÇ
‚îÇ         (–æ—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á)                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚ñº                ‚ñº                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ RateLimiter  ‚îÇ  ‚îÇ ImageAnalyzer‚îÇ  ‚îÇ MediaTask    ‚îÇ
‚îÇ (throttling) ‚îÇ  ‚îÇ (Gemini API) ‚îÇ  ‚îÇ   Model      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     Infrastructure Layer              Storage Layer
```

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è**:
- **SemanticCore** ‚Äî –ø—É–±–ª–∏—á–Ω—ã–π API (—Ñ–∞—Å–∞–¥)
- **MediaQueueProcessor** ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **Infrastructure** ‚Äî –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã (Gemini, Rate Limiting)
- **Storage** ‚Äî –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (SQLite)

---

## üîÑ –î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

### Sync Mode (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

```mermaid
sequenceDiagram
    participant User
    participant Core as SemanticCore
    participant Queue as QueueProcessor
    participant Gemini as Gemini Vision
    
    User->>Core: ingest_image(path, mode="sync")
    Core->>Queue: –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É + —Å—Ä–∞–∑—É –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å
    Queue->>Gemini: –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    Gemini-->>Queue: –û–ø–∏—Å–∞–Ω–∏–µ, alt, keywords
    Queue->>Core: –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω
    Core-->>User: task_id (–≥–æ—Ç–æ–≤–æ)
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –Ω—É–∂–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–∑—É.

---

### Async Mode

```mermaid
sequenceDiagram
    participant User
    participant Core as SemanticCore
    participant DB as MediaTaskModel
    participant Worker as Background Worker
    participant Gemini as Gemini Vision
    
    User->>Core: ingest_image(path, mode="async")
    Core->>DB: –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É (status=pending)
    Core-->>User: task_id (–≤ –æ—á–µ—Ä–µ–¥–∏)
    
    Note over Worker: –ü–æ–∑–∂–µ...
    
    Worker->>DB: –í–∑—è—Ç—å pending –∑–∞–¥–∞—á—É
    Worker->>Gemini: –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    Gemini-->>Worker: –†–µ–∑—É–ª—å—Ç–∞—Ç
    Worker->>DB: –û–±–Ω–æ–≤–∏—Ç—å (status=completed)
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –ü–∞–∫–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —Ñ–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞.

---

## üì¶ Domain Layer: DTO

### MediaConfig

–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–µ–¥–∏–∞-–æ–±—Ä–∞–±–æ—Ç–∫–∏:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|------------|
| `image_model` | gemini-2.5-flash | –≠–∫–æ–Ω–æ–º–∏—á–Ω–∞—è –º–æ–¥–µ–ª—å Vision |
| `rpm_limit` | 15 | –õ–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É (Free Tier) |
| `max_image_dimension` | 1920 | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç–æ—Ä–æ–Ω—ã |
| `image_quality` | 80 | –ö–∞—á–µ—Å—Ç–≤–æ —Å–∂–∞—Ç–∏—è –ø—Ä–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ |

**–ü–æ—á–µ–º—É Flash?** –î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Flash-–º–æ–¥–µ–ª–∏ ‚Äî –æ–Ω–∞ –≤ 10√ó –¥–µ—à–µ–≤–ª–µ Pro –∏ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏/OCR.

---

### MediaAnalysisResult

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:

| –ü–æ–ª–µ | –¢–∏–ø | –ü—Ä–∏–º–µ—Ä |
|------|-----|--------|
| `description` | str | "–ö—Ä–∞—Å–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å –Ω–∞ –ø–∞—Ä–∫–æ–≤–∫–µ" |
| `alt_text` | str | "–§–æ—Ç–æ –∫—Ä–∞—Å–Ω–æ–π –º–∞—à–∏–Ω—ã" |
| `keywords` | list[str] | ["–∞–≤—Ç–æ–º–æ–±–∏–ª—å", "–∫—Ä–∞—Å–Ω—ã–π", "–ø–∞—Ä–∫–æ–≤–∫–∞"] |
| `ocr_text` | str? | "STOP" (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç) |

**–ó–∞—á–µ–º –≤—Å—ë —ç—Ç–æ?**
- `description` ‚Üí –æ—Å–Ω–æ–≤–∞ –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞
- `alt_text` ‚Üí –¥–ª—è accessibility
- `keywords` ‚Üí –¥–ª—è FTS5 –ø–æ–∏—Å–∫–∞
- `ocr_text` ‚Üí —Ç–µ–∫—Å—Ç —Å –≤—ã–≤–µ—Å–æ–∫, —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤

---

### TaskStatus (Enum)

```
PENDING ‚Üí PROCESSING ‚Üí COMPLETED
                   ‚Üò
                    FAILED
```

| –°—Ç–∞—Ç—É—Å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|--------|----------|
| `pending` | –í –æ—á–µ—Ä–µ–¥–∏, –∂–¥—ë—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ |
| `processing` | –°–µ–π—á–∞—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è |
| `completed` | –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ |
| `failed` | –û—à–∏–±–∫–∞ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ error_message) |

---

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ SemanticCore

### –ü—É–±–ª–∏—á–Ω—ã–π API

```python
# Sync ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–∑—É
task_id = core.ingest_image(
    path="docs/images/diagram.png",
    user_prompt="–≠—Ç–æ UML –¥–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤",
    context_text="–†–∞–∑–¥–µ–ª: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ > –ú–æ–¥–µ–ª–∏",
    mode="sync"
)

# Async ‚Äî –≤ –æ—á–µ—Ä–µ–¥—å
task_id = core.ingest_image(path="photo.jpg", mode="async")

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏
processed = core.process_media_queue(max_tasks=10)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –æ—á–µ—Ä–µ–¥–∏
pending = core.get_media_queue_size()
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|------------|
| `user_prompt` | –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ ("–≠—Ç–æ —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–¥–∞") |
| `context_text` | –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü–∏–∏) |

**–ó–∞—á–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç?** Gemini –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ –∑–Ω–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç. –°–∫—Ä–∏–Ω—à–æ—Ç –≤ —Ä–∞–∑–¥–µ–ª–µ "Django ORM" –±—É–¥–µ—Ç –æ–ø–∏—Å–∞–Ω —Ç–æ—á–Ω–µ–µ, —á–µ–º –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Sync | Async |
|----------|------|-------|
| –°–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ | ‚è±Ô∏è 2-5 —Å–µ–∫ | ‚ö° –º–≥–Ω–æ–≤–µ–Ω–Ω–æ |
| –†–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–∑—É | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |
| –ü–∞–∫–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ | üê¢ –ú–µ–¥–ª–µ–Ω–Ω–æ | üöÄ –ë—ã—Å—Ç—Ä–æ |
| Rate Limiting | ‚ö†Ô∏è –ë–ª–æ–∫–∏—Ä—É–µ—Ç | ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ |
| –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å | ‚ö†Ô∏è –¢–µ—Ä—è–µ—Ç—Å—è | ‚úÖ –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: 
- –ï–¥–∏–Ω–∏—á–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Üí `sync`
- –ò–º–ø–æ—Ä—Ç 100+ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚Üí `async`

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

### 1. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Pillow

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Pillow ‚Äî **optional dependency**:

```bash
poetry install --extras media
```

–ë–µ–∑ Pillow: —Ä–∞—Å—á—ë—Ç —Ç–æ–∫–µ–Ω–æ–≤ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.

---

### 2. –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ—á–µ—Ä–µ–¥–∏

–ó–∞–¥–∞—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ SQLite (`MediaTaskModel`), –∞ –Ω–µ –≤ –ø–∞–º—è—Ç–∏. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç:
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è **–Ω–µ —Ç–µ—Ä—è–µ—Ç** –æ—á–µ—Ä–µ–¥—å
- –ú–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ **–¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º**
- Failed –∑–∞–¥–∞—á–∏ **—Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

---

### 3. –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ Phase 4

–ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å—Ç—Ä–µ—Ç–∏–ª–æ—Å—å –≤ Markdown-–¥–æ–∫—É–º–µ–Ω—Ç–µ, –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–µ—Ä—ë—Ç—Å—è –∏–∑ **–∏–µ—Ä–∞—Ä—Ö–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤** (Phase 4):

```markdown
# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
## –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
### User Model

![–î–∏–∞–≥—Ä–∞–º–º–∞](user_model.png)
```

`context_text` = "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ > –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö > User Model"

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **–°–ª–µ–¥—É—é—â–∏–π**: [Gemini Vision Integration](26_gemini_vision_integration.md) ‚Äî –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–Ω–∞–ª–∏–∑
- **Rate Limiting**: [Rate Limiting](28_rate_limiting.md) ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç 429
- **–û—á–µ—Ä–µ–¥—å**: [Media Queue Processor](29_media_queue_processor.md) ‚Äî –¥–µ—Ç–∞–ª–∏ –æ—á–µ—Ä–µ–¥–∏

---

**‚Üê [Production Optimizations](24_production_optimizations.md)** | **[Gemini Vision Integration](26_gemini_vision_integration.md) ‚Üí**
