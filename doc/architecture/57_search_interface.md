# ğŸ” Episode 57: Search Interface Architecture

> HTMX + Flask: Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ±ĞµĞ· JavaScript-Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€ĞºĞ¾Ğ²

---

## ğŸ¯ Ğ§Ñ‚Ğ¾ Ğ¼Ñ‹ ÑÑ‚Ñ€Ğ¾Ğ¸Ğ¼?

**Intelligent Search Interface** â€” Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ¿Ğ¾ Ğ±Ğ°Ğ·Ğµ Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” [python async programming           ] ğŸ”„                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â˜ Ğ¢ĞµĞºÑÑ‚  â˜ ĞšĞ¾Ğ´  â˜ Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ  â˜ ĞÑƒĞ´Ğ¸Ğ¾    [Ğ“Ğ¸Ğ±Ñ€Ğ¸Ğ´Ğ½Ñ‹Ğ¹ â–¼]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ CODE python                           ğŸ¯ 0.0542         â”‚   â”‚
â”‚  â”‚ H1 > Async Python > Coroutines                          â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚ async def fetch_data():                             â”‚ â”‚   â”‚
â”‚  â”‚ â”‚     async with aiohttp.ClientSession() as session:  â”‚ â”‚   â”‚
â”‚  â”‚ â”‚         return await session.get(url)               â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚ ğŸ“„ Async Programming Guide          python tutorial    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ TEXT                                  ğŸ¯ 0.0321         â”‚   â”‚
â”‚  â”‚ H1 > Async Python > Basics                              â”‚   â”‚
â”‚  â”‚ ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑ‚ÑŒ...    â”‚   â”‚
â”‚  â”‚ ğŸ“„ Async Programming Guide          python beginner    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ— ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Flask App                               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  search_bp   â”‚    â”‚SearchService â”‚    â”‚ markdown.py  â”‚     â”‚
â”‚  â”‚  Blueprint   â”‚â”€â”€â”€â–¶â”‚  + Cache     â”‚â”€â”€â”€â–¶â”‚  rendering   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                   â”‚                                   â”‚
â”‚         â”‚                   â–¼                                   â”‚
â”‚         â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚         â”‚           â”‚SemanticCore  â”‚                           â”‚
â”‚         â”‚           â”‚search_chunks â”‚                           â”‚
â”‚         â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      Templates                            â”‚ â”‚
â”‚  â”‚  search.html â”€â”€â–¶ partials/search_results.html            â”‚ â”‚
â”‚  â”‚                          â–²                                â”‚ â”‚
â”‚  â”‚                    HTMX swap                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ HTMX Flow

Ğ’Ğ¼ĞµÑÑ‚Ğ¾ SPA-Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€ĞºĞ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ **HTMX** Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    keyup delay:500ms    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Input     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  /search/    â”‚
â”‚   Field     â”‚    hx-get              â”‚  results     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚  HTML        â”‚
                                       â”‚  Partial     â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼ hx-swap
                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚  #search-    â”‚
                                       â”‚  results     â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ñ‹:**

```html
<input 
    hx-get="/search/results"
    hx-trigger="keyup changed delay:500ms"
    hx-target="#search-results"
    hx-indicator="#search-indicator"
    name="q"
>
```

| ĞÑ‚Ñ€Ğ¸Ğ±ÑƒÑ‚ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|---------|------------|
| `hx-get` | URL Ğ´Ğ»Ñ AJAX-Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° |
| `hx-trigger` | Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ + debounce 500ms |
| `hx-target` | ĞšÑƒĞ´Ğ° Ğ²ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚ |
| `hx-indicator` | ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ spinner Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° |

---

## ğŸ“¦ SearchService

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SearchService                              â”‚
â”‚                                                                 â”‚
â”‚   search(query, chunk_types, mode, limit)                      â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”œâ”€â”€â”€ QueryCacheService.get_or_embed() â† ĞšÑÑˆ           â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”œâ”€â”€â”€ SemanticCore.search_chunks()                      â”‚
â”‚         â”‚         â”‚                                             â”‚
â”‚         â”‚         â”œâ”€â”€ chunk_type_filter="code"                 â”‚
â”‚         â”‚         â”œâ”€â”€ chunk_type_filter="text"                 â”‚
â”‚         â”‚         â””â”€â”€ chunk_type_filter="image_ref"            â”‚
â”‚         â”‚                                                       â”‚
â”‚         â””â”€â”€â”€ _chunk_result_to_item()                           â”‚
â”‚                   â”‚                                             â”‚
â”‚                   â–¼                                             â”‚
â”‚             SearchResultItem                                    â”‚
â”‚               â”œâ”€â”€ chunk_id                                      â”‚
â”‚               â”œâ”€â”€ content                                       â”‚
â”‚               â”œâ”€â”€ chunk_type                                    â”‚
â”‚               â”œâ”€â”€ language                                      â”‚
â”‚               â”œâ”€â”€ score                                         â”‚
â”‚               â”œâ”€â”€ score_class â†’ CSS ĞºĞ»Ğ°ÑÑ                      â”‚
â”‚               â”œâ”€â”€ match_type                                    â”‚
â”‚               â”œâ”€â”€ parent_doc_id                                 â”‚
â”‚               â”œâ”€â”€ parent_doc_title                              â”‚
â”‚               â”œâ”€â”€ context (breadcrumb)                          â”‚
â”‚               â””â”€â”€ tags                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Score Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

```python
def _score_to_class(score: float) -> str:
    if score >= 0.02:
        return "score-high"    # ğŸŸ¢ Ğ—ĞµĞ»Ñ‘Ğ½Ñ‹Ğ¹
    elif score >= 0.01:
        return "score-medium"  # ğŸŸ¡ Ğ–Ñ‘Ğ»Ñ‚Ñ‹Ğ¹
    return "score-low"         # âšª Ğ¡ĞµÑ€Ñ‹Ğ¹
```

---

## ğŸ¨ UI ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

### ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ border-left Ñ†Ğ²ĞµÑ‚ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ñƒ:                                       â”‚
â”‚   â€¢ TEXT â†’ border-primary (ÑĞ¸Ğ½Ğ¸Ğ¹)                              â”‚
â”‚   â€¢ CODE â†’ border-info (Ğ³Ğ¾Ğ»ÑƒĞ±Ğ¾Ğ¹)                               â”‚
â”‚   â€¢ IMAGE â†’ border-success (Ğ·ĞµĞ»Ñ‘Ğ½Ñ‹Ğ¹)                           â”‚
â”‚   â€¢ AUDIO â†’ border-warning (Ğ¾Ñ€Ğ°Ğ½Ğ¶ĞµĞ²Ñ‹Ğ¹)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ [CODE python]  [âš¡ hybrid]              ğŸ¯ 0.0542           â”‚â”‚
â”‚ â”‚                                                             â”‚â”‚
â”‚ â”‚ H1 > Section > Subsection  â† breadcrumb ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚            â”‚â”‚
â”‚ â”‚                                                             â”‚â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚ â”‚ â”‚ async def fetch_data():                                 â”‚â”‚â”‚
â”‚ â”‚ â”‚     ...                                                 â”‚â”‚â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚ â”‚                                                             â”‚â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”‚
â”‚ â”‚ ğŸ“„ Document Title                      [tag1] [tag2]        â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹

```html
<div id="type-filters">
    â˜ <i class="bi bi-file-text"></i> Ğ¢ĞµĞºÑÑ‚
    â˜ <i class="bi bi-code-square"></i> ĞšĞ¾Ğ´  
    â˜ <i class="bi bi-image"></i> Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
    â˜ <i class="bi bi-music-note-beamed"></i> ĞÑƒĞ´Ğ¸Ğ¾
</div>

<select id="search-mode">
    <option value="hybrid">Ğ“Ğ¸Ğ±Ñ€Ğ¸Ğ´Ğ½Ñ‹Ğ¹ (RRF)</option>
    <option value="vector">Ğ¡ĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹</option>
    <option value="fts">ĞŸĞ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹</option>
</select>
```

---

## ğŸ“ Markdown Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       markdown.py                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  render_markdown(text) â”€â”€â–¶ markdown-it-py â”€â”€â–¶ Safe HTML        â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”œâ”€â”€ html=False        â† XSS protection                 â”‚
â”‚         â”œâ”€â”€ linkify=True      â† Auto-links                     â”‚
â”‚         â””â”€â”€ typographer=True  â† Smart quotes                   â”‚
â”‚                                                                 â”‚
â”‚  render_code(code, lang) â”€â”€â–¶ <pre><code class="language-{lang}">â”‚
â”‚         â”‚                                                       â”‚
â”‚         â””â”€â”€ html.escape()     â† XSS protection                 â”‚
â”‚                                                                 â”‚
â”‚  truncate_content(text, max_length)                            â”‚
â”‚         â”‚                                                       â”‚
â”‚         â””â”€â”€ word boundary     â† ĞĞµ Ğ»Ğ¾Ğ¼Ğ°ĞµÑ‚ ÑĞ»Ğ¾Ğ²Ğ°                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Highlight.js Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ:**

```javascript
// Ğ’ base.html
document.body.addEventListener('htmx:afterSwap', function(event) {
    event.detail.elt.querySelectorAll('pre code').forEach((block) => {
        hljs.highlightElement(block);
    });
});
```

---

## ğŸ”— API Endpoints

### Blueprint routes

| Endpoint | Method | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|--------|------------|
| `/search/` | GET | Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ¿Ğ¾Ğ¸ÑĞºĞ° |
| `/search/results` | GET | HTMX partial Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°Ğ¼Ğ¸ |
| `/search/suggest` | GET | JSON Ğ°Ğ²Ñ‚Ğ¾ĞºĞ¾Ğ¼Ğ¿Ğ»Ğ¸Ñ‚ |

### Query Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ `/search/results`

```
GET /search/results?q=python&types=code,text&mode=hybrid&limit=20
```

| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ¢Ğ¸Ğ¿ | ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|----------|-----|--------------|----------|
| `q` | string | â€” | ĞŸĞ¾Ğ¸ÑĞºĞ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ |
| `types` | string | Ğ²ÑĞµ | Ğ¢Ğ¸Ğ¿Ñ‹ Ñ‡Ğ°Ğ½ĞºĞ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Ğ·Ğ°Ğ¿ÑÑ‚ÑƒÑ |
| `mode` | string | hybrid | vector/fts/hybrid |
| `limit` | int | 20 | ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² |

---

## ğŸ§ª Ğ¢ĞµÑÑ‚Ñ‹

**26 Ñ‚ĞµÑÑ‚Ğ¾Ğ² Ğ² `test_search.py`:**

```
TestMarkdownUtils
â”œâ”€â”€ test_render_markdown_basic
â”œâ”€â”€ test_render_markdown_code_block
â”œâ”€â”€ test_render_markdown_escapes_html
â”œâ”€â”€ test_render_markdown_empty_string
â”œâ”€â”€ test_render_code_with_language
â”œâ”€â”€ test_render_code_escapes_html
â”œâ”€â”€ test_truncate_content_short
â”œâ”€â”€ test_truncate_content_long
â””â”€â”€ test_truncate_content_at_word_boundary

TestSearchResultItem
â”œâ”€â”€ test_score_to_class_high
â”œâ”€â”€ test_score_to_class_medium
â””â”€â”€ test_score_to_class_low

TestSearchService
â”œâ”€â”€ test_search_returns_results
â”œâ”€â”€ test_search_empty_query_returns_empty
â”œâ”€â”€ test_search_uses_cache
â”œâ”€â”€ test_search_with_chunk_type_filter
â”œâ”€â”€ test_search_with_multiple_chunk_types
â”œâ”€â”€ test_search_results_sorted_by_score
â””â”€â”€ test_get_available_types

TestSearchRoutes
â”œâ”€â”€ test_search_page_loads
â”œâ”€â”€ test_search_page_without_core
â”œâ”€â”€ test_search_results_empty_query
â”œâ”€â”€ test_search_results_without_core
â”œâ”€â”€ test_suggest_returns_json
â””â”€â”€ test_suggest_short_query

TestSearchIntegration
â””â”€â”€ test_chunk_result_to_item_conversion
```

---

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

```
examples/flask_app/app/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ main.py           # Dashboard
â”‚   â””â”€â”€ search.py         # Search Blueprint â† NEW
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ cache_service.py  # Query Cache
â”‚   â””â”€â”€ search_service.py # Search Service â† NEW
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py       # â† NEW
â”‚   â””â”€â”€ markdown.py       # Markdown rendering â† NEW
â””â”€â”€ templates/
    â”œâ”€â”€ base.html         # Layout
    â”œâ”€â”€ search.html       # Search page â† NEW
    â””â”€â”€ partials/
        â”œâ”€â”€ search_results.html  # Results partial â† NEW
        â””â”€â”€ search_error.html    # Error partial â† NEW
```

---

## âš¡ ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Ğ¢Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Ğ’Ğ²Ğ¾Ğ´ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ 0ms           â”‚
â”‚        â”‚                                                        â”‚
â”‚        â–¼  (debounce 500ms)                                     â”‚
â”‚  HTMX request â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ 500ms         â”‚
â”‚        â”‚                                                        â”‚
â”‚        â–¼                                                        â”‚
â”‚  Cache lookup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ~5ms          â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”œâ”€â”€ HIT: skip API                                       â”‚
â”‚        â””â”€â”€ MISS: Gemini API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ~300ms        â”‚
â”‚                                                                 â”‚
â”‚  SQLite search_chunks() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ~10ms         â”‚
â”‚        â”‚                                                        â”‚
â”‚        â–¼                                                        â”‚
â”‚  Markdown render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ~5ms          â”‚
â”‚        â”‚                                                        â”‚
â”‚        â–¼                                                        â”‚
â”‚  HTMX swap â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ~1ms          â”‚
â”‚                                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  Cache HIT:   ~520ms total                                     â”‚
â”‚  Cache MISS:  ~820ms total                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ

| Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ | Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ | ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ |
|--------|---------|--------|
| SPA Ğ¸Ğ»Ğ¸ SSR? | **SSR + HTMX** | ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ğ°, SEO, no build step |
| Debounce? | **500ms** | Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ UX vs API calls |
| Markdown? | **markdown-it-py** | Ğ£Ğ¶Ğµ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑÑ…, Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹ |
| Code highlight? | **Highlight.js** | CDN, Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ HTMX swap |
| Score colors? | **CSS ĞºĞ»Ğ°ÑÑÑ‹** | Ğ›ĞµĞ³ĞºĞ¾ ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ |

---

## ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Phase 12.2

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|---------|----------|
| ĞĞ¾Ğ²Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² | 8 |
| Ğ¡Ñ‚Ñ€Ğ¾Ğº ĞºĞ¾Ğ´Ğ° | ~1169 |
| ĞĞ¾Ğ²Ñ‹Ñ… Ñ‚ĞµÑÑ‚Ğ¾Ğ² | 26 |
| Ğ’ÑĞµĞ³Ğ¾ Ñ‚ĞµÑÑ‚Ğ¾Ğ² Flask | 72 |

---

**â† [Episode 56: Query Cache](56_query_cache.md)** | **[Episode 58: Content Management](58_content_management.md) â†’**
