# üéôÔ∏è Audio Analysis Architecture

> –ö–∞–∫ Gemini –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∞—É–¥–∏–æ –≤ —Ç–µ–∫—Å—Ç –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞

---

## üìå –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?

**GeminiAudioAnalyzer** ‚Äî –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞ –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ Gemini API:

1. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—É—Ç—å –∫ –∞—É–¥–∏–æ-—Ñ–∞–π–ª—É
2. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –¥–æ 32kbps mono OGG
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç inline –≤ Gemini
4. –ü–æ–ª—É—á–∞–µ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

–†–µ–∑—É–ª—å—Ç–∞—Ç: —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ –¥–ª—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞.

---

## üéØ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–¥–∫–∞—Å—Ç—ã, –ª–µ–∫—Ü–∏–∏, –≤—Å—Ç—Ä–µ—á–∏ ‚Äî –≤—Å—ë —ç—Ç–æ –∞—É–¥–∏–æ, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–µ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞.

**–†–µ—à–µ–Ω–∏–µ**: Gemini —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç –∞—É–¥–∏–æ –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç:

- **–ü–æ–ª–Ω—É—é —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é** (–¥–ª—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- **–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ** (summary)
- **–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞** (–¥–ª—è FTS5)
- **–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤** (–µ—Å–ª–∏ —É–ø–æ–º–∏–Ω–∞—é—Ç—Å—è)
- **Action items** (–∑–∞–¥–∞—á–∏ –∏–∑ –æ–±—Å—É–∂–¥–µ–Ω–∏—è)

---

## üßÆ –≠–∫–æ–Ω–æ–º–∏–∫–∞: 83 –º–∏–Ω—É—Ç—ã –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ

### –ü—Ä–æ–±–ª–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤

Gemini inline upload –æ–≥—Ä–∞–Ω–∏—á–µ–Ω **20 MB**. –ë–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

| –§–æ—Ä–º–∞—Ç | –ë–∏—Ç—Ä–µ–π—Ç | 20 MB —Ö–≤–∞—Ç–∏—Ç –Ω–∞ |
|--------|---------|-----------------|
| WAV (CD) | 1411 kbps | ~2 –º–∏–Ω—É—Ç—ã |
| MP3 192 | 192 kbps | ~14 –º–∏–Ω—É—Ç |
| MP3 128 | 128 kbps | ~21 –º–∏–Ω—É—Ç—É |

**–≠—Ç–æ–≥–æ –º–∞–ª–æ** –¥–ª—è –ø–æ–¥–∫–∞—Å—Ç–∞ –∏–ª–∏ –ª–µ–∫—Ü–∏–∏.

---

### –†–µ—à–µ–Ω–∏–µ: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –ó–∞—á–µ–º |
|----------|----------|-------|
| –ë–∏—Ç—Ä–µ–π—Ç | 32 kbps | 20 MB / (32000/8) = **5000 —Å–µ–∫** |
| –ö–∞–Ω–∞–ª—ã | Mono | Gemini –Ω–µ —Ä–∞–∑–ª–∏—á–∞–µ—Ç —Å—Ç–µ—Ä–µ–æ |
| Sample rate | 16 kHz | –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ä–µ—á–∏ |
| –ö–æ–¥–µ–∫ | libvorbis (OGG) | –õ—É—á—à–µ MP3 –Ω–∞ –Ω–∏–∑–∫–∏—Ö –±–∏—Ç—Ä–µ–π—Ç–∞—Ö |

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 20 MB –≤–º–µ—â–∞–µ—Ç **83 –º–∏–Ω—É—Ç—ã** –∞—É–¥–∏–æ!

---

### –ü–æ—á–µ–º—É 32 kbps –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ?

```mermaid
graph LR
    A[CD Quality<br/>44.1kHz stereo] --> B[–¢–µ–ª–µ—Ñ–æ–Ω<br/>16kHz mono]
    B --> C[Gemini<br/>–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è]
    
    style B fill:#90EE90
```

- Gemini –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç **—Å–º—ã—Å–ª —Ä–µ—á–∏**, –∞ –Ω–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞
- 16 kHz ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∏–∏, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –¥–µ—Å—è—Ç–∏–ª–µ—Ç–∏—è–º–∏
- –ü–æ—Ç–µ—Ä–∏ –ø—Ä–∏ —Å–∂–∞—Ç–∏–∏ **–Ω–µ –≤–ª–∏—è—é—Ç** –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏

---

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

```mermaid
sequenceDiagram
    participant App as –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    participant Analyzer as GeminiAudioAnalyzer
    participant Utils as audio.py
    participant Gemini as Gemini API
    
    App->>Analyzer: analyze(MediaRequest)
    Analyzer->>Utils: optimize_audio_to_bytes()
    Utils-->>Analyzer: bytes (32kbps OGG)
    Analyzer->>Analyzer: –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–º–ø—Ç + –∫–æ–Ω—Ç–µ–∫—Å—Ç
    Analyzer->>Gemini: generate_content(audio + prompt)
    Note over Gemini: response_schema = AudioAnalysisSchema
    Gemini-->>Analyzer: JSON {transcription, keywords, ...}
    Analyzer-->>App: MediaAnalysisResult
```

---

## üì¶ Structured Output

### –°—Ö–µ–º–∞ –æ—Ç–≤–µ—Ç–∞

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `transcription` | string | –ü–æ–ª–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Ä–µ—á–∏ |
| `description` | string | –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ (2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) |
| `keywords` | array[string] | 5-10 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ |
| `participants` | array[string] | –ò–º–µ–Ω–∞ —Å–ø–∏–∫–µ—Ä–æ–≤ (–µ—Å–ª–∏ —É–ø–æ–º–∏–Ω–∞—é—Ç—Å—è) |
| `action_items` | array[string] | –ó–∞–¥–∞—á–∏ –∏ follow-up –ø—É–Ω–∫—Ç—ã |

### –ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```json
{
  "transcription": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –°–µ–≥–æ–¥–Ω—è –æ–±—Å—É–∂–¥–∞–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞...",
  "description": "–ó–∞–ø–∏—Å—å –≤—Å—Ç—Ä–µ—á–∏ –ø–æ –æ–±—Å—É–∂–¥–µ–Ω–∏—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø–æ–∏—Å–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã",
  "keywords": ["—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫", "—ç–º–±–µ–¥–¥–∏–Ω–≥–∏", "SQLite", "Gemini"],
  "participants": ["–í–ª–∞–¥–∏–º–∏—Ä", "–ò–≤–∞–Ω"],
  "action_items": ["–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –ë–î", "–ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã"]
}
```

---

## ‚öôÔ∏è –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏

| –ú–æ–¥–µ–ª—å | –¶–µ–Ω–∞ (1M —Ç–æ–∫–µ–Ω–æ–≤) | –ö–∞—á–µ—Å—Ç–≤–æ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|--------|-------------------|----------|--------------|
| `gemini-2.5-flash-lite` | $0.02 | ‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ | **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é** |
| `gemini-2.5-flash` | $0.10 | ‚úÖ‚úÖ –•–æ—Ä–æ—à–æ | –°–ª–æ–∂–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç |
| `gemini-2.5-pro` | $1.25 | ‚úÖ‚úÖ‚úÖ –û—Ç–ª–∏—á–Ω–æ | –†–µ–¥–∫–æ –Ω—É–∂–µ–Ω |

**–ü–æ—á–µ–º—É flash-lite?**

- –í **4x –¥–µ—à–µ–≤–ª–µ** –æ–±—ã—á–Ω–æ–≥–æ Flash
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è ‚Äî –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞
- –ö–∞—á–µ—Å—Ç–≤–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ–µ

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Gemini Audio | Whisper API | Whisper Local |
|----------|--------------|-------------|---------------|
| –°—Ç–æ–∏–º–æ—Å—Ç—å | $0.02/1M —Ç–æ–∫–µ–Ω–æ–≤ | $0.006/–º–∏–Ω | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ |
| –°–∫–æ—Ä–æ—Å—Ç—å | ~0.5x realtime | ~0.3x realtime | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç GPU |
| –ö–∞—á–µ—Å—Ç–≤–æ RU | ‚úÖ –û—Ç–ª–∏—á–Ω–æ | ‚úÖ –û—Ç–ª–∏—á–Ω–æ | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| Structured output | ‚úÖ Native | ‚ùå –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç | ‚ùå –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç |
| Keywords/summary | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç |
| –õ–∏–º–∏—Ç –¥–ª–∏–Ω—ã | 83 –º–∏–Ω inline | 25 MB | –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω |

**–í—ã–≤–æ–¥**: Gemini –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç –ø–æ structured output –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–µ.

---

## üéµ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

| –§–æ—Ä–º–∞—Ç | MIME-—Ç–∏–ø | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ |
|--------|----------|-----------|
| MP3 | audio/mpeg | ‚úÖ |
| WAV | audio/wav | ‚úÖ |
| OGG | audio/ogg | ‚úÖ |
| FLAC | audio/flac | ‚úÖ |
| AAC | audio/aac | ‚úÖ |
| M4A | audio/x-m4a | ‚úÖ |
| WebM | audio/webm | ‚úÖ |

**–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è**: –õ—é–±–æ–π —Ñ–æ—Ä–º–∞—Ç ‚Üí OGG 32kbps mono.

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

### 1. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç FFmpeg

–ê—É–¥–∏–æ-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç **ffmpeg** –≤ —Å–∏—Å—Ç–µ–º–µ:

```bash
# macOS
brew install ffmpeg

# Ubuntu/Debian
apt install ffmpeg
```

–ë–µ–∑ ffmpeg: `DependencyError` —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ.

---

### 2. –Ø–∑—ã–∫–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

Gemini –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —è–∑—ã–∫. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:

- –†—É—Å—Å–∫–∏–π ‚úÖ
- –ê–Ω–≥–ª–∏–π—Å–∫–∏–π ‚úÖ
- –°–º–µ—à–∞–Ω–Ω–∞—è —Ä–µ—á—å ‚úÖ

**–°–æ–≤–µ—Ç**: –ï—Å–ª–∏ —è–∑—ã–∫ –∏–∑–≤–µ—Å—Ç–µ–Ω, –¥–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç:

```python
request = MediaRequest(
    resource=resource,
    context_text="–Ø–∑—ã–∫: —Ä—É—Å—Å–∫–∏–π. –¢–µ–º–∞: –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ."
)
```

---

### 3. –¢–∏—à–∏–Ω–∞ –∏ —à—É–º

Gemini –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:

- –¢–∏—à–∏–Ω—É (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—É—é —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é)
- –§–æ–Ω–æ–≤—ã–π —à—É–º (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç)
- –ú—É–∑—ã–∫—É –±–µ–∑ —Ä–µ—á–∏ (–æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫–∞–∫ –º—É–∑—ã–∫—É)

---

### 4. –î–ª–∏–Ω–Ω–æ–µ –∞—É–¥–∏–æ (>83 –º–∏–Ω)

–î–ª—è –∞—É–¥–∏–æ –¥–ª–∏–Ω–Ω–µ–µ 83 –º–∏–Ω—É—Ç:

1. **File Upload API** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä Gemini
2. **–ù–∞—Ä–µ–∑–∫–∞** ‚Äî —Ä–∞–∑–±–∏—Ç—å –Ω–∞ —á–∞—Å—Ç–∏ –∏ —Å–∫–ª–µ–∏—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: —Ç–æ–ª—å–∫–æ inline (–¥–æ 83 –º–∏–Ω).

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **–ü—Ä–µ–¥—ã–¥—É—â–∏–π**: [Media Queue Processor](29_media_queue_processor.md)
- **–°–ª–µ–¥—É—é—â–∏–π**: [Video Multimodal Analysis](31_video_multimodal_analysis.md)
- **Resilience**: [Resilience Patterns](27_resilience_patterns.md)

---

**‚Üê [Media Queue Processor](29_media_queue_processor.md)** | **[Video Multimodal Analysis](31_video_multimodal_analysis.md) ‚Üí**
