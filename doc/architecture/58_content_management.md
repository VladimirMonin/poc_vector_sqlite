# ğŸ“¤ Episode 58: Content Management Architecture

> Drag-n-Drop Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸ Ğ² Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞµ

---

## ğŸ¯ Ğ§Ñ‚Ğ¾ Ğ¼Ñ‹ ÑÑ‚Ñ€Ğ¾Ğ¸Ğ¼?

**Content Management** â€” Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°, Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Drag-n-Drop Zone                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚         â˜ï¸ ĞŸĞµÑ€ĞµÑ‚Ğ°Ñ‰Ğ¸Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ ÑÑĞ´Ğ°                        â”‚   â”‚
â”‚  â”‚              Ğ¸Ğ»Ğ¸ Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ°                     â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚         [ğŸ“ Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»Ñ‹]                              â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:                                              â”‚
â”‚  â”œâ”€â”€ ğŸ“ architecture.md          12.5 KB                       â”‚
â”‚  â”œâ”€â”€ ğŸ–¼ï¸ diagram.png              45.2 KB                       â”‚
â”‚  â””â”€â”€ ğŸµ podcast.mp3              2.1 MB                        â”‚
â”‚                                                                 â”‚
â”‚  [â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ— ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Flask App                               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ingest_bp   â”‚â”€â”€â”€â–¶â”‚UploadService  â”‚â”€â”€â”€â–¶â”‚ SemanticCore â”‚    â”‚
â”‚  â”‚  Blueprint   â”‚    â”‚ save + UUID   â”‚    â”‚   ingest()   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                   â”‚                                   â”‚
â”‚         â”‚                   â–¼                                   â”‚
â”‚         â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚         â”‚           â”‚   uploads/    â”‚                          â”‚
â”‚         â”‚           â”‚ {uuid}_{name} â”‚                          â”‚
â”‚         â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      Templates                            â”‚ â”‚
â”‚  â”‚  ingest.html â”€â”€â–¶ documents.html                          â”‚ â”‚
â”‚  â”‚  (upload)        (list + manage)                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ UploadService

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      UploadService                              â”‚
â”‚                                                                 â”‚
â”‚   save_file(file_data, original_name)                          â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”œâ”€â”€â”€ _is_allowed_extension() â† Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ               â”‚
â”‚         â”‚         â”‚                                             â”‚
â”‚         â”‚         â”œâ”€â”€ .md, .markdown, .txt âœ“                   â”‚
â”‚         â”‚         â”œâ”€â”€ .png, .jpg, .gif, .webp âœ“                â”‚
â”‚         â”‚         â”œâ”€â”€ .mp3, .wav, .ogg âœ“                       â”‚
â”‚         â”‚         â”œâ”€â”€ .mp4, .webm âœ“                            â”‚
â”‚         â”‚         â””â”€â”€ .exe, .dll, .bat âœ—                       â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”œâ”€â”€â”€ _generate_uuid_name()                             â”‚
â”‚         â”‚         â”‚                                             â”‚
â”‚         â”‚         â””â”€â”€ "abc123_{original_name}"                 â”‚
â”‚         â”‚                                                       â”‚
â”‚         â””â”€â”€â”€ write to uploads/                                 â”‚
â”‚                   â”‚                                             â”‚
â”‚                   â–¼                                             â”‚
â”‚             UploadResult                                        â”‚
â”‚               â”œâ”€â”€ success: bool                                â”‚
â”‚               â”œâ”€â”€ path: Path                                   â”‚
â”‚               â”œâ”€â”€ original_name: str                           â”‚
â”‚               â”œâ”€â”€ uuid_name: str                               â”‚
â”‚               â””â”€â”€ error: str | None                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### UUID-Ğ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

```python
def _generate_uuid_name(self, original_name: str) -> str:
    file_uuid = uuid.uuid4().hex[:8]  # 8 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
    safe_name = Path(original_name).name
    return f"{file_uuid}_{safe_name}"

# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:
# "readme.md"     â†’ "a1b2c3d4_readme.md"
# "image.png"     â†’ "e5f6g7h8_image.png"
# "../../hack.sh" â†’ "i9j0k1l2_hack.sh"  (path traversal Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°)
```

---

## ğŸ”„ Upload Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    POST multipart     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  /ingest/    â”‚
â”‚  (files[])  â”‚                       â”‚   upload     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ UploadServiceâ”‚
                                      â”‚  save_file() â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                        â”‚                        â”‚
                    â–¼                        â–¼                        â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚  .md file    â”‚         â”‚  .png file   â”‚         â”‚  .mp3 file   â”‚
             â”‚  â†’ uploads/  â”‚         â”‚  â†’ uploads/  â”‚         â”‚  â†’ uploads/  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚process_paths â”‚  â† ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑÑ‹Ğ»Ğ¾Ğº Ğ½Ğ° Ğ¼ĞµĞ´Ğ¸Ğ°
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ core.ingest()â”‚  â† mode=sync Ğ¸Ğ»Ğ¸ async
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚   redirect   â”‚  â†’ /documents
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ Sync/Async Mode

```python
ASYNC_THRESHOLD = 5  # Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

mode = "async" if len(markdown_files) >= ASYNC_THRESHOLD else "sync"
core.ingest(doc, mode=mode)
```

| ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ MD | Ğ ĞµĞ¶Ğ¸Ğ¼ | ĞŸĞ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ |
|--------------|-------|-----------|
| 1-4 Ñ„Ğ°Ğ¹Ğ»Ğ° | sync | Ğ¡Ñ€Ğ°Ğ·Ñƒ Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€ÑƒĞµÑ‚, Ğ¶Ğ´Ñ‘Ñ‚ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ |
| 5+ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² | async | Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ, Ñ„Ğ¾Ğ½Ğ¾Ğ²Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° |

---

## ğŸ“‹ Documents Page

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹                               [+ Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ          â”‚ Ğ§Ğ°Ğ½ĞºĞ¸      â”‚ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ   â”‚ Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Architecture.md   â”‚ 12 ğŸ“5 ğŸ’»3 â”‚ âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ² â”‚ ğŸ”„ ğŸ—‘ï¸     â”‚   â”‚
â”‚  â”‚ Tutorial.md       â”‚ 8  ğŸ“8     â”‚ âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ² â”‚ ğŸ”„ ğŸ—‘ï¸     â”‚   â”‚
â”‚  â”‚ Guide.md          â”‚ 15 ğŸ“10 ğŸ–¼3â”‚ â³ (2)   â”‚ ğŸ”„ ğŸ—‘ï¸     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Ğ’ÑĞµĞ³Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²: 3                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ñ‡Ğ°Ğ½ĞºĞ¾Ğ²

```python
def _get_document_stats(doc_id: int) -> dict:
    stats = {
        "total": 0,
        "text": 0,      # ğŸ“
        "code": 0,      # ğŸ’»
        "image": 0,     # ğŸ–¼ï¸
        "audio": 0,     # ğŸµ
        "pending": 0,   # â³
    }
    
    for chunk in ChunkModel.select().where(...):
        stats["total"] += 1
        # ... Ğ¿Ğ¾Ğ´ÑÑ‡Ñ‘Ñ‚ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°Ğ¼
        if chunk.embedding_status == "pending":
            stats["pending"] += 1
    
    return stats
```

---

## ğŸ”— API Endpoints

| Endpoint | Method | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|--------|------------|
| `/ingest` | GET | Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ (drag-n-drop) |
| `/ingest/upload` | POST | Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² (multipart) |
| `/documents` | GET | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² |
| `/documents/<id>/delete` | POST | Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ (HTMX) |
| `/documents/<id>/reindex` | POST | ĞŸĞµÑ€ĞµĞ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ |

### HTMX Delete

```html
<button 
    hx-post="/documents/{{ doc.id }}/delete"
    hx-target="#doc-row-{{ doc.id }}"
    hx-swap="outerHTML"
    hx-confirm="Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚?"
>
    ğŸ—‘ï¸
</button>
```

ĞŸÑ€Ğ¸ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ¼ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞµÑ€Ğ²ĞµÑ€ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ â†’ ÑÑ‚Ñ€Ğ¾ĞºĞ° Ğ¸ÑÑ‡ĞµĞ·Ğ°ĞµÑ‚.

---

## ğŸ“ Path Resolution

ĞšĞ¾Ğ³Ğ´Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ MD + Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ²Ğ¼ĞµÑÑ‚Ğµ:

```markdown
<!-- Ğ‘Ñ‹Ğ»Ğ¾ Ğ² Ñ„Ğ°Ğ¹Ğ»Ğµ -->
![diagram](images/architecture.png)

<!-- Ğ¡Ñ‚Ğ°Ğ»Ğ¾ Ğ¿Ğ¾ÑĞ»Ğµ upload -->
![diagram](/uploads/a1b2c3d4_architecture.png)
```

```python
def process_markdown_paths(self, md_path, uploaded_files):
    # ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½: ![alt](path) Ğ¸Ğ»Ğ¸ [text](path)
    pattern = r"(!?\[.*?\])\(((?!http)[^)]+)\)"
    
    def replace_path(match):
        filename = Path(match.group(2)).name
        if filename in uploaded_files:
            return f"{match.group(1)}({uploaded_files[filename]})"
        return match.group(0)
    
    return re.sub(pattern, replace_path, content)
```

---

## ğŸ¨ UI ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

### Drag-n-Drop Zone

```javascript
dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('bg-primary', 'bg-opacity-10');
});

dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    fileInput.files = e.dataTransfer.files;
    updateFileList(files);
});
```

### File Icons

```javascript
const icons = {
    'md': 'bi-markdown',
    'png': 'bi-image',
    'jpg': 'bi-image',
    'mp3': 'bi-music-note',
    'mp4': 'bi-camera-video',
};
```

---

## ğŸ§ª Ğ¢ĞµÑÑ‚Ñ‹

**21 Ñ‚ĞµÑÑ‚ Ğ² `test_ingest.py`:**

```
TestUploadService
â”œâ”€â”€ test_init_creates_directory
â”œâ”€â”€ test_save_file_success
â”œâ”€â”€ test_save_file_content_preserved
â”œâ”€â”€ test_save_file_disallowed_extension
â”œâ”€â”€ test_save_file_allowed_extensions
â”œâ”€â”€ test_uuid_name_unique
â”œâ”€â”€ test_delete_file_success
â”œâ”€â”€ test_delete_file_not_found
â”œâ”€â”€ test_list_files
â””â”€â”€ test_process_markdown_paths

TestIngestRoutes
â”œâ”€â”€ test_upload_page_loads
â”œâ”€â”€ test_upload_page_without_core
â”œâ”€â”€ test_documents_page_loads
â”œâ”€â”€ test_documents_page_empty
â”œâ”€â”€ test_upload_no_files
â”œâ”€â”€ test_upload_with_file
â””â”€â”€ test_delete_document_without_core

TestUploadResult
â”œâ”€â”€ test_success_result
â””â”€â”€ test_error_result

TestIngestIntegration
â”œâ”€â”€ test_upload_creates_file_on_disk
â””â”€â”€ test_multiple_files_upload
```

---

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

```
examples/flask_app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ main.py
â”‚   â”‚   â”œâ”€â”€ search.py
â”‚   â”‚   â””â”€â”€ ingest.py        â† NEW
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ cache_service.py
â”‚   â”‚   â”œâ”€â”€ search_service.py
â”‚   â”‚   â””â”€â”€ upload_service.py  â† NEW
â”‚   â””â”€â”€ templates/
â”‚       â”œâ”€â”€ ingest.html       â† NEW
â”‚       â””â”€â”€ documents.html    â† NEW
â”œâ”€â”€ instance/
â”‚   â””â”€â”€ uploads/              â† Runtime (gitignored)
â””â”€â”€ tests/
    â””â”€â”€ test_ingest.py        â† NEW
```

---

## ğŸ”’ Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

| Ğ£Ğ³Ñ€Ğ¾Ğ·Ğ° | Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° |
|--------|--------|
| Path Traversal | `Path(name).name` â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ğ¼Ñ Ñ„Ğ°Ğ¹Ğ»Ğ° |
| ĞĞ¿Ğ°ÑĞ½Ñ‹Ğµ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ | Whitelist ALLOWED_EXTENSIONS |
| ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑÑŒ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² | UUID-Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑ Ğ´ĞµĞ»Ğ°ĞµÑ‚ Ğ¸Ğ¼ĞµĞ½Ğ° ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ |
| XSS Ñ‡ĞµÑ€ĞµĞ· Ğ¸Ğ¼Ñ Ñ„Ğ°Ğ¹Ğ»Ğ° | Jinja2 auto-escape |

---

## ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Phase 12.3

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|---------|----------|
| ĞĞ¾Ğ²Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² | 5 |
| Ğ¡Ñ‚Ñ€Ğ¾Ğº ĞºĞ¾Ğ´Ğ° | ~800 |
| ĞĞ¾Ğ²Ñ‹Ñ… Ñ‚ĞµÑÑ‚Ğ¾Ğ² | 21 |
| Ğ’ÑĞµĞ³Ğ¾ Ñ‚ĞµÑÑ‚Ğ¾Ğ² Flask | 93 |

---

**â† [Episode 57: Search Interface](57_search_interface.md)** | **[Episode 59: RAG Chat Interface](59_rag_chat_interface.md) â†’**
