–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ **–§–∞–∑—ã 4: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ü–∞—Ä—Å–∏–Ω–≥ –∏ –ö–æ–Ω—Ç–µ–∫—Å—Ç**.

–¶–µ–ª—å —ç—Ç–∞–ø–∞ ‚Äî –Ω–∞—É—á–∏—Ç—å —Å–∏—Å—Ç–µ–º—É ¬´–ø–æ–Ω–∏–º–∞—Ç—å¬ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É Markdown-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–∏–µ—Ä–∞—Ä—Ö–∏—é –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –±–ª–æ–∫–∏ –∫–æ–¥–∞, —Å—Å—ã–ª–∫–∏ –Ω–∞ –º–µ–¥–∏–∞), –æ—Ç–∫–∞–∑–∞–≤—à–∏—Å—å –æ—Ç –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è —Ç–µ–∫—Å—Ç–∞ –∫–∞–∫ –ø–ª–æ—Å–∫–æ–π —Å—Ç—Ä–æ–∫–∏. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏—Ç –≤—ã—Å–æ–∫—É—é —Ç–æ—á–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ (¬´–ù–∞–π—Ç–∏ —Ä–∞–∑–¥–µ–ª –ø—Ä–æ –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–µ—Ä–≤–µ—Ä–∞¬ª) –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç –ø–æ—á–≤—É –¥–ª—è –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç–∏.

-----

### üó∫Ô∏è –û–±—â–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –§–∞–∑—ã 4

–ú—ã –≤–Ω–µ–¥—Ä—è–µ–º **AST-based –ø–æ–¥—Ö–æ–¥** (Abstract Syntax Tree). –í–º–µ—Å—Ç–æ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π –º—ã –±—É–¥–µ–º —Å—Ç—Ä–æ–∏—Ç—å –¥–µ—Ä–µ–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞, –æ–±—Ö–æ–¥–∏—Ç—å –µ–≥–æ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–µ–≥–º–µ–Ω—Ç—ã, –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏.

#### –ù–æ–≤—ã–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏

1. **ParsingSegment (DTO):** –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –æ–±—ä–µ–∫—Ç –º–µ–∂–¥—É ¬´—Å—ã—Ä—ã–º¬ª —Ç–µ–∫—Å—Ç–æ–º –∏ –≥–æ—Ç–æ–≤—ã–º –ß–∞–Ω–∫–æ–º. –°–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç, —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (—Ç–µ–∫—Å—Ç/–∫–æ–¥) –∏ ¬´—Ö–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏¬ª (–ø—É—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤).
2. **AssetReference (DTO):** –û–±—ä–µ–∫—Ç-—Å—Å—ã–ª–∫–∞ –Ω–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã–π –º–µ–¥–∏–∞-—Ñ–∞–π–ª (–ø—É—Ç—å, —Ç–∏–ø, alt-—Ç–µ–∫—Å—Ç), –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è –∫ —Å–µ–≥–º–µ–Ω—Ç—É.

-----

### üì¶ 1. –ú–æ–¥—É–ª—å –ü–∞—Ä—Å–∏–Ω–≥–∞ (`processing/parsers`)

–°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –≤ –ø–æ—Ç–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤.

#### –ê. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `markdown-it-py` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ –¥–ª—è Python, –±—ã—Å—Ç—Ä—ã–π, —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–π, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ CommonMark).

#### –ë. –ö–ª–∞—Å—Å `MarkdownNodeParser` (–†–µ–∞–ª–∏–∑–∞—Ü–∏—è)

–≠—Ç–æ ¬´–º–æ–∑–≥¬ª —Ñ–∞–∑—ã. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ —Å —Ç–µ–∫—Å—Ç–æ–º, –∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏ AST.

**–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:**

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞. –°–æ–∑–¥–∞–µ—Ç –ø—É—Å—Ç–æ–π **–°—Ç–µ–∫ –ö–æ–Ω—Ç–µ–∫—Å—Ç–∞** (—Å–ø–∏—Å–æ–∫ —Ç–µ–∫—É—â–∏—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤).
2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤:** –ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç Markdown –≤ –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ —Ç–æ–∫–µ–Ω–æ–≤ (–æ—Ç–∫—Ä—ã–≤–∞—é—â–∏–µ/–∑–∞–∫—Ä—ã–≤–∞—é—â–∏–µ —Ç–µ–≥–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã, –±–ª–æ–∫–∏ –∫–æ–¥–∞).
3. **–û–±—Ö–æ–¥ (Traversal):**
      * **–í—Ö–æ–¥ –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ (Heading Open):** –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å (H1-H6). –û–±—Ä–µ–∑–∞–µ—Ç –°—Ç–µ–∫ –ö–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–æ —É—Ä–æ–≤–Ω—è `level - 1`. –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ —Å—Ç–µ–∫.
      * **–ü–∞—Ä–∞–≥—Ä–∞—Ñ (Paragraph):** –°–æ–±–∏—Ä–∞–µ—Ç —Ç–µ–∫—Å—Ç. –°–æ–∑–¥–∞–µ—Ç `ParsingSegment`, –ø—Ä–∏–∫—Ä–µ–ø–ª—è—è –∫ –Ω–µ–º—É —Ç–µ–∫—É—â—É—é –∫–æ–ø–∏—é –°—Ç–µ–∫–∞ –ö–æ–Ω—Ç–µ–∫—Å—Ç–∞.
      * **–ë–ª–æ–∫ –∫–æ–¥–∞ (Fence/Code Block):** –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —è–∑—ã–∫ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω). –°–æ–∑–¥–∞–µ—Ç —Å–µ–≥–º–µ–Ω—Ç —Å —Ç–∏–ø–æ–º `CODE`. –ü–æ–º–µ—á–∞–µ—Ç –µ–≥–æ —Ñ–ª–∞–≥–æ–º `atomic` (–Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —Ä–∞–∑—Ä—ã–≤–∞—Ç—å).
      * **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ/–ú–µ–¥–∏–∞ (Image Token):**
          * –ù–µ —Å–∫–∞—á–∏–≤–∞–µ—Ç –∏ –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ñ–∞–π–ª.
          * –ò–∑–≤–ª–µ–∫–∞–µ—Ç `src` (–ø—É—Ç—å) –∏ `alt` (–æ–ø–∏—Å–∞–Ω–∏–µ).
          * –°–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç `AssetReference`.
          * –î–æ–±–∞–≤–ª—è–µ—Ç —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç –≤ —Å–ø–∏—Å–æ–∫ `assets` —Ç–µ–∫—É—â–µ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ (–∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ–≥–º–µ–Ω—Ç-–∫—Ä—é—á–æ–∫, –µ—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å—Ç–æ–∏—Ç –æ—Ç–¥–µ–ª—å–Ω–æ).

#### –í. –õ–æ–≥–∏–∫–∞ –°–ø–ª–∏—Ç—Ç–µ—Ä–∞ (`MarkdownSplitter`)

–≠—Ç–æ—Ç –∫–ª–∞—Å—Å —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `MarkdownNodeParser`, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–µ–∂–µ—Ç —Å—Ç—Ä–æ–∫—É.

**–õ–æ–≥–∏–∫–∞:**

1. –ü–æ–ª—É—á–∞–µ—Ç –æ—Ç –ø–∞—Ä—Å–µ—Ä–∞ –ø–æ—Ç–æ–∫ `ParsingSegment` (–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –±–ª–æ–∫–æ–≤).
2. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞:** –ü—ã—Ç–∞–µ—Ç—Å—è –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –º–µ–ª–∫–∏–µ —Å–æ—Å–µ–¥–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ—Ä–æ—Ç–∫–∏–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã –ø–æ–¥ –æ–¥–Ω–∏–º –∑–∞–≥–æ–ª–æ–≤–∫–æ–º), –ø–æ–∫–∞ –∏—Ö —Å—É–º–º–∞—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç `chunk_size`.
3. **–ù–∞—Ä–µ–∑–∫–∞ (Fallback):** –ï—Å–ª–∏ –æ–¥–∏–Ω –ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–µ–≥–º–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–≥—Ä–æ–º–Ω—ã–π –ø–∞—Ä–∞–≥—Ä–∞—Ñ) –±–æ–ª—å—à–µ `chunk_size`, –ø–µ—Ä–µ–¥–∞–µ—Ç –µ–≥–æ –≤ `SimpleSplitter` –¥–ª—è ¬´–∂–µ—Å—Ç–∫–æ–π¬ª –Ω–∞—Ä–µ–∑–∫–∏, –Ω–æ **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç** –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∞—Å—Å–µ—Ç—ã) –¥–ª—è –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏.
4. **–í—ã–≤–æ–¥:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ `Chunk`, –≥–¥–µ –≤ –ø–æ–ª–µ `metadata` –ª–µ–∂–∞—Ç:
      * `headers`: –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫ (–ø—É—Ç—å –∫ —Ä–∞–∑–¥–µ–ª—É).
      * `assets`: –°–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –º–µ–¥–∏–∞.
      * `is_code`: –ë—É–ª–µ–≤—ã–π —Ñ–ª–∞–≥.

-----

### üîó 2. –ú–æ–¥—É–ª—å –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ö–æ–Ω—Ç–µ–∫—Å—Ç–∞ (`processing/context`)

–ú—ã –∑–∞–º–µ–Ω—è–µ–º –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—É—é —Å–∫–ª–µ–π–∫—É –Ω–∞ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—É—é —Å–±–æ—Ä–∫—É –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –≤–µ–∫—Ç–æ—Ä–∞.

#### –ö–ª–∞—Å—Å `HierarchicalContextStrategy`

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ç–æ, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç –¥–ª—è –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ (Gemini).

**–õ–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞:**

1. **–ë–∞–∑–∞:** –ë–µ—Ä–µ—Ç —Ç–µ–∫—Å—Ç —á–∞–Ω–∫–∞.
2. **–•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏:** –ò–∑–≤–ª–µ–∫–∞–µ—Ç `headers` –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —á–∞–Ω–∫–∞. –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É –Ω–∞–≤–∏–≥–∞—Ü–∏–∏: `–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1 > –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ 2 > –°–µ–∫—Ü–∏—è 3`.
3. **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞ –ö–æ–¥–∞:** –ï—Å–ª–∏ –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö `is_code=True` –∏ —É–∫–∞–∑–∞–Ω —è–∑—ã–∫, –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–µ—Ñ–∏–∫—Å: `Context: Code Snippet (Python)`.
4. **–°–±–æ—Ä–∫–∞:**

    ```text
    Document: {–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞}
    Path: {–•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏}
    ---
    {–¢–µ–∫—Å—Ç —á–∞–Ω–∫–∞}
    ```

5. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç —É—Ö–æ–¥–∏—Ç –≤ `Embedder`. –í –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞) —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π `{–¢–µ–∫—Å—Ç —á–∞–Ω–∫–∞}`, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏.

-----

### üóÑÔ∏è 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –°–ª–æ—è –î–∞–Ω–Ω—ã—Ö (DTO –∏ Storage)

–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∫ —Ö—Ä–∞–Ω–µ–Ω–∏—é –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã —Ç–∞–±–ª–∏—Ü (–∏—Å–ø–æ–ª—å–∑—É–µ–º JSON-–ø–æ–ª—è).

1. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `Chunk` (DTO):**

      * –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ–ª–µ `metadata` (—Å–ª–æ–≤–∞—Ä—å) –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –æ—Ç –°–ø–ª–∏—Ç—Ç–µ—Ä–∞ –¥–æ –ê–¥–∞–ø—Ç–µ—Ä–∞ –ë–î.
      * –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `embedded_assets` (—Å–ø–∏—Å–æ–∫) –≤ DTO –¥–ª—è –±—É–¥—É—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–µ–¥–∏–∞.

2. **–ê–¥–∞–ø—Ç–µ—Ä Peewee (`PeeweeVectorStore`):**

      * –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —á–∞–Ω–∫–∞: –°–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç —Å–ª–æ–≤–∞—Ä—å `metadata` (–≤–∫–ª—é—á–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—é –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ —Å–ø–∏—Å–æ–∫ –∞—Å—Å–µ—Ç–æ–≤) –≤ JSON.
      * –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —ç—Ç–æ—Ç JSON –≤ –ø–æ–ª–µ `meta_json` —Ç–∞–±–ª–∏—Ü—ã `NoteChunk`.
      * **–í–∞–∂–Ω–æ:** –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤ –±—É–¥—É—â–µ–º –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —á–∞–Ω–∫–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏–≤ JSON, –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∏–∑ –∫–∞–∫–æ–π –≥–ª–∞–≤—ã —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç.

-----

### üéπ 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ü–∞–π–ø–ª–∞–π–Ω (`IngestionPipeline`)

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤.

**–õ–æ–≥–∏–∫–∞ `run(document)`:**

1. **Router:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞.
      * `.txt` -\> –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç `SimpleSplitter`.
      * `.md`, `.markdown` -\> –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç `MarkdownSplitter` (–Ω–∞—à –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å).
2. **Parsing & Splitting:** –í—ã–∑—ã–≤–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–ø–ª–∏—Ç—Ç–µ—Ä. –ù–∞ –≤—ã—Ö–æ–¥–µ –ø–æ–ª—É—á–∞–µ—Ç ¬´—É–º–Ω—ã–µ¬ª —á–∞–Ω–∫–∏ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏.
3. **Context Injection:** –ü—Ä–∏–º–µ–Ω—è–µ—Ç `HierarchicalContextStrategy`. –¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π —á–∞–Ω–∫ –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –≥–¥–µ –æ–Ω –Ω–∞—Ö–æ–¥–∏–ª—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ.
4. **Asset Registration (–ó–∞–¥–µ–ª –Ω–∞ –±—É–¥—É—â–µ–µ):**
      * –ü–∞–π–ø–ª–∞–π–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ —á–∞–Ω–∫–∞–º.
      * –ï—Å–ª–∏ –≤–∏–¥–∏—Ç –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –Ω–µ–ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ `assets`, –ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç: *¬´–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ X, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞)¬ª*.
      * –≠—Ç–æ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –§–∞–∑—ã 5 (–≥–¥–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ `MediaProcessor`).
5. **Vectorization & Storage:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å (Batch-—ç–º–±–µ–¥–¥–∏–Ω–≥ -\> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ SQLite).

-----

### ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –§–∞–∑—ã 4

–°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –æ—Ç ¬´—á—Ç–µ–Ω–∏—è —Å—Ç—Ä–æ–∫¬ª –∫ ¬´–ø–æ–Ω–∏–º–∞–Ω–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞¬ª.

1. **–¢–æ—á–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞:** –ó–∞–ø—Ä–æ—Å ¬´–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö¬ª –Ω–∞–π–¥–µ—Ç —Ç–µ–∫—Å—Ç ¬´–ø–æ—Ä—Ç: 5432¬ª, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω –ª–µ–∂–∏—Ç –≤–Ω—É—Ç—Ä–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö`, —Ö–æ—Ç—è –≤ —Å–∞–º–æ–º —Ç–µ–∫—Å—Ç–µ —ç—Ç–∏—Ö —Å–ª–æ–≤ –Ω–µ—Ç.
2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** –ö–æ–¥ –Ω–µ —Ä–≤–µ—Ç—Å—è. –¢–∞–±–ª–∏—Ü—ã Markdown –Ω–µ –ª–æ–º–∞—é—Ç—Å—è –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ.
3. **–ö–∞—Ä—Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:** –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–≤ JSON-–ø–æ–ª—è—Ö) —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞—Ä—Ç–∞ –≤—Å–µ—Ö –∫–∞—Ä—Ç–∏–Ω–æ–∫ –∏ –≤–∏–¥–µ–æ, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–∞—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫—É—Å–∫–∞–º —Ç–µ–∫—Å—Ç–∞. –ú—ã —Ç–æ—á–Ω–æ –∑–Ω–∞–µ–º, –∫ –∫–∞–∫–æ–º—É –∞–±–∑–∞—Ü—É –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ `schema.png`.
