–≠—Ç–æ –æ—Ç–ª–∏—á–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞** (¬´–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Å–µ—Ä–∏–∞–ª¬ª) –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ ‚Äî —ç—Ç–æ –≥–µ–Ω–∏–∞–ª—å–Ω—ã–π —Ö–æ–¥.

–ü–æ—á–µ–º—É?
1.  **–†–µ–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:** –≠—Ç–æ –Ω–µ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π `foo bar`, —ç—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–π Markdown —Å –≥–ª—É–±–æ–∫–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å—é, —Å–ª–æ–∂–Ω—ã–º–∏ —Å–ø–∏—Å–∫–∞–º–∏, –±–ª–æ–∫–∞–º–∏ –∫–æ–¥–∞ –Ω–∞ Python/Bash –∏ —Å—Å—ã–ª–∫–∞–º–∏.
2.  **Dogfooding:** –ú—ã —Ç–µ—Å—Ç–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º—É –Ω–∞ —Ç–æ–º –∫–æ–Ω—Ç–µ–Ω—Ç–µ, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–Ω–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è (–±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞).
3.  **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç:** –£ –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å 10+ —Ñ–∞–π–ª–æ–≤ `.md` —Å –∏–¥–µ–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä—Å–µ—Ä–∞.

–í–æ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω **–§–∞–∑—ã 4.1**, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞.

---

# üó∫Ô∏è Phase 4.1: Structural Testing & Stabilization

**–¶–µ–ª—å:** –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ "–ø–æ–Ω–∏–º–∞–µ—Ç" —Å–ª–æ–∂–Ω—ã–π Markdown, –Ω–µ —Ç–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–∑–æ–ª–∏—Ä—É–µ—Ç –∫–æ–¥ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–∫–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã.

---

### üìÇ 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¢–µ—Å—Ç–æ–≤—ã—Ö –î–∞–Ω–Ω—ã—Ö (`tests/fixtures`)

–ú—ã –Ω–µ –±—É–¥–µ–º –ø–∏—Å–∞—Ç—å Markdown-—Å—Ç—Ä–æ–∫–∏ –≤–Ω—É—Ç—Ä–∏ python-—Ñ–∞–π–ª–æ–≤. –ú—ã —Å–æ–∑–¥–∞–¥–∏–º –ø–∞–ø–∫—É —Å –∞—Å—Å–µ—Ç–∞–º–∏.

**–ê—Å—Å–µ—Ç `architecture_series`:**
–ö–æ–ø–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–µ –ø–ª–∞–Ω—ã (`doc/architecture/`) –≤ `tests/fixtures/architecture_series/`.
* **–ó–∞—á–µ–º:** –≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω—ã–π —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç. –¢–∞–º –µ—Å—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ H1-H3, —Å–ø–∏—Å–∫–∏, —Ü–∏—Ç–∞—Ç—ã –∏ –º–Ω–æ–≥–æ –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞.

**–ê—Å—Å–µ—Ç `edge_cases.md`:**
–°–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π "–∑–ª–æ–π" —Ñ–∞–π–ª, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π:
* –ü—É—Å—Ç—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏.
* –ë–ª–æ–∫–∏ –∫–æ–¥–∞ –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è —è–∑—ã–∫–∞.
* –ë–ª–æ–∫–∏ –∫–æ–¥–∞ –≤–Ω—É—Ç—Ä–∏ —Å–ø–∏—Å–∫–æ–≤.
* –ö–∞—Ä—Ç–∏–Ω–∫–∏ —Å –ø—É—Å—Ç—ã–º alt-—Ç–µ–∫—Å—Ç–æ–º.
* –†–µ–∑–∫—É—é —Å–º–µ–Ω—É —É—Ä–æ–≤–Ω—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (H1 -> H4).

---

### üß™ 2. Unit-—Ç–µ—Å—Ç—ã: –õ–æ–≥–∏–∫–∞ –ü–∞—Ä—Å–∏–Ω–≥–∞ (`tests/unit/processing`)

–ó–¥–µ—Å—å –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º `MarkdownNodeParser` –≤ –∏–∑–æ–ª—è—Ü–∏–∏.

#### **`test_markdown_ast.py`**
* **–¢–µ—Å—Ç –°—Ç–µ–∫–∞ (Hierarchy Tracking):**
    * –ü–∞—Ä—Å–∏–º `edge_cases.md`.
    * –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –æ—Ç H1 –∫ H2 —Å—Ç–µ–∫ —Ä–∞—Å—Ç–µ—Ç.
    * –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ –Ω–æ–≤–æ–≥–æ H1 —Å—Ç–µ–∫ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è.
    * *–ö—Ä–∏—Ç–µ—Ä–∏–π:* –ù–∏ –æ–¥–∏–Ω —á–∞–Ω–∫ –Ω–µ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö "—É–º–µ—Ä—à–∏–π" –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≥–ª–∞–≤—ã.
* **–¢–µ—Å—Ç –ò–∑–æ–ª—è—Ü–∏–∏ –ö–æ–¥–∞ (Code Fencing):**
    * –ü–∞—Ä—Å–∏–º —Ñ–∞–π–ª —Å –∫–æ–¥–æ–º.
    * –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –ø–∞—Ä—Å–µ—Ä –≤–µ—Ä–Ω—É–ª —Å–µ–≥–º–µ–Ω—Ç —Ç–∏–ø–∞ `CODE`.
    * –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∞ (`python`, `bash`) –∏–∑–≤–ª–µ—á–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
    * –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ–¥–∞ –Ω–µ –ø–æ–¥–≤–µ—Ä–≥–ª–æ—Å—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—é (–æ—Ç—Å—Ç—É–ø—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã).

#### **`test_smart_splitter.py`**
* **–¢–µ—Å—Ç –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:**
    * –ü–æ–¥–∞–µ–º –ø–æ—Ç–æ–∫ –∏–∑ 10 –º–µ–ª–∫–∏—Ö –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤ (—Å–ø–∏—Å–æ–∫).
    * –û–∂–∏–¥–∞–µ–º, —á—Ç–æ —Å–ø–ª–∏—Ç—Ç–µ—Ä —Å–∫–ª–µ–∏—Ç –∏—Ö –≤ –æ–¥–∏–Ω –∏–ª–∏ –¥–≤–∞ —á–∞–Ω–∫–∞, –∞ –Ω–µ —Å–æ–∑–¥–∞—Å—Ç 10 —á–∞–Ω–∫–æ–≤.
* **–¢–µ—Å—Ç –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏:**
    * –ü–æ–¥–∞–µ–º –æ–≥—Ä–æ–º–Ω—ã–π –∫—É—Å–æ–∫ —Ç–µ–∫—Å—Ç–∞ + –º–∞–ª–µ–Ω—å–∫–∏–π –±–ª–æ–∫ –∫–æ–¥–∞ + —Ç–µ–∫—Å—Ç.
    * –û–∂–∏–¥–∞–µ–º, —á—Ç–æ –±–ª–æ–∫ –∫–æ–¥–∞ –±—É–¥–µ—Ç –≤—ã–¥–µ–ª–µ–Ω –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —á–∞–Ω–∫, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–π (—á—Ç–æ–±—ã –Ω–µ —Å–º–µ—à–∏–≤–∞—Ç—å –∫–æ–¥ —Å –ø—Ä–æ–∑–æ–π).

#### **`test_context_strategy.py`**
* **–¢–µ—Å—Ç –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ü—Ä–æ–º–ø—Ç–∞:**
    * –ú–æ–∫–∏—Ä—É–µ–º —á–∞–Ω–∫ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ `headers=['Phase 4', 'Tests']`.
    * –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ `HierarchicalContextStrategy` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É, —Å–æ–¥–µ—Ä–∂–∞—â—É—é –ø—É—Ç—å `Phase 4 > Tests`.

---

### üîó 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¢–µ—Å—Ç—ã: –ë–î –∏ –ü–æ–∏—Å–∫ (`tests/integration`)

–ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å–≤—è–∑–∫–µ —Å SQLite.

#### **`test_granular_search.py` (–ù–æ–≤–æ–µ!)**
* **–°—Ü–µ–Ω–∞—Ä–∏–π:**
    1.  –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º `plan_phase_3.md` (–≥–¥–µ –µ—Å—Ç—å –∫–æ–¥ `SemanticIndex`).
    2.  –î–µ–ª–∞–µ–º –ø–æ–∏—Å–∫ `search_chunks("SemanticIndex class", type_filter="CODE")`.
    3.  **–û–∂–∏–¥–∞–Ω–∏–µ:**
        * –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å *—Ç–æ–ª—å–∫–æ* –±–ª–æ–∫ –∫–æ–¥–∞.
        * –í –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤.
    4.  –î–µ–ª–∞–µ–º –ø–æ–∏—Å–∫ —Ç–æ–≥–æ –∂–µ –∑–∞–ø—Ä–æ—Å–∞, –Ω–æ —Å `type_filter="TEXT"`.
    5.  **–û–∂–∏–¥–∞–Ω–∏–µ:** –ù–∞—Ö–æ–¥–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞, –Ω–æ –Ω–µ —Å–∞–º –∫–æ–¥.

#### **`test_metadata_persistence.py`**
* **–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ JSON-–ø–æ–ª—è –≤ SQLite —Ä–∞–±–æ—Ç–∞—é—Ç.
* **–î–µ–π—Å—Ç–≤–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–∞–Ω–∫ —Å –∞—Å—Å–µ—Ç–∞–º–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –ë–î.
* **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Å–ø–∏—Å–∫–∏ –æ—Å—Ç–∞–ª–∏—Å—å —Å–ø–∏—Å–∫–∞–º–∏, –∞ –Ω–µ –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª–∏—Å—å –≤ —Å—Ç—Ä–æ–∫–∏.

---

### üöÄ 4. End-to-End –¢–µ—Å—Ç: "Architectural Search"

–≠—Ç–æ –≥–ª–∞–≤–Ω—ã–π —Ç–µ—Å—Ç —Ñ–∞–∑—ã.

**–°—Ü–µ–Ω–∞—Ä–∏–π `test_e2e_architecture_docs.py`:**
1.  **Ingest:** –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å—é –ø–∞–ø–∫—É `tests/fixtures/real_docs` (–Ω–∞—à–∏ –ø–ª–∞–Ω—ã) —á–µ—Ä–µ–∑ –ü–∞–π–ø–ª–∞–π–Ω.
2.  **Query 1 (Context):** –ò—â–µ–º *"–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ –§–∞–∑—É 2?"*.
    * –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞–π—Ç–∏ —á–∞–Ω–∫–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö –≤ `headers` –µ—Å—Ç—å "–§–∞–∑–∞ 2".
3.  **Query 2 (Code):** –ò—â–µ–º *"–ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞ PeeweeAdapter"*.
    * –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞–π—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –±–ª–æ–∫ –∫–æ–¥–∞ python –∏–∑ –ø–ª–∞–Ω–∞.
4.  **Validation:** –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤ –ë–î –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–ª–æ—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ —á–∞–Ω–∫–æ–≤ (–Ω–µ 1 –∏ –Ω–µ 1000).

---

### üõ†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤ —Å—Ç–∞—Ä–æ–º?

1.  **`conftest.py`:**
    * –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–∫—Å—Ç—É—Ä—É `real_docs_path`, –∫–æ—Ç–æ—Ä–∞—è —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø–∞–ø–∫—É —Å –ø–ª–∞–Ω–∞–º–∏.
    * –û–±–Ω–æ–≤–∏—Ç—å `test_db`, —É–±–µ–¥–∏–≤—à–∏—Å—å, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `Chunk` –ø–æ–ª–µ `metadata` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∫–∞–∫ JSONField (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç).

2.  **–°—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç—ã (`test_search.py`):**
    * –ò—Ö –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ "Smoke Tests". –û–Ω–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç `SimpleSplitter`. –ù–∞–º –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ Markdown-–ª–æ–≥–∏–∫–∏ —Å—Ç–∞—Ä—ã–π "—Ç—É–ø–æ–π" —Ä–µ–∂–∏–º –Ω–µ —Å–ª–æ–º–∞–ª—Å—è.

### –ò—Ç–æ–≥ –ø–ª–∞–Ω–∞ 4.1

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º **—Ç–≤–æ–∏ –∂–µ –ø–ª–∞–Ω—ã** –∫–∞–∫ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ. –≠—Ç–æ:
1.  –°—ç–∫–æ–Ω–æ–º–∏—Ç –≤—Ä–µ–º—è –Ω–∞ –ø—Ä–∏–¥—É–º—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤.
2.  –°—Ä–∞–∑—É –ø–æ–∫–∞–∂–µ—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å —Ä–µ–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π.
3.  –ü–æ–∑–≤–æ–ª–∏—Ç –æ—Ç–ª–∞–¥–∏—Ç—å –ø–æ–∏—Å–∫ –∫–æ–¥–∞ (—Ç–∞–∫ –∫–∞–∫ –≤ –ø–ª–∞–Ω–∞—Ö –µ–≥–æ –º–Ω–æ–≥–æ).
