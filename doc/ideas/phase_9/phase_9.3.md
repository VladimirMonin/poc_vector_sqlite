# Phase 9.3: Slash Commands

**–°—Ç–∞—Ç—É—Å:** üî≤ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** Phase 9.0 ‚úÖ  
**–û—Ü–µ–Ω–∫–∞:** ~1 –¥–µ–Ω—å

---

## üéØ –¶–µ–ª—å

–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ slash-–∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–∏—Å–∫–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤, –º–µ–¥–∏–∞.

---

## üìã –í—Å–µ –∫–æ–º–∞–Ω–¥—ã

### –ë–∞–∑–æ–≤—ã–µ (9.0)

| –ö–æ–º–∞–Ω–¥–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `/help` | –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º |
| `/clear` | –û—á–∏—Å—Ç–∏—Ç—å —ç–∫—Ä–∞–Ω |
| `/quit`, `/q` | –í—ã—Ö–æ–¥ |

### –ö–æ–Ω—Ç–µ–∫—Å—Ç (9.1-9.2)

| –ö–æ–º–∞–Ω–¥–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `/tokens` | –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ |
| `/compress` | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∂–∞—Ç–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ |
| `/history` | –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é (–∫—Ä–∞—Ç–∫–æ) |

### –ü–æ–∏—Å–∫ (9.3)

| –ö–æ–º–∞–Ω–¥–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `/search <query>` | –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ, –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç |
| `/search-mode <mode>` | –°–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º: vector/fts/hybrid |
| `/sources` | –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ |
| `/source N` | –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ N |

### –§–∞–π–ª—ã (9.3)

| –ö–æ–º–∞–Ω–¥–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `/add <path>` | –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª –≤ RAG –±–∞–∑—É |
| `/refresh` | –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã |

### –ú–µ–¥–∏–∞ (9.3)

| –ö–æ–º–∞–Ω–¥–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `/image <path>` | –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç |
| `/audio <path>` | –ê–Ω–∞–ª–∏–∑ –∞—É–¥–∏–æ, –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç |

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (9.3)

| –ö–æ–º–∞–Ω–¥–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `/model` | –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –º–æ–¥–µ–ª—å |
| `/model <name>` | –°–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å |
| `/context <N>` | –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª-–≤–æ —á–∞–Ω–∫–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
semantic_core/cli/
‚îú‚îÄ‚îÄ commands/
‚îÇ   ‚îî‚îÄ‚îÄ chat.py
‚îî‚îÄ‚îÄ chat/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ session.py          # ChatSession
    ‚îî‚îÄ‚îÄ slash/
        ‚îú‚îÄ‚îÄ __init__.py
        ‚îú‚îÄ‚îÄ handler.py      # SlashCommandHandler
        ‚îú‚îÄ‚îÄ base.py         # BaseSlashCommand
        ‚îú‚îÄ‚îÄ search.py       # /search, /sources, /source
        ‚îú‚îÄ‚îÄ files.py        # /add, /refresh
        ‚îú‚îÄ‚îÄ media.py        # /image, /audio
        ‚îî‚îÄ‚îÄ settings.py     # /model, /context, /tokens
```

---

## üìê SlashCommandHandler

```python
# semantic_core/cli/chat/slash/handler.py

class SlashCommandHandler:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ slash-–∫–æ–º–∞–Ω–¥."""
    
    def __init__(self, session: ChatSession):
        self.session = session
        self.commands: dict[str, BaseSlashCommand] = {}
        self._register_defaults()
    
    def _register_defaults(self):
        self.register(HelpCommand())
        self.register(ClearCommand())
        self.register(SearchCommand())
        self.register(SourcesCommand())
        # ...
    
    def register(self, cmd: BaseSlashCommand):
        self.commands[cmd.name] = cmd
        for alias in cmd.aliases:
            self.commands[alias] = cmd
    
    def handle(self, input: str) -> bool:
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–º–∞–Ω–¥—É. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True –µ—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞."""
        if not input.startswith("/"):
            return False
        
        parts = input[1:].split(maxsplit=1)
        cmd_name = parts[0].lower()
        args = parts[1] if len(parts) > 1 else ""
        
        if cmd_name in self.commands:
            self.commands[cmd_name].execute(self.session, args)
            return True
        
        console.print(f"[yellow]Unknown command: /{cmd_name}[/]")
        return True
```

---

## üìê BaseSlashCommand

```python
# semantic_core/cli/chat/slash/base.py

class BaseSlashCommand(ABC):
    name: str
    description: str
    aliases: list[str] = []
    
    @abstractmethod
    def execute(self, session: ChatSession, args: str) -> None:
        pass
```

---

## üìê –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥

```python
# semantic_core/cli/chat/slash/search.py

class SearchCommand(BaseSlashCommand):
    name = "search"
    description = "Search knowledge base and add to context"
    
    def execute(self, session, args):
        if not args:
            console.print("[yellow]Usage: /search <query>[/]")
            return
        
        results = session.core.search(args, limit=3)
        if not results:
            console.print("[yellow]No results found[/]")
            return
        
        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
        context = "\n\n".join(r.content for r in results)
        session.add_to_context("search_results", context)
        
        console.print(f"[green]Added {len(results)} results to context[/]")


class SourcesCommand(BaseSlashCommand):
    name = "sources"
    description = "Show sources from last answer"
    aliases = ["src"]
    
    def execute(self, session, args):
        if not session.last_result:
            console.print("[yellow]No previous answer[/]")
            return
        
        table = Table(title="Sources")
        table.add_column("#")
        table.add_column("Source")
        table.add_column("Score")
        
        for i, src in enumerate(session.last_result.sources, 1):
            table.add_row(
                str(i),
                src.metadata.get("source", "unknown"),
                f"{src.score:.3f}"
            )
        
        console.print(table)
```

---

## üìê /image –∏ /audio

```python
# semantic_core/cli/chat/slash/media.py

class ImageCommand(BaseSlashCommand):
    name = "image"
    description = "Analyze image and add to context"
    
    def execute(self, session, args):
        path = Path(args.strip())
        if not path.exists():
            console.print(f"[red]File not found: {path}[/]")
            return
        
        with console.status("üñºÔ∏è Analyzing image..."):
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ImageAnalyzer
            analyzer = session.get_image_analyzer()
            result = analyzer.analyze(path)
        
        session.add_to_context("image_analysis", result.description)
        console.print(f"[green]Image analyzed and added to context[/]")
```

---

## ‚úÖ Acceptance Criteria

- [ ] `/help` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
- [ ] `/search` —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- [ ] `/sources` –∏ `/source N` —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] `/add` –¥–æ–±–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª –≤ –±–∞–∑—É
- [ ] `/image` –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- [ ] `/model` –º–µ–Ω—è–µ—Ç –º–æ–¥–µ–ª—å –Ω–∞ –ª–µ—Ç—É
- [ ] –ö–æ–º–∞–Ω–¥—ã —Ä–∞—Å—à–∏—Ä—è–µ–º—ã (BaseSlashCommand)

---

## ‚è±Ô∏è –û—Ü–µ–Ω–∫–∞

| –ó–∞–¥–∞—á–∞ | –ß–∞—Å—ã |
|--------|------|
| slash/handler.py + base.py | 1 |
| search.py (/search, /sources) | 1.5 |
| files.py (/add, /refresh) | 1.5 |
| media.py (/image, /audio) | 2 |
| settings.py (/model, /context) | 1 |
| –¢–µ—Å—Ç—ã | 2 |
| **–ò—Ç–æ–≥–æ** | **~9 —á–∞—Å–æ–≤** |
