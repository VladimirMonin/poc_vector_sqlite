–ß–ï–†–ù–û–í–ò–ö –ù–ê–î–û –î–£–ú–ê–¢–¨

---
–≠—Ç–æ –æ—á–µ–Ω—å –¥–∞–ª—å–Ω–æ–≤–∏–¥–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ. –¢—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤: –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á, —Ç–∞–∫–∏—Ö –∫–∞–∫ OCR –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–≥–¥–µ –≤–∞–∂–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –∏ —Ç–æ—á–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞), –≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ (Gemini Vision) –∏–Ω–æ–≥–¥–∞ –º–æ–≥—É—Ç –±—ã—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–º–∏ ("—Å—Ç—Ä–µ–ª—å–±–∞ –∏–∑ –ø—É—à–∫–∏ –ø–æ –≤–æ—Ä–æ–±—å—è–º") –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ—á–Ω—ã–º–∏ –≤ –ø–ª–∞–Ω–µ –≤–µ—Ä—Å—Ç–∫–∏.

–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–≤—Ä–æ–¥–µ DocTR, Tesseract, Surya, –∏–ª–∏ API —Ç–∏–ø–∞ Azure Document Intelligence) —á–∞—Å—Ç–æ —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å "—Å—É—Ö–æ–π" –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –ª—É—á—à–µ –∏ –¥–µ—à–µ–≤–ª–µ.

–ú—ã **–æ–±—è–∑–∞–Ω—ã** –∑–∞–ª–æ–∂–∏—Ç—å —ç—Ç–æ—Ç –≤—ã–±–æ—Ä –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –§–∞–∑—ã 6. –≠—Ç–æ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É –∏–∑ "–æ–±–µ—Ä—Ç–∫–∏ –Ω–∞–¥ Gemini" –≤ –Ω–∞—Å—Ç–æ—è—â–∏–π "Content Processing Hub".

–í–æ—Ç –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–π, –±–æ–ª–µ–µ –≥–∏–±–∫–∏–π –ø–ª–∞–Ω **–§–∞–∑—ã 6: –ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å –∏ OCR**.

-----

### üó∫Ô∏è –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –§–∞–∑—ã 6: "–°—Ç—Ä–∞—Ç–µ–≥–∏—è –í–æ—Å–ø—Ä–∏—è—Ç–∏—è" (Perception Strategy)

–ú—ã –æ—Ç–∫–∞–∑—ã–≤–∞–µ–º—Å—è –æ—Ç –∂–µ—Å—Ç–∫–æ–π –ø—Ä–∏–≤—è–∑–∫–∏ "–ö–∞—Ä—Ç–∏–Ω–∫–∞ = Gemini".
–ú—ã –≤–≤–æ–¥–∏–º –ø–æ–Ω—è—Ç–∏–µ **`VisionStrategy`**.

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–æ—É—Ç–µ—Ä) —Ä–µ—à–∞–µ—Ç, –∫–∞–∫ —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Ñ–∞–π–ª:

1.  **`GeneralDescription`**: "–û–ø–∏—à–∏, —á—Ç–æ –Ω–∞ —Ñ–æ—Ç–æ" (–§–æ—Ç–æ, –°–∫—Ä–∏–Ω—à–æ—Ç—ã UI, –î–∏–∞–≥—Ä–∞–º–º—ã). -\> **Gemini Flash**.
2.  **`DocumentStructure`**: "–í–µ—Ä–Ω–∏ –º–Ω–µ —Ç–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç –∏ —Ç–∞–±–ª–∏—Ü—ã" (–°–∫–∞–Ω—ã, PDF, –î–æ–≥–æ–≤–æ—Ä—ã). -\> **OCR Models** (Tesseract, DocTR, Surya, Gemini Document Mode).

-----

### üì¶ 1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (`interfaces/vision.py`)

–ù–∞–º –Ω—É–∂–µ–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –∏ –≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ, –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π OCR.

#### –ê. `VisionProvider` (ABC)

  * **–ú–µ—Ç–æ–¥ `process(image: ImageResource, prompt: str = None) -> VisionResult`**:
      * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç `VisionResult`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π:
          * `text`: –ü–æ–ª–Ω—ã–π –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ.
          * `structured_data`: (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) JSON —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –±–ª–æ–∫–æ–≤.
          * `provider_name`: –ö—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–ª ("gemini", "tesseract", "doctr").

#### –ë. –§–∞–±—Ä–∏–∫–∞ –°—Ç—Ä–∞—Ç–µ–≥–∏–π

–ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞ –ª–µ—Ç—É –º–µ–Ω—è—Ç—å –¥–≤–∏–∂–æ–∫.

  * `get_provider(strategy: str) -> VisionProvider`

-----

### ‚öôÔ∏è 2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ü—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (`infrastructure/media/vision`)

–ó–¥–µ—Å—å –º—ã —Å–æ–∑–¥–∞–µ–º –∞–¥–∞–ø—Ç–µ—Ä—ã –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ –¥–≤–∏–∂–∫–∏.

#### –í–∞—Ä–∏–∞–Ω—Ç –ê: `GeminiVisionProvider` (General Purpose)

  * **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –§–æ—Ç–æ, –°–∫—Ä–∏–Ω—à–æ—Ç—ã, –°–ª–æ–∂–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã.
  * **–õ–æ–≥–∏–∫–∞:** –®–ª–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É –≤ `gemini-2.0-flash`. –ü—Ä–æ–º–ø—Ç: *"–û–ø–∏—à–∏ –ø–æ–¥—Ä–æ–±–Ω–æ..."*.
  * **–ü–ª—é—Å—ã:** –ü–æ–Ω–∏–º–∞–µ—Ç —Å–º—ã—Å–ª, —Å–≤—è–∑–∏, –∫–æ–Ω—Ç–µ–∫—Å—Ç.
  * **–ú–∏–Ω—É—Å—ã:** –ú–æ–∂–µ—Ç "–≥–∞–ª–ª—é—Ü–∏–Ω–∏—Ä–æ–≤–∞—Ç—å" —Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ –µ–≥–æ –æ—á–µ–Ω—å –º–Ω–æ–≥–æ –∏ –æ–Ω –º–µ–ª–∫–∏–π.

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: `LocalOCRProvider` (Document Structure)

  * **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–∫–∞–Ω—ã, PDF, –¢–∞–±–ª–∏—Ü—ã.
  * **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–Ω–∞ –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è):**
      * *Tesseract:* –ö–ª–∞—Å—Å–∏–∫–∞, –±–µ—Å–ø–ª–∞—Ç–Ω–æ, –ª–æ–∫–∞–ª—å–Ω–æ.
      * *Surya / DocTR:* –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ Deep Learning OCR (–æ—á–µ–Ω—å –º–æ—â–Ω—ã–µ –¥–ª—è —Ç–∞–±–ª–∏—Ü).
  * **–õ–æ–≥–∏–∫–∞:**
    1.  –ó–∞–ø—É—Å–∫–∞–µ—Ç OCR –¥–≤–∏–∂–æ–∫.
    2.  –°–æ–±–∏—Ä–∞–µ—Ç —Ç–µ–∫—Å—Ç, —Å–æ—Ö—Ä–∞–Ω—è—è –≤–µ—Ä—Å—Ç–∫—É (Markdown tables).
    3.  –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ "–æ—Ç—Å–µ–±—è—Ç–∏–Ω—ã".
  * **–ü–ª—é—Å—ã:** –ò–¥–µ–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞, –±–µ—Å–ø–ª–∞—Ç–Ω–æ (–ª–æ–∫–∞–ª—å–Ω–æ).
  * **–ú–∏–Ω—É—Å—ã:** –ù–µ –ø–æ–Ω–∏–º–∞–µ—Ç "—Å–º—ã—Å–ª" –∫–∞—Ä—Ç–∏–Ω–∫–∏ (–Ω–µ —Å–∫–∞–∂–µ—Ç "—ç—Ç–æ —Å–º–µ—à–Ω–æ–π –∫–æ—Ç").

-----

### üîó 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ü–∞–π–ø–ª–∞–π–Ω: "Content Routing"

–ö–∞–∫ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–π–º–µ—Ç, —á–µ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ñ–∞–π–ª?

**–ê. –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ (Manual)**
–ü—Ä–∏ –≤—ã–∑–æ–≤–µ `ingest` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å —Ö–∏–Ω—Ç:

```python
core.ingest("scan_contract.jpg", strategy="ocr_document")
core.ingest("vacation_photo.jpg", strategy="general_description")
```

**–ë. –ê–≤—Ç–æ-—ç–≤—Ä–∏—Å—Ç–∏–∫–∞ (Auto)**
–ï—Å–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–µ –∑–∞–¥–∞–Ω–∞, –ø–∞–π–ø–ª–∞–π–Ω –º–æ–∂–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Å–¥–µ–ª–∞—Ç—å –±—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑:

1.  –í–∑—è—Ç—å –ø–µ—Ä–≤—ã–µ 100 –±–∞–π—Ç —Ñ–∞–π–ª–∞ (—Ö–µ–¥–µ—Ä—ã).
2.  –ï—Å–ª–∏ PDF -\> **OCR**.
3.  –ï—Å–ª–∏ PNG/JPG:
      * (–°–ª–æ–∂–Ω—ã–π –ø—É—Ç—å): –ü—Ä–æ–≥–Ω–∞—Ç—å —á–µ—Ä–µ–∑ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä (Document vs Photo).
      * (–ü—Ä–æ—Å—Ç–æ–π –ø—É—Ç—å): –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Gemini Flash –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ *—É–º–µ–µ—Ç* —á–∏—Ç–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã —Ç–æ–∂–µ, –µ—Å–ª–∏ –µ—ë –ø–æ–ø—Ä–æ—Å–∏—Ç—å –≤ –ø—Ä–æ–º–ø—Ç–µ *"Act as OCR machine"*.

-----

### üéπ 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `IngestionPipeline`

```python
class IngestionPipeline:
    def process_image(self, resource: ImageResource, strategy: str = "auto"):
        
        # 1. –í—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
        if strategy == "ocr_document":
            provider = self.ocr_provider # (Local Tesseract/Surya)
        else:
            provider = self.ai_vision_provider # (Gemini)
            
        # 2. –û–±—Ä–∞–±–æ—Ç–∫–∞
        result = provider.process(resource)
        
        # 3. –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        # –î–ª—è OCR —Ç–µ–∫—Å—Ç–∞ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "chunking", –∫–∞–∫ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞!
        # –ü–æ—Ç–æ–º—É —á—Ç–æ —Å–∫–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç–∞ - —ç—Ç–æ –ø–æ —Å—É—Ç–∏ –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç.
        if strategy == "ocr_document":
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—Å—Ç –≤ –ø–∞–π–ø–ª–∞–π–Ω –Ω–∞—Ä–µ–∑–∫–∏ (–∫–∞–∫ –±—É–¥—Ç–æ —ç—Ç–æ –±—ã–ª .txt —Ñ–∞–π–ª)
            return self.text_splitter.split(result.text)
        else:
            # –î–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —Ñ–æ—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–¥–∏–Ω —á–∞–Ω–∫
            return [Chunk(content=result.text, metadata={"type": "image_description"})]
```

### ‚úÖ –ò—Ç–æ–≥ –§–∞–∑—ã 6 (–ü–µ—Ä–µ–æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–π)

–ú—ã –∑–∞–∫–ª–∞–¥—ã–≤–∞–µ–º —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è **–ì–∏–±—Ä–∏–¥–Ω–æ–≥–æ –í–∏–¥–µ–Ω–∏—è**.

1.  **–ì–∏–±–∫–æ—Å—Ç—å:** –¢—ã –Ω–µ –∑–∞–ø–µ—Ä—Ç –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ Google. –ï—Å–ª–∏ –∑–∞–≤—Ç—Ä–∞ –≤—ã–π–¥–µ—Ç —Å—É–ø–µ—Ä-–¥–µ—à–µ–≤—ã–π OCR –æ—Ç –Ø–Ω–¥–µ–∫—Å–∞ –∏–ª–∏ –∫—Ä—É—Ç–∞—è –ª–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å ‚Äî —Ç—ã –ø—Ä–æ—Å—Ç–æ –¥–æ–ø–∏—à–µ—à—å –æ–¥–∏–Ω –∫–ª–∞—Å—Å-–∞–¥–∞–ø—Ç–µ—Ä.
2.  **–≠–∫–æ–Ω–æ–º–∏—è:** –¢—ã –º–æ–∂–µ—à—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç—ã—Å—è—á–∏ —Å–∫–∞–Ω–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ) —á–µ—Ä–µ–∑ Tesseract/Surya, –∞ Gemini –≤—ã–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ñ–æ—Ç–æ.
3.  **–¢–æ—á–Ω–æ—Å—Ç—å:** –î–ª—è —Ç–∞–±–ª–∏—Ü –∏ –¥–æ–≥–æ–≤–æ—Ä–æ–≤ OCR —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ, —á–µ–º –≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ.

**–í–µ—Ä–¥–∏–∫—Ç:** –ú—ã –¥–µ–ª–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `VisionProvider` –∏ –¥–≤–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: `GeminiVision` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏ `DummyOCR` (–∑–∞–≥–ª—É—à–∫–∞, –∫–æ—Ç–æ—Ä—É—é –ø–æ—Ç–æ–º –∑–∞–º–µ–Ω–∏–º –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π OCR).

–°–æ–≥–ª–∞—Å–µ–Ω —Å —Ç–∞–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏?

---