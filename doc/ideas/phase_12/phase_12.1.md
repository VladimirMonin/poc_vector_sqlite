# Phase 12.1: Critical Bug Fixes (Flask App)

**–°—Ç–∞—Ç—É—Å:** IN PROGRESS  
**–¶–µ–ª—å:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏, –∏–∑-–∑–∞ –∫–æ—Ç–æ—Ä—ã—Ö Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

## üìã –ó–∞–¥–∞—á–∏

### 1. Fix Ingest & Upload (–ö—Ä–∏—Ç–∏—á–Ω–æ)

**–ü—Ä–æ–±–ª–µ–º–∞:** Drag-n-Drop –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ü—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç.

**–ó–∞–¥–∞—á–∏:**

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JS-–∫–æ–¥ –¥–ª—è –∑–æ–Ω—ã –∑–∞–≥—Ä—É–∑–∫–∏ (`ingest.html`). –ï—Å—Ç—å –ª–∏ console.log –æ—à–∏–±–æ–∫?
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `multipart/form-data`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å/–ø–æ—á–∏–Ω–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `/ingest/upload`:
  - –î–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å HTML (—Å—Ç—Ä–æ–∫—É —Ç–∞–±–ª–∏—Ü—ã), –∞ –Ω–µ JSON
  - HTMX –¥–æ–ª–∂–µ–Ω –≤—Å—Ç–∞–≤–ª—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ DOM
- [ ] –ö–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å" –¥–æ–ª–∂–Ω–∞ —Ä–µ–∞–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å `core.ingest()`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

**–§–∞–π–ª—ã:**

- `app/routes/ingest.py`
- `app/templates/ingest.html`
- `app/templates/partials/ingest_result.html`

---

### 2. Fix Chat Interface (–ö—Ä–∏—Ç–∏—á–Ω–æ)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ß–∞—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –°–æ–æ–±—â–µ–Ω–∏–µ –∏—Å—á–µ–∑–∞–µ—Ç, –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç.

**–ó–∞–¥–∞—á–∏:**

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `/chat/send`:
  - –î–æ–±–∞–≤–∏—Ç—å try/except —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—à–∏–±–∫–∏
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–∞–¥–∞–µ—Ç –ª–∏ —Å 500 –æ—à–∏–±–∫–æ–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTMX –∞—Ç—Ä–∏–±—É—Ç—ã:
  - `hx-target` –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π
  - `hx-swap` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º (beforeend/afterend)
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `ChatService` –∏ `RAGEngine` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ LLM –≤ UI:
  - –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ (gemini-2.0-flash, gemini-1.5-pro, etc.)
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –≤ —Å–µ—Å—Å–∏–∏
  - –ü–µ—Ä–µ–¥–∞—á–∞ –º–æ–¥–µ–ª–∏ –≤ `ChatService`

**–§–∞–π–ª—ã:**

- `app/routes/chat.py`
- `app/templates/chat.html`
- `app/services/chat_service.py`
- `app/extensions.py`

---

### 3. Fix Navigation & Document View (–ö—Ä–∏—Ç–∏—á–Ω–æ)

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã –±–∏—Ç—ã–µ. –ö–Ω–æ–ø–∫–∏ –≤ sidebar –º–µ—Ä—Ç–≤—ã–µ.

**–ó–∞–¥–∞—á–∏:**

- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–æ—É—Ç `/documents/<doc_id>`:
  - –ü–æ–ª—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –∏–∑ –ë–î
  - –†–µ–Ω–¥–µ—Ä–∏—Ç—å Markdown –≤ HTML
  - –ü–æ–∫–∞–∑–∞—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–¥–∞—Ç–∞, —Ä–∞–∑–º–µ—Ä, —á–∞–Ω–∫–∏)
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ–∏—Å–∫–∞:
  - –î–æ–ª–∂–Ω—ã –≤–µ—Å—Ç–∏ –Ω–∞ `/documents/<id>`
  - –î–æ–±–∞–≤–∏—Ç—å —è–∫–æ—Ä—è –∫ —á–∞–Ω–∫–∞–º `#chunk-<index>`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É "–û–±–Ω–æ–≤–∏—Ç—å" (Reindex):
  - –ù–∞–π—Ç–∏ –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª –ø–æ metadata.source
  - –ï—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Äî –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å
  - –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É

**–§–∞–π–ª—ã:**

- `app/routes/ingest.py` (–¥–æ–±–∞–≤–∏—Ç—å `/documents/<id>`)
- `app/templates/document.html` (–Ω–æ–≤—ã–π)
- `app/templates/partials/search_results.html`
- `app/templates/partials/document_list.html`

---

### 4. Fix Dashboard Quick Actions

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢—Ä–∏ –∫–Ω–æ–ø–∫–∏ –Ω–∞ Dashboard –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç (href="#").

**–ó–∞–¥–∞—á–∏:**

- [ ] –ó–∞–º–µ–Ω–∏—Ç—å `href="#"` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–æ—É—Ç—ã:
  - –ü–æ–∏—Å–∫ ‚Üí `{{ url_for('search.index') }}`
  - –ó–∞–≥—Ä—É–∑–∏—Ç—å ‚Üí `{{ url_for('ingest.upload_page') }}`
  - RAG-—á–∞—Ç ‚Üí `{{ url_for('chat.index') }}`

**–§–∞–π–ª—ã:**

- `app/templates/dashboard.html`

---

### 5. Fix Sidebar Dead Links

**–ü—Ä–æ–±–ª–µ–º–∞:** "–ú–µ–¥–∏–∞" –∏ "–û—á–µ—Ä–µ–¥—å" –≤–µ–¥—É—Ç –≤ –Ω–∏–∫—É–¥–∞.

**–ó–∞–¥–∞—á–∏:**

- [ ] –í—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ "–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ":
  - –î–æ–±–∞–≤–∏—Ç—å `disabled` –∫–ª–∞—Å—Å
  - –î–æ–±–∞–≤–∏—Ç—å badge "Soon"
- [ ] –ò–ª–∏ —É–±—Ä–∞—Ç—å –∏–∑ –º–µ–Ω—é –¥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–§–∞–π–ª—ã:**

- `app/templates/base.html`

---

### 6. Show LLM Model in Settings

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –Ω–µ –≤–∏–¥–Ω–æ –º–æ–¥–µ–ª—å LLM.

**–ó–∞–¥–∞—á–∏:**

- [ ] –î–æ–±–∞–≤–∏—Ç—å `llm_model` –≤ —Ç–∞–±–ª–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–µ–∫
- [ ] –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –º–æ–¥–µ–ª—å —á–∞—Ç–∞

**–§–∞–π–ª—ã:**

- `app/templates/settings.html`

---

## üß™ –¢–µ—Å—Ç—ã

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞–ø–∏—Å–∞—Ç—å E2E —Ç–µ—Å—Ç—ã:

- [ ] `test_ingest_upload_file` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É
- [ ] `test_chat_send_message` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
- [ ] `test_document_view` ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ ID
- [ ] `test_dashboard_links` ‚Äî –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –≤–µ–¥—É—Ç –Ω–∞ —Ä–∞–±–æ—á–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

---

## üìä –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

1. ‚úÖ Drag-n-Drop –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª—ã
2. ‚úÖ –ß–∞—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
3. ‚úÖ –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ —Å—Å—ã–ª–∫–µ
4. ‚úÖ –í—Å–µ –∫–Ω–æ–ø–∫–∏ Dashboard —Ä–∞–±–æ—Ç–∞—é—Ç
5. ‚úÖ E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
