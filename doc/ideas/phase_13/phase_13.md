–í–æ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–µ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ó–∞–¥–∞–Ω–∏–µ (–¢–ó) –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –§–∞–∑—ã 13.
–≠—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ê–≥–µ–Ω—Ç–∞, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π **–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞**.

-----

# üìã –¢–ó: Phase 13 ‚Äî Total Visual Audit (Human-First Testing)

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è **–≤–∏–∑—É–∞–ª—å–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏** —Ä–∞–±–æ—Ç—ã –ø–∞–π–ø–ª–∞–π–Ω–∞.
**–ü—Ä–æ–±–ª–µ–º–∞:** Unit-—Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç, —á—Ç–æ –∫–æ–¥ –Ω–µ –ø–∞–¥–∞–µ—Ç, –Ω–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç *–∫–∞—á–µ—Å—Ç–≤–æ* —Ä–∞–∑–±–∏–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞, *–∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å* –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ *—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å* –ø–æ–∏—Å–∫–∞.
**–ó–∞–¥–∞—á–∞:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≥–æ–Ω—è–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —á–∏—Ç–∞–µ–º—ã–µ Markdown-–æ—Ç—á–µ—Ç—ã –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

-----

## 1\. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏ –æ—Ç—á–µ—Ç–æ–≤:

```text
tests/audit_assets/              # –í–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï (–ü–æ–ª–∏–≥–æ–Ω)
‚îú‚îÄ‚îÄ 01_text/                     # –ü—Ä–æ—Å—Ç—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã (.txt, .md –±–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
‚îú‚îÄ‚îÄ 02_structure/                # –°–ª–æ–∂–Ω—ã–µ MD (–∑–∞–≥–æ–ª–æ–≤–∫–∏, —Å–ø–∏—Å–∫–∏, —Ü–∏—Ç–∞—Ç—ã)
‚îú‚îÄ‚îÄ 03_media/                    # MD —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏/–∞—É–¥–∏–æ/–≤–∏–¥–µ–æ
‚îú‚îÄ‚îÄ 04_raw_media/                # –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã (.jpg, .mp3, .mp4)
‚îî‚îÄ‚îÄ queries.txt                  # –°–ø–∏—Å–æ–∫ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ 1 –Ω–∞ —Å—Ç—Ä–æ–∫—É)

audit_reports/                   # –í–´–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï (–û—Ç—á–µ—Ç—ã)
‚îî‚îÄ‚îÄ YYYY-MM-DD_HH-MM/            # –ü–∞–ø–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
    ‚îú‚îÄ‚îÄ 01_chunking_report.md    # –ö–∞–∫ –ø–æ—Ä–µ–∑–∞–ª—Å—è —Ç–µ–∫—Å—Ç
    ‚îú‚îÄ‚îÄ 02_media_debug.md        # –ü—Ä–æ–º–ø—Ç—ã –∏ –æ—Ç–≤–µ—Ç—ã Vision API
    ‚îî‚îÄ‚îÄ 03_search_quality.md     # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
```

-----

## 2\. –°–∫—Ä–∏–ø—Ç –∞—É–¥–∏—Ç–∞ (`scripts/audit_pipeline.py`)

–°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ä–µ–∂–∏–º–µ CLI.
**–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞:** `python scripts/audit_pipeline.py`

### –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–ò–∑–æ–ª—è—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `audit.db` (—É–¥–∞–ª—è—Ç—å/–ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º).
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å `TRACE` –¥–ª—è `SemanticLogger`, —á—Ç–æ–±—ã –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã.
3. **–ü–µ—Ä–µ—Ö–≤–∞—Ç:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω `Inspector` (–∏–ª–∏ —Ö—É–∫–∏), —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—ã—á–Ω–æ —Å–∫—Ä—ã—Ç—ã –≤–Ω—É—Ç—Ä–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞.

-----

## 3\. –°—Ü–µ–Ω–∞—Ä–∏–π –ê: "–ê–Ω–∞—Ç–æ–º–∏—è –ß–∞–Ω–∫–∏–Ω–≥–∞" (Chunking Inspection)

**–ó–∞–¥–∞—á–∞:** –í–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ `SmartSplitter` –∏ `MarkdownNodeParser` –Ω–∞—Ä–µ–∑–∞—é—Ç –¥–æ–∫—É–º–µ–Ω—Ç.

**–í—Ö–æ–¥:** –í—Å–µ —Ñ–∞–π–ª—ã –∏–∑ `tests/audit_assets/01_text/` –∏ `02_structure/`.
**–ü—Ä–æ—Ü–µ—Å—Å:** `ingest(file, mode='sync')`.

**–§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞ (`01_chunking_report.md`):**

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ü–∏—é:

````markdown
# File: architecture.md
Total Chunks: 15

---
## Chunk #1 [TEXT] (ID: 1)
**Headers Breadcrumbs:** `Architecture > System Design`
**Size:** 450 chars
**Content:**
> (–¶–∏—Ç–∞—Ç–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —á–∞–Ω–∫–∞)

---
## Chunk #2 [CODE] (ID: 2)
**Language:** python
**Headers Breadcrumbs:** `Architecture > System Design > Api`
**Content:**
```python
def api_call(): ...
````

````

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞):**
1.  –ù–µ —Ä–∞–∑—Ä—ã–≤–∞—é—Ç—Å—è –ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ?
2.  –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω —è–∑—ã–∫ –∫–æ–¥–∞?
3.  –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ª–∏ Breadcrumbs (—Ö–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏) —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ?

---

## 4. –°—Ü–µ–Ω–∞—Ä–∏–π –ë: "–ú–µ–¥–∏–∞-–í—Å–∫—Ä—ã—Ç–∏–µ" (Media Enrichment Debug)

**–ó–∞–¥–∞—á–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–æ–º–ø—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Gemini Vision/Audio, –∏ —á—Ç–æ –º–æ–¥–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç.

**–í—Ö–æ–¥:** –§–∞–π–ª—ã –∏–∑ `03_media/` –∏ `04_raw_media/`.
**–ü—Ä–æ—Ü–µ—Å—Å:** `ingest(file, enrich_media=True)`.

**–§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞ (`02_media_debug.md`):**

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ–¥–∏–∞-—Ñ–∞–π–ª–∞:
```markdown
# Media Asset: diagram.png
**Source Document:** `docs/architecture.md`
**Type:** IMAGE

### 1. Context (Enricher Input)
**Surrounding Text (Before):**
> ...–∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∞ —Å—Ö–µ–º–µ –Ω–∏–∂–µ:

**Surrounding Text (After):**
> –≠—Ç–∞ —Å—Ö–µ–º–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö...

### 2. LLM Request (–¢–æ, —á—Ç–æ —É—à–ª–æ –≤ Gemini)
**System Prompt:** "You are an expert..."
**User Prompt:** "Analyze this image in context..."

### 3. LLM Response (Raw)
**JSON:**
```json
{
  "description": "–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö...",
  "ocr_text": "User -> API -> DB"
}
````

### 4\. Final Chunk Content

> (–¢–æ, —á—Ç–æ –≤ –∏—Ç–æ–≥–µ –ø–æ–ø–∞–ª–æ –≤ –±–∞–∑—É –ø–æ–∏—Å–∫–∞)

````

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
1.  –ü–æ–ø–∞–¥–∞–µ—Ç –ª–∏ —Å–æ—Å–µ–¥–Ω–∏–π —Ç–µ–∫—Å—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç?
2.  –ê–¥–µ–∫–≤–∞—Ç–Ω–æ –ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏?
3.  –ù–µ—Ç –ª–∏ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π (–≤—ã–¥—É–º–∞–Ω–Ω—ã—Ö —Ñ–∞–∫—Ç–æ–≤)?

---

## 5. –°—Ü–µ–Ω–∞—Ä–∏–π –í: "–ü–æ–∏—Å–∫–æ–≤—ã–π –†–∞–∑—Ä–µ–∑" (Search Quality X-Ray)

**–ó–∞–¥–∞—á–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –≤—ã–¥–∞—á–∏ RRF.

**–í—Ö–æ–¥:** –§–∞–π–ª `queries.txt` –∏ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –±–∞–∑–∞ (–ø–æ—Å–ª–µ —à–∞–≥–æ–≤ –ê –∏ –ë).
**–ü—Ä–æ—Ü–µ—Å—Å:** –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `search(query, limit=5)`.

**–§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞ (`03_search_quality.md`):**

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:
```markdown
# Query: "–∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å nginx"

| Rank | Score  | Type | File | Preview | Context Match? |
| :--- | :----- | :--- | :--- | :--- | :--- |
| 1    | 0.8921 | CODE | `setup.md` | `nginx.conf...` | ‚úÖ Headers: Config |
| 2    | 0.4510 | TEXT | `intro.md` | `Nginx is a...` | ‚ùå Headers: Intro |
````

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

1. –ù–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –Ω—É–∂–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –ø–µ—Ä–≤—ã–º?
2. –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –ø–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É?
3. –ù–∞—Ö–æ–¥–∏—Ç –ª–∏ –æ–Ω –æ–ø–∏—Å–∞–Ω–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ (–∏–∑ –°—Ü–µ–Ω–∞—Ä–∏—è –ë)?

-----

## 6\. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ê–≥–µ–Ω—Ç–∞

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `scripts/audit_pipeline.py`.
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å `PipelineInspector`, –∫–æ—Ç–æ—Ä—ã–π –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç `SemanticCore` –∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (–Ω–µ –º–µ–Ω—è—è –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã).
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã Markdown-–æ—Ç—á–µ—Ç–æ–≤.
4. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (—á—Ç–æ–±—ã –∞—É–¥–∏—Ç –Ω–µ –ø–∞–¥–∞–ª –Ω–∞ –æ–¥–Ω–æ–º –±–∏—Ç–æ–º —Ñ–∞–π–ª–µ).
5. –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–∞–ø–∫–∏ –¥–ª—è –∞—Å—Å–µ—Ç–æ–≤, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç (—á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–Ω–∞–ª, –∫—É–¥–∞ –∫–ª–∞—Å—Ç—å —Ñ–∞–π–ª—ã).
