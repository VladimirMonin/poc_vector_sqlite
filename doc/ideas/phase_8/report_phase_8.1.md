# üìã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –û—Ç—á—ë—Ç: Phase 8.1 ‚Äî Queue & Worker CLI

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–ö–æ–º–º–∏—Ç:** `feat: –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã queue –∏ worker (Phase 8.1)`  
**–í–µ—Ç–∫–∞:** `phase_8`

---

## 1. –¶–µ–ª—å —Ñ–∞–∑—ã

Phase 8.1 –¥–æ–±–∞–≤–ª—è–µ—Ç **–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π:

- `semantic queue` ‚Äî —Å—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–µ–π, flush, retry
- `semantic worker` ‚Äî –≤–æ—Ä–∫–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–µ–¥–∏–∞ –∏ –±–∞—Ç—á–µ–π

–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è production-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –æ—á–µ—Ä–µ–¥–∏, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –∑–∞–¥–∞—á–∏ –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å background-–æ–±—Ä–∞–±–æ—Ç–∫—É.

---

## 2. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 2.1 –î–≤–µ –æ—á–µ—Ä–µ–¥–∏ –≤ —Å–∏—Å—Ç–µ–º–µ

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     Semantic Core Queues                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ                               ‚îÇ
              ‚ñº                               ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ   Text Queue       ‚îÇ         ‚îÇ   Media Queue      ‚îÇ
   ‚îÇ  (BatchManager)    ‚îÇ         ‚îÇ  (MediaTaskModel)  ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ                               ‚îÇ
              ‚ñº                               ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ ChunkModel         ‚îÇ         ‚îÇ MediaTaskModel     ‚îÇ
   ‚îÇ + EmbeddingStatus  ‚îÇ         ‚îÇ + TaskStatus       ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ                               ‚îÇ
              ‚ñº                               ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ pending            ‚îÇ         ‚îÇ pending            ‚îÇ
   ‚îÇ submitted          ‚îÇ         ‚îÇ processing         ‚îÇ
   ‚îÇ completed          ‚îÇ         ‚îÇ completed          ‚îÇ
   ‚îÇ failed             ‚îÇ         ‚îÇ failed             ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
semantic_core/cli/
‚îú‚îÄ‚îÄ commands/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py     # +UPDATE: —ç–∫—Å–ø–æ—Ä—Ç queue_cmd, worker_cmd
‚îÇ   ‚îú‚îÄ‚îÄ queue.py        # +NEW: ~330 —Å—Ç—Ä–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ worker.py       # +NEW: ~240 —Å—Ç—Ä–æ–∫
‚îî‚îÄ‚îÄ app.py              # +UPDATE: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥

semantic_core/utils/logger/formatters.py  # +UPDATE: EMOJI_MAP

tests/unit/cli/test_cli_phase_8_1.py      # +NEW: ~490 —Å—Ç—Ä–æ–∫, 30 —Ç–µ—Å—Ç–æ–≤
```

---

## 3. –ö–æ–º–∞–Ω–¥–∞ `queue` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—è–º–∏

### 3.1 –û–±–∑–æ—Ä –∫–æ–º–∞–Ω–¥

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `semantic queue status` | –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –æ—á–µ—Ä–µ–¥–µ–π |
| `semantic queue flush` | –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∏ failed –∑–∞–¥–∞—á |
| `semantic queue retry` | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ failed –∑–∞–¥–∞—á |

### 3.2 –°—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–µ–π (`queue status`)

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –æ–±–µ–∏–º –æ—á–µ—Ä–µ–¥—è–º.

**–û–ø—Ü–∏–∏:**

| –û–ø—Ü–∏—è | –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------------|----------|
| `--verbose` | `-v` | –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è |
| `--type` | `-t` | –§–∏–ª—å—Ç—Ä: text/media/all |

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**

```
                    queue status
                         ‚îÇ
                         ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ      _get_text_stats()       ‚îÇ
          ‚îÇ  SELECT count(*), status     ‚îÇ
          ‚îÇ  FROM chunks                 ‚îÇ
          ‚îÇ  GROUP BY embedding_status   ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ      _get_media_stats()      ‚îÇ
          ‚îÇ  SELECT count(*), status     ‚îÇ
          ‚îÇ  FROM media_tasks            ‚îÇ
          ‚îÇ  GROUP BY status             ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ    _render_stats_table()     ‚îÇ
          ‚îÇ  –∏–ª–∏ print_json()            ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–í—ã–≤–æ–¥ (Rich):**

```
‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üì¶ –°—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–µ–π ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ                                                          ‚îÇ
‚îÇ üìù Text Queue (Embeddings)                               ‚îÇ
‚îÇ ‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì                               ‚îÇ
‚îÇ ‚îÉ –°—Ç–∞—Ç—É—Å       ‚îÉ –ö–æ–ª-–≤–æ  ‚îÉ                               ‚îÇ
‚îÇ ‚î°‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î©                               ‚îÇ
‚îÇ ‚îÇ ‚è≥ pending   ‚îÇ 45      ‚îÇ                               ‚îÇ
‚îÇ ‚îÇ üì§ submitted ‚îÇ 12      ‚îÇ                               ‚îÇ
‚îÇ ‚îÇ ‚úÖ completed ‚îÇ 1,234   ‚îÇ                               ‚îÇ
‚îÇ ‚îÇ ‚ùå failed    ‚îÇ 3       ‚îÇ                               ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                               ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ üé¨ Media Queue (Analysis)                                ‚îÇ
‚îÇ ‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì                               ‚îÇ
‚îÇ ‚îÉ –°—Ç–∞—Ç—É—Å       ‚îÉ –ö–æ–ª-–≤–æ  ‚îÉ                               ‚îÇ
‚îÇ ‚î°‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î©                               ‚îÇ
‚îÇ ‚îÇ ‚è≥ pending   ‚îÇ 8       ‚îÇ                               ‚îÇ
‚îÇ ‚îÇ üîÑ processing‚îÇ 2       ‚îÇ                               ‚îÇ
‚îÇ ‚îÇ ‚úÖ completed ‚îÇ 156     ‚îÇ                               ‚îÇ
‚îÇ ‚îÇ ‚ùå failed    ‚îÇ 1       ‚îÇ                               ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                               ‚îÇ
‚îÇ                                                          ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
```

**–í—ã–≤–æ–¥ (JSON):**

```json
{
  "text": {
    "pending": 45,
    "submitted": 12,
    "completed": 1234,
    "failed": 3
  },
  "media": {
    "pending": 8,
    "processing": 2,
    "completed": 156,
    "failed": 1
  }
}
```

### 3.3 –û—á–∏—Å—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π (`queue flush`)

–£–¥–∞–ª—è–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∏ –ø—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏–∑ –æ—á–µ—Ä–µ–¥–µ–π.

**–û–ø—Ü–∏–∏:**

| –û–ø—Ü–∏—è | –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | Default |
|-------|------------|----------|---------|
| `--type` | `-t` | –¢–∏–ø –æ—á–µ—Ä–µ–¥–∏: text/media/all | all |
| `--status` | `-s` | –ö–∞–∫–∏–µ –∑–∞–¥–∞—á–∏: completed/failed/all | all |
| `--confirm` | `-y` | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±–µ–∑ –≤–æ–ø—Ä–æ—Å–∞ | False |

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```bash
# –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)
semantic queue flush

# –û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ
semantic queue flush --status completed

# –û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –º–µ–¥–∏–∞ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
semantic queue flush -t media -y
```

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**

```
                    queue flush
                         ‚îÇ
                         ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ    –ó–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è      ‚îÇ
          ‚îÇ    (–µ—Å–ª–∏ –±–µ–∑ --confirm)      ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ                         ‚îÇ
            ‚ñº                         ‚ñº
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ text queue ‚îÇ           ‚îÇmedia queue ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ                         ‚îÇ
            ‚ñº                         ‚ñº
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ DELETE     ‚îÇ           ‚îÇ DELETE     ‚îÇ
     ‚îÇ WHERE      ‚îÇ           ‚îÇ WHERE      ‚îÇ
     ‚îÇ status IN  ‚îÇ           ‚îÇ status IN  ‚îÇ
     ‚îÇ (...)      ‚îÇ           ‚îÇ (...)      ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ                         ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ    –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç        ‚îÇ
          ‚îÇ    (—Å–∫–æ–ª—å–∫–æ —É–¥–∞–ª–µ–Ω–æ)         ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 3.4 –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ (`queue retry`)

–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å failed –∑–∞–¥–∞—á –Ω–∞ pending –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

**–û–ø—Ü–∏–∏:**

| –û–ø—Ü–∏—è | –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | Default |
|-------|------------|----------|---------|
| `--type` | `-t` | –¢–∏–ø –æ—á–µ—Ä–µ–¥–∏: text/media/all | all |
| `--max-tasks` | `-n` | –ú–∞–∫—Å–∏–º—É–º –∑–∞–¥–∞—á –¥–ª—è retry | None |

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```bash
# Retry –≤—Å–µ—Ö failed
semantic queue retry

# Retry —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö (–ø–µ—Ä–≤—ã–µ 10)
semantic queue retry -t text -n 10

# Retry –º–µ–¥–∏–∞
semantic queue retry -t media
```

**–õ–æ–≥–∏–∫–∞:**

```python
def _retry_text_queue(max_tasks: int | None) -> int:
    """–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å failed chunks –Ω–∞ pending."""
    query = (
        ChunkModel
        .update(embedding_status=EmbeddingStatus.pending)
        .where(ChunkModel.embedding_status == EmbeddingStatus.failed)
    )
    if max_tasks:
        query = query.limit(max_tasks)
    return query.execute()

def _retry_media_queue(max_tasks: int | None) -> int:
    """–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å failed tasks –Ω–∞ pending."""
    query = (
        MediaTaskModel
        .update(status=TaskStatus.pending)
        .where(MediaTaskModel.status == TaskStatus.failed)
    )
    if max_tasks:
        query = query.limit(max_tasks)
    return query.execute()
```

---

## 4. –ö–æ–º–∞–Ω–¥–∞ `worker` ‚Äî —Ñ–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### 4.1 –û–±–∑–æ—Ä –∫–æ–º–∞–Ω–¥

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `semantic worker run-once` | –û–¥–∏–Ω —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ |
| `semantic worker start` | –ó–∞–ø—É—Å–∫ continuous worker |

### 4.2 Run-Once (`worker run-once`)

–í—ã–ø–æ–ª–Ω—è–µ—Ç –æ–¥–∏–Ω —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.

**–û–ø—Ü–∏–∏:**

| –û–ø—Ü–∏—è | –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | Default |
|-------|------------|----------|---------|
| `--max-tasks` | `-n` | –ú–∞–∫—Å–∏–º—É–º –∑–∞–¥–∞—á | 10 |
| `--process-batches` | `-b` | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å batch —Å—Ç–∞—Ç—É—Å—ã | True |
| `--process-media` | `-m` | –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –º–µ–¥–∏–∞ –æ—á–µ—Ä–µ–¥—å | True |

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**

```
                   worker run-once
                         ‚îÇ
                         ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ    get_cli_context()         ‚îÇ
          ‚îÇ    cli_ctx.get_core()        ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                               ‚îÇ
         ‚ñº                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ --process-batches?  ‚îÇ       ‚îÇ --process-media?    ‚îÇ
‚îÇ                     ‚îÇ       ‚îÇ                     ‚îÇ
‚îÇ _sync_batch_statuses‚îÇ       ‚îÇ _process_media_queue‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                               ‚îÇ
         ‚ñº                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ BatchManager.       ‚îÇ       ‚îÇ MediaQueueProcessor ‚îÇ
‚îÇ sync_completed()    ‚îÇ       ‚îÇ .process_batch()    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                               ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ    –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã       ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–í—ã–≤–æ–¥:**

```
‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üë∑ Worker Run-Once ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ batch —Å—Ç–∞—Ç—É—Å–æ–≤: 5             ‚îÇ
‚îÇ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –º–µ–¥–∏–∞ –∑–∞–¥–∞—á: 8                ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
```

### 4.3 Start (`worker start`)

–ó–∞–ø—É—Å–∫–∞–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –≤–æ—Ä–∫–µ—Ä —Å graceful shutdown.

**–û–ø—Ü–∏–∏:**

| –û–ø—Ü–∏—è | –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | Default |
|-------|------------|----------|---------|
| `--batch-size` | `-b` | –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ | 10 |
| `--poll-interval` | `-i` | –ò–Ω—Ç–µ—Ä–≤–∞–ª –≤ —Å–µ–∫—É–Ω–¥–∞—Ö | 5.0 |

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```bash
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫
semantic worker start

# –° –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
semantic worker start --batch-size 50 --poll-interval 10

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞: Ctrl+C
```

**Signal Handling:**

```python
import signal

# –§–ª–∞–≥ –¥–ª—è graceful shutdown
_shutdown_requested = False

def _signal_handler(signum: int, frame: Any) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ SIGINT/SIGTERM –¥–ª—è graceful shutdown."""
    global _shutdown_requested
    _shutdown_requested = True
    console.print("\n[yellow]‚ö†Ô∏è  –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –æ—Å—Ç–∞–Ω–æ–≤–∫–∏. –ó–∞–≤–µ—Ä—à–∞–µ–º...[/]")

@worker_cmd.command("start")
def worker_start(...) -> None:
    global _shutdown_requested
    _shutdown_requested = False
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    original_handler = signal.getsignal(signal.SIGINT)
    signal.signal(signal.SIGINT, _signal_handler)
    
    try:
        while not _shutdown_requested:
            # –û–±—Ä–∞–±–æ—Ç–∫–∞
            _sync_batch_statuses(core)
            _process_media_queue(core, batch_size)
            
            # –û–∂–∏–¥–∞–Ω–∏–µ (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π shutdown)
            for _ in range(int(poll_interval)):
                if _shutdown_requested:
                    break
                time.sleep(1)
    finally:
        # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        signal.signal(signal.SIGINT, original_handler)
```

**Lifecycle:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    worker start lifecycle                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ  Register SIGINT handler      ‚îÇ
              ‚îÇ  _shutdown_requested = False  ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ  Print "Worker started"       ‚îÇ
              ‚îÇ  Show batch_size, interval    ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îå‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  Check _shutdown_requested    ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
         ‚îÇ                    ‚îÇ                     ‚îÇ
         ‚îÇ          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
         ‚îÇ          ‚îÇ                   ‚îÇ           ‚îÇ
         ‚îÇ          ‚ñº                   ‚ñº           ‚îÇ
         ‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
         ‚îÇ    ‚îÇ  True    ‚îÇ        ‚îÇ  False   ‚îÇ      ‚îÇ
         ‚îÇ    ‚îÇ  (stop)  ‚îÇ        ‚îÇ (continue‚îÇ      ‚îÇ
         ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
         ‚îÇ          ‚îÇ                   ‚îÇ           ‚îÇ
         ‚îÇ          ‚ñº                   ‚ñº           ‚îÇ
         ‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
         ‚îÇ    ‚îÇ Break    ‚îÇ   ‚îÇ _sync_batches() ‚îÇ    ‚îÇ
         ‚îÇ    ‚îÇ loop     ‚îÇ   ‚îÇ _process_media()‚îÇ    ‚îÇ
         ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
         ‚îÇ                          ‚îÇ               ‚îÇ
         ‚îÇ                          ‚ñº               ‚îÇ
         ‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
         ‚îÇ              ‚îÇ Sleep poll_interval ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ              ‚îÇ (interruptible)     ‚îÇ
         ‚îÇ              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Restore original SIGINT handler  ‚îÇ
‚îÇ  Print "Worker stopped"           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Interruptible Sleep:**

```python
# –í–º–µ—Å—Ç–æ time.sleep(poll_interval) —Ü–µ–ª–∏–∫–æ–º
# –¥–µ–ª–∞–µ–º –ø–æ—Å–µ–∫—É–Ω–¥–Ω—ã–π sleep —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
for _ in range(int(poll_interval)):
    if _shutdown_requested:
        break
    time.sleep(1)
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–µ—Ä–≤–∞—Ç—å –æ–∂–∏–¥–∞–Ω–∏–µ –º–∞–∫—Å–∏–º—É–º –∑–∞ 1 —Å–µ–∫—É–Ω–¥—É.

---

## 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ EMOJI_MAP

### 5.1 –ù–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏

```python
# semantic_core/utils/logger/formatters.py

EMOJI_MAP = {
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ ...
    
    # Phase 8.1: CLI commands
    "cli": "üñ•Ô∏è",        # CLI –º–æ–¥—É–ª—å –≤ —Ü–µ–ª–æ–º
    "commands": "üñ•Ô∏è",   # –ü–æ–¥–º–æ–¥—É–ª—å commands
    "worker": "üë∑",      # Worker-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ª–æ–≥–∏
}
```

### 5.2 –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

–§—É–Ω–∫—Ü–∏—è `get_module_emoji()` –∏—â–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å –∫–æ–Ω—Ü–∞ –ø—É—Ç–∏ –º–æ–¥—É–ª—è:

```python
def get_module_emoji(module_name: str) -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç–º–æ–¥–∑–∏ –¥–ª—è –º–æ–¥—É–ª—è."""
    parts = module_name.split(".")
    
    # –ü–æ–∏—Å–∫ —Å –∫–æ–Ω—Ü–∞: –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
    for i in range(len(parts), 0, -1):
        key = parts[-i]  # –ë–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ i —á–∞—Å—Ç–µ–π
        if key in EMOJI_MAP:
            return EMOJI_MAP[key]
    
    return EMOJI_MAP.get("default", "üì¶")
```

**–ü—Ä–∏–º–µ—Ä:**

```python
module = "semantic_core.cli.commands.queue"

# –ò—Ç–µ—Ä–∞—Ü–∏–∏:
# i=4: "semantic_core.cli.commands.queue" -> –Ω–µ –≤ EMOJI_MAP
# i=3: "cli.commands.queue" -> –Ω–µ –≤ EMOJI_MAP
# i=2: "commands.queue" -> –Ω–µ –≤ EMOJI_MAP
# i=1: "queue" -> "üì¶" (queue –≤ EMOJI_MAP!)

# –†–µ–∑—É–ª—å—Ç–∞—Ç: üì¶ (–Ω–µ üñ•Ô∏è, –ø–æ—Ç–æ–º—É —á—Ç–æ queue –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ–Ω)
```

–≠—Ç–æ –±—ã–ª–∞ –ø—Ä–∏—á–∏–Ω–∞ –æ–¥–Ω–æ–≥–æ –∏–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤: `queue` –≤–∞–∂–Ω–µ–µ `commands`.

---

## 6. –†–µ—à—ë–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 6.1 –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è signal handler

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∫ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ shutdown –≤–Ω—É—Ç—Ä—å while-loop?

**–†–µ—à–µ–Ω–∏–µ:** –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å `global` keyword:

```python
_shutdown_requested = False

def _signal_handler(signum, frame):
    global _shutdown_requested
    _shutdown_requested = True

def worker_start():
    global _shutdown_requested
    _shutdown_requested = False  # Reset –Ω–∞ —Å—Ç–∞—Ä—Ç–µ
    
    signal.signal(signal.SIGINT, _signal_handler)
    
    while not _shutdown_requested:
        # —Ä–∞–±–æ—Ç–∞
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏):** Threading Event:

```python
shutdown_event = threading.Event()
# shutdown_event.set() –≤ handler
# while not shutdown_event.is_set(): ...
```

–ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–æ—â–µ –¥–ª—è –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–æ–≥–æ CLI.

### 6.2 –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ signal handler

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ worker start –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π Ctrl+C.

**–†–µ—à–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π handler:

```python
original_handler = signal.getsignal(signal.SIGINT)
signal.signal(signal.SIGINT, _signal_handler)

try:
    # —Ä–∞–±–æ—Ç–∞
finally:
    signal.signal(signal.SIGINT, original_handler)
```

### 6.3 Mock order –¥–ª—è JSON —Ç–µ—Å—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Å—Ç `test_worker_run_once_json_output` –ø–∞–¥–∞–ª —Å JSON parse error.

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Ä—è–¥–æ–∫ –º–æ–∫–æ–≤ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—ã–≤–æ–¥. Console print –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª –¥–æ –º–æ–∫–∞.

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏—Ç—å –º–æ–∫–∏ —Ç–∞–∫, —á—Ç–æ–±—ã `print_json` –≤—ã–∑—ã–≤–∞–ª—Å—è –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ:

```python
@patch("semantic_core.cli.commands.worker.get_cli_context")
@patch("semantic_core.cli.commands.worker._process_media_queue")
@patch("semantic_core.cli.commands.worker._sync_batch_statuses")
def test_worker_run_once_json_output(
    mock_sync,
    mock_process,
    mock_ctx,
):
    # –ü–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω! mock_ctx –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å json_output=True
    # –¥–æ —Ç–æ–≥–æ –∫–∞–∫ –≤—ã–∑–æ–≤—É—Ç—Å—è –¥—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
```

### 6.4 Skip –≤–º–µ—Å—Ç–æ patch –¥–ª—è integration —Ç–µ—Å—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Å—Ç `test_queue_status_empty_db` –ø—ã—Ç–∞–ª—Å—è –ø–∞—Ç—á–∏—Ç—å models –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@pytest.mark.skip`:

```python
@pytest.mark.skip(
    reason="Integration test - requires full database setup"
)
def test_queue_status_empty_db(self):
    """–¢—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –ë–î –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è."""
    pass
```

---

## 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 7.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/unit/cli/test_cli_phase_8_1.py  # ~490 —Å—Ç—Ä–æ–∫, 30 —Ç–µ—Å—Ç–æ–≤
```

### 7.2 –ö–ª–∞—Å—Å—ã —Ç–µ—Å—Ç–æ–≤

**TestQueueStatusCommand (7 —Ç–µ—Å—Ç–æ–≤):**

- `test_queue_status_help` ‚Äî —Å–ø—Ä–∞–≤–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–ø—Ü–∏–∏
- `test_queue_status_text_only` ‚Äî —Ñ–∏–ª—å—Ç—Ä --type text
- `test_queue_status_media_only` ‚Äî —Ñ–∏–ª—å—Ç—Ä --type media
- `test_queue_status_all_types` ‚Äî --type all (default)
- `test_queue_status_verbose` ‚Äî verbose –≤—ã–≤–æ–¥
- `test_queue_status_json_output` ‚Äî JSON —Ñ–æ—Ä–º–∞—Ç
- `test_queue_status_empty_db` ‚Äî –ø—É—Å—Ç–∞—è –ë–î (skipped)

**TestQueueFlushCommand (5 —Ç–µ—Å—Ç–æ–≤):**

- `test_queue_flush_help`
- `test_queue_flush_no_confirm` ‚Äî –∑–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- `test_queue_flush_with_confirm` ‚Äî --confirm/-y
- `test_queue_flush_text_only`
- `test_queue_flush_media_only`

**TestQueueRetryCommand (4 —Ç–µ—Å—Ç–∞):**

- `test_queue_retry_help`
- `test_queue_retry_text_only`
- `test_queue_retry_media_only`
- `test_queue_retry_with_max_tasks`

**TestWorkerRunOnceCommand (5 —Ç–µ—Å—Ç–æ–≤):**

- `test_worker_run_once_help`
- `test_worker_run_once_default` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫
- `test_worker_run_once_max_tasks` ‚Äî —Å --max-tasks
- `test_worker_run_once_no_batches` ‚Äî –±–µ–∑ --process-batches
- `test_worker_run_once_json_output` ‚Äî JSON —Ñ–æ—Ä–º–∞—Ç

**TestWorkerStartCommand (4 —Ç–µ—Å—Ç–∞):**

- `test_worker_start_help`
- `test_worker_start_default_options`
- `test_worker_start_custom_options`
- `test_worker_start_signal_handler` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è SIGINT

**TestEmojiMapUpdates (3 —Ç–µ—Å—Ç–∞):**

- `test_emoji_map_has_cli_entries` ‚Äî cli, worker, commands
- `test_get_module_emoji_for_cli` ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- `test_get_module_emoji_for_worker` ‚Äî worker —ç–º–æ–¥–∑–∏

**TestHelpersAndUtilities (3 —Ç–µ—Å—Ç–∞):**

- `test_get_text_stats_function_exists`
- `test_get_media_stats_function_exists`
- `test_render_stats_table_function_exists`

### 7.3 –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤

```bash
$ poetry run pytest tests/unit/cli/test_cli_phase_8_1.py -v
======================== 29 passed, 1 skipped in 0.18s =========================
```

---

## 8. –ú–µ—Ç—Ä–∏–∫–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –ù–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ | 2 |
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | ~570 |
| –ù–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π | 15 |
| Unit-—Ç–µ—Å—Ç–æ–≤ | 30 (29 passed, 1 skipped) |

### 8.1 –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤

| –§–∞–π–ª | –°—Ç—Ä–æ–∫–∏ |
|------|--------|
| `commands/queue.py` | ~330 |
| `commands/worker.py` | ~240 |
| `test_cli_phase_8_1.py` | ~490 |

---

## 9. –û–±—â–∏–π coverage CLI

–ü–æ—Å–ª–µ Phase 8.1 –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä CLI —Ç–µ—Å—Ç–æ–≤:

| –§–∞–∑–∞ | –§–∞–π–ª | –¢–µ—Å—Ç–æ–≤ |
|------|------|--------|
| 8.3 | test_cli_phase_8_3.py | ~50 |
| 8.0 | test_cli_phase_8_0.py | ~49 |
| 8.1 | test_cli_phase_8_1.py | 30 |
| **–ò—Ç–æ–≥–æ** | | **~129** |

```bash
$ poetry run pytest tests/unit/cli/ -v
======================== 129 passed, 1 skipped in 0.45s =========================
```

---

## 10. –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 10.1 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–µ–π

```bash
# –ë–∞–∑–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
$ semantic queue status
üì¶ Text Queue: 45 pending, 12 submitted, 1234 completed, 3 failed
üé¨ Media Queue: 8 pending, 2 processing, 156 completed, 1 failed

# JSON –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤
$ semantic queue status --json | jq '.text.pending'
45
```

### 10.2 –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞—á

```bash
# –ü–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π –ø—Ä–æ–≤–µ—Ä—è–µ–º
$ semantic queue status

# –û—á–∏—â–∞–µ–º –≤—Å—ë –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–µ
$ semantic queue flush --status completed -y
üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ: 1390 –∑–∞–ø–∏—Å–µ–π

# –ò–ª–∏ —Ç–æ–ª—å–∫–æ failed
$ semantic queue flush --status failed -y
```

### 10.3 Retry –ø—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã—Ö

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–∫–æ–ª—å–∫–æ failed
$ semantic queue status --type text
‚ùå failed: 3

# Retry
$ semantic queue retry --type text
üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ: 3 –∑–∞–¥–∞—á–∏

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
$ semantic queue status --type text
‚è≥ pending: 3 (–±—ã–≤—à–∏–µ failed)
```

### 10.4 –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–∞

```bash
# –†–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
$ semantic worker run-once
üë∑ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 12 batch, 8 media

# –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –≤–æ—Ä–∫–µ—Ä
$ semantic worker start --batch-size 20 --poll-interval 10
üë∑ Worker –∑–∞–ø—É—â–µ–Ω (batch=20, interval=10s)
üîÑ –¶–∏–∫–ª 1: –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ 15 –∑–∞–¥–∞—á
üîÑ –¶–∏–∫–ª 2: –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ 8 –∑–∞–¥–∞—á
^C
‚ö†Ô∏è  –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
‚úÖ Worker –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
```

### 10.5 CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```bash
#!/bin/bash
# process_queue.sh

# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—á–µ—Ä–µ–¥—å (–æ–¥–∏–Ω —Ä–∞–∑)
semantic worker run-once --max-tasks 100

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
status=$(semantic queue status --json)
pending=$(echo $status | jq '.text.pending + .media.pending')

if [ $pending -gt 0 ]; then
    echo "‚ö†Ô∏è  –û—Å—Ç–∞–ª–æ—Å—å $pending –∑–∞–¥–∞—á"
    exit 1
fi

echo "‚úÖ –û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞"
```

---

## 11. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 11.1 –ü–æ—á–µ–º—É –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥?

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**

1. **Threading Event** ‚Äî overkill –¥–ª—è single-threaded CLI
2. **Class-based worker** ‚Äî —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ use case
3. **asyncio cancellation** ‚Äî Typer –Ω–µ async –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–í—ã–±–æ—Ä:** –ì–ª–æ–±–∞–ª—å–Ω—ã–π `_shutdown_requested` ‚Äî –ø—Ä–æ—Å—Ç–æ–π –∏ —Ä–∞–±–æ—Ç–∞—é—â–∏–π.

### 11.2 –ü–æ—á–µ–º—É separate commands?

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –û–¥–∏–Ω `worker` —Å –ø–æ–¥–∫–æ–º–∞–Ω–¥–∞–º–∏ inline:

```bash
semantic worker --mode once|continuous
```

**–í—ã–±–æ—Ä:** –û—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (`run-once`, `start`) ‚Äî –±–æ–ª–µ–µ explicit, –ª—É—á—à–µ help.

### 11.3 –ü–æ—á–µ–º—É interruptible sleep?

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** `time.sleep(poll_interval)` —Ü–µ–ª–∏–∫–æ–º ‚Äî –º–æ–∂–µ—Ç –∂–¥–∞—Ç—å –¥–æ 60 —Å–µ–∫—É–Ω–¥.

**–í—ã–±–æ—Ä:** –ü–æ—Å–µ–∫—É–Ω–¥–Ω—ã–π sleep —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π ‚Äî –æ—Ç–∑—ã–≤—á–∏–≤—ã–π shutdown.

---

## 12. Definition of Done

1. ‚úÖ **queue status** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ–±–µ–∏—Ö –æ—á–µ—Ä–µ–¥–µ–π
2. ‚úÖ **queue flush** ‚Äî –æ—á–∏—Å—Ç–∫–∞ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
3. ‚úÖ **queue retry** ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ failed –∑–∞–¥–∞—á
4. ‚úÖ **worker run-once** ‚Äî –æ–¥–∏–Ω —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
5. ‚úÖ **worker start** ‚Äî continuous worker —Å graceful shutdown
6. ‚úÖ **EMOJI_MAP** ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω –¥–ª—è CLI –º–æ–¥—É–ª–µ–π
7. ‚úÖ **–¢–µ—Å—Ç—ã** ‚Äî 30 unit-—Ç–µ—Å—Ç–æ–≤ (29 passed, 1 skipped)
8. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –±–∞–≥–∏** ‚Äî emoji priority, JSON output, skip decorator

---

## 13. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Phase 8.1 –¥–æ–±–∞–≤–∏–ª–∞ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–ª–æ–π –∫ CLI:

**Queue Management:**

- `status` ‚Äî –ø–æ–ª–Ω—ã–π –æ–±–∑–æ—Ä –æ—á–µ—Ä–µ–¥–µ–π
- `flush` ‚Äî –æ—á–∏—Å—Ç–∫–∞ —Å –≥—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º
- `retry` ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ failed –∑–∞–¥–∞—á

**Worker:**

- `run-once` ‚Äî –¥–ª—è cron/CI
- `start` ‚Äî –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å graceful shutdown

–í–º–µ—Å—Ç–µ —Å Phase 8.0 –∏ 8.3 —ç—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π CLI:

```bash
semantic init          # Phase 8.3
semantic config show   # Phase 8.3
semantic doctor        # Phase 8.3
semantic ingest        # Phase 8.0
semantic search        # Phase 8.0
semantic docs          # Phase 8.0
semantic queue status  # Phase 8.1
semantic worker start  # Phase 8.1
```

Semantic Core —Ç–µ–ø–µ—Ä—å –≥–æ—Ç–æ–≤ –∫ production-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —á–µ—Ä–µ–∑ CLI.
