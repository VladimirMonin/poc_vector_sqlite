–í–æ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ **–§–∞–∑—ã 1: –§—É–Ω–¥–∞–º–µ–Ω—Ç –∏ –¢–µ–∫—Å—Ç**.

–¶–µ–ª—å —ç—Ç–æ–π —Ñ–∞–∑—ã ‚Äî —Å–æ–∑–¥–∞—Ç—å **"–°–∫–µ–ª–µ—Ç"**, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–µ–∫—Å—Ç–æ–º, –±–∞–∑–æ–π –∏ –ø–æ–∏—Å–∫–æ–º, –Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —Ç–æ–º—É, —á—Ç–æ–±—ã –≤ –Ω–µ–≥–æ "–≤–ª–∏–ª–∏" –ª–æ–≥–∏–∫—É Markdown –∏ –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç–∏, –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—è –Ω–∏ —Å—Ç—Ä–æ—á–∫–∏ –≤ —è–¥—Ä–µ.

-----

### üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞ (Package Structure)

–ú—ã –¥–µ–ª–∏–º –∫–æ–¥ –Ω–∞ 4 —É—Ä–æ–≤–Ω—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: **–î–æ–º–µ–Ω** (–¥–∞–Ω–Ω—ã–µ), **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã** (–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã), **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞** (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è) –∏ **–Ø–¥—Ä–æ** (—Å–±–æ—Ä–∫–∞).

```text
semantic_core/
‚îú‚îÄ‚îÄ __init__.py                  # –≠–∫—Å–ø–æ—Ä—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–∞–±—Ä–∏–∫ (Facade)
‚îÇ
‚îú‚îÄ‚îÄ domain/                      # 1. –ß–ò–°–¢–´–ï –î–ê–ù–ù–´–ï (DTO)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ document.py              # –ö–ª–∞—Å—Å Document (–†–æ–¥–∏—Ç–µ–ª—å)
‚îÇ   ‚îú‚îÄ‚îÄ chunk.py                 # –ö–ª–∞—Å—Å Chunk (–†–µ–±–µ–Ω–æ–∫)
‚îÇ   ‚îî‚îÄ‚îÄ search_result.py         # –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–∏—Å–∫–∞
‚îÇ
‚îú‚îÄ‚îÄ interfaces/                  # 2. –ö–û–ù–¢–†–ê–ö–¢–´ (Abstract Base Classes)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ embedder.py              # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è AI-–º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ vector_store.py          # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ splitter.py              # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –Ω–∞—Ä–µ–∑–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ context.py               # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–±–æ—Ä–∫–∏ "—É–º–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"
‚îÇ
‚îú‚îÄ‚îÄ infrastructure/              # 3. –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø (–ê–¥–∞–ø—Ç–µ—Ä—ã)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ gemini/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ embedder.py          # –ê–¥–∞–ø—Ç–µ—Ä –∫ Google API
‚îÇ   ‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ peewee_engine.py     # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SQLite + Vec0 + FTS5
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ peewee_store.py      # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è VectorStore —á–µ—Ä–µ–∑ Peewee
‚îÇ   ‚îî‚îÄ‚îÄ text_processing/
‚îÇ       ‚îú‚îÄ‚îÄ simple_splitter.py   # –¢—É–ø–∞—è –Ω–∞—Ä–µ–∑–∫–∞ (–∫–∞–∫ —Å–µ–π—á–∞—Å)
‚îÇ       ‚îî‚îÄ‚îÄ basic_context.py     # –ü—Ä–æ—Å—Ç–∞—è —Å–∫–ª–µ–π–∫–∞ (–ó–∞–≥–æ–ª–æ–≤–æ–∫ + –ß–∞–Ω–∫)
‚îÇ
‚îî‚îÄ‚îÄ pipeline.py                  # 4. –î–ò–†–ò–ñ–ï–† (Ingestion & Search Pipeline)
```

-----

### üß† 1. –£—Ä–æ–≤–µ–Ω—å –î–æ–º–µ–Ω–∞ (Domain Layer)

*–ó–¥–µ—Å—å –∂–∏–≤—É—Ç "–≥–ª—É–ø—ã–µ" –æ–±—ä–µ–∫—Ç—ã –¥–∞–Ω–Ω—ã—Ö. –û–Ω–∏ –Ω–µ –∑–Ω–∞—é—Ç –Ω–∏ –ø—Ä–æ –ë–î, –Ω–∏ –ø—Ä–æ Google.*

* **`Document` (DTO):**
  * –ü–æ–ª—è: `id` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ), `content` (–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç), `metadata` (—Å–ª–æ–≤–∞—Ä—å: url, title, author), `media_type` (Enum: TEXT, IMAGE, VIDEO ‚Äî *–∑–∞–∫–ª–∞–¥—ã–≤–∞–µ–º —Å—Ä–∞–∑—É*).
  * –õ–æ–≥–∏–∫–∞: –•—Ä–∞–Ω–∏—Ç –∏—Å—Ö–æ–¥–Ω–∏–∫.
* **`Chunk` (DTO):**
  * –ü–æ–ª—è: `content`, `embedding` (—Å–ø–∏—Å–æ–∫ float), `chunk_index`, `metadata` (—Å–ª–æ–≤–∞—Ä—å: —Ç–∞–π–º–∫–æ–¥—ã, –∑–∞–≥–æ–ª–æ–≤–∫–∏), `parent_doc_id`.
  * –õ–æ–≥–∏–∫–∞: –ï–¥–∏–Ω–∏—Ü–∞ –ø–æ–∏—Å–∫–∞.
* **`SearchResult` (DTO):**
  * –ü–æ–ª—è: `document` (–æ–±—ä–µ–∫—Ç Document), `score` (—á–∏—Å–ª–æ), `match_type` (Enum: VECTOR, FTS, HYBRID).
  * *–ó–∞—á–µ–º:* –ß—Ç–æ–±—ã –≤–Ω–µ—à–Ω–∏–π –∫–æ–¥ –Ω–µ –∑–∞–≤–∏—Å–µ–ª –æ—Ç –º–æ–¥–µ–ª–µ–π Peewee.

-----

### üìù 2. –£—Ä–æ–≤–µ–Ω—å –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (Interfaces Layer)

*–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ. –≠—Ç–æ "–ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏—è" —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞. –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ –ø–æ–¥—á–∏–Ω—è—é—Ç—Å—è —ç—Ç–∏–º –ø—Ä–∞–≤–∏–ª–∞–º.*

* **`BaseEmbedder` (ABC):**
  * –ú–µ—Ç–æ–¥ `embed_documents(texts: List[str]) -> List[Vector]`. (–î–ª—è –±–∞–∑—ã).
  * –ú–µ—Ç–æ–¥ `embed_query(text: str) -> Vector`. (–î–ª—è –ø–æ–∏—Å–∫–∞ ‚Äî *–∞—Å–∏–º–º–µ—Ç—Ä–∏—è*).
* **`BaseVectorStore` (ABC):**
  * –ú–µ—Ç–æ–¥ `save(document: Document, chunks: List[Chunk])`. (–ê—Ç–æ–º–∞—Ä–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ).
  * –ú–µ—Ç–æ–¥ `search(query_vec, query_text, filters, limit) -> List[SearchResult]`. (–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫).
  * –ú–µ—Ç–æ–¥ `delete(document_id)`.
* **`BaseSplitter` (ABC):**
  * –ú–µ—Ç–æ–¥ `split(document: Document) -> List[Chunk]`. (–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫—É—Å–∫–∏ –±–µ–∑ –≤–µ–∫—Ç–æ—Ä–æ–≤).
* **`BaseContextStrategy` (ABC):**
  * –ú–µ—Ç–æ–¥ `form_vector_text(chunk: Chunk, document: Document) -> str`. (–†–µ—à–∞–µ—Ç, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –º—ã —Å–∫–∞—Ä–º–ª–∏–≤–∞–µ–º –Ω–µ–π—Ä–æ–Ω–∫–µ: –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç –∏–ª–∏ —Ç–µ–∫—Å—Ç + —Ç–µ–≥–∏).

-----

### ‚öôÔ∏è 3. –£—Ä–æ–≤–µ–Ω—å –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (Infrastructure Layer)

*–ó–¥–µ—Å—å "–≥—Ä—è–∑–Ω—ã–π" –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É.*

* **`GeminiEmbedder` (Realization):**
  * –†–µ–∞–ª–∏–∑—É–µ—Ç `BaseEmbedder`.
  * –í–Ω—É—Ç—Ä–∏: –≤—ã–∑–æ–≤ `google.generativeai`.
  * –õ–æ–≥–∏–∫–∞: MRL (–æ–±—Ä–µ–∑–∫–∞ –≤–µ–∫—Ç–æ—Ä–∞), –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –¥–ª–∏–Ω—É), –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏ (Retry).
* **`PeeweeVectorStore` (Realization):**
  * –†–µ–∞–ª–∏–∑—É–µ—Ç `BaseVectorStore`.
  * –í–Ω—É—Ç—Ä–∏: `sqlite-vec` + `fts5`.
  * –õ–æ–≥–∏–∫–∞:
    * –°–∫—Ä—ã–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è –º–æ–¥–µ–ª–∏ Peewee (`NoteModel`, `ChunkModel`).
    * –í –º–µ—Ç–æ–¥–µ `search` —Å—Ç—Ä–æ–∏—Ç —Ç–æ—Ç —Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π SQL —Å CTE –∏ RRF —Ñ–æ—Ä–º—É–ª–æ–π.
    * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ –ë–î –≤ —á–∏—Å—Ç—ã–µ `SearchResult`.
* **`SimpleSplitter` (Realization):**
  * –†–µ–∞–ª–∏–∑—É–µ—Ç `BaseSplitter`.
  * –õ–æ–≥–∏–∫–∞: –¢–≤–æ–π —Ç–µ–∫—É—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å `chunk_size`, `overlap` –∏ –ø–æ–∏—Å–∫–æ–º `\n`.

-----

### üéº 4. –£—Ä–æ–≤–µ–Ω—å –ü–∞–π–ø–ª–∞–π–Ω–∞ (Orchestrator)

*–≠—Ç–æ "–ü—É–ª—å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è", –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –±—É–¥–µ—à—å –≤—ã–∑—ã–≤–∞—Ç—å –≤ —Å–≤–æ–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö.*

–°–æ–∑–¥–∞–µ–º –∫–ª–∞—Å—Å **`SemanticCore`** (–§–∞—Å–∞–¥).

**–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (`__init__`):**
–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (Dependency Injection).

* *–ü—Ä–∏–º–µ—Ä:* `core = SemanticCore(embedder=Gemini(...), store=PeeweeStore(...))`

**–ú–µ—Ç–æ–¥ `ingest(document: Document)`:**

1. **Split:** –í—ã–∑—ã–≤–∞–µ—Ç `splitter.split(document)` -\> –ø–æ–ª—É—á–∞–µ—Ç —Å—ã—Ä—ã–µ —á–∞–Ω–∫–∏.
2. **Context:** –ü—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ —á–∞–Ω–∫–∞–º –∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–∑—ã–≤–∞–µ—Ç `context_strategy.form_vector_text()`. (–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫).
3. **Embed:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –≤ `embedder.embed_documents()`.
4. **Pack:** –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –≤–µ–∫—Ç–æ—Ä–∞ –æ–±—Ä–∞—Ç–Ω–æ –≤ –æ–±—ä–µ–∫—Ç—ã —á–∞–Ω–∫–æ–≤.
5. **Store:** –í—ã–∑—ã–≤–∞–µ—Ç `store.save(document, chunks)`.

**–ú–µ—Ç–æ–¥ `search(query: str, filters: dict)`:**

1. **Embed:** –í—ã–∑—ã–≤–∞–µ—Ç `embedder.embed_query(query)`.
2. **Retrieve:** –í—ã–∑—ã–≤–∞–µ—Ç `store.search(vector, query, filters)`.
3. **Return:** –û—Ç–¥–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

-----

### üõ°Ô∏è –ü–æ—á–µ–º—É —ç—Ç–æ SOLID?

1. **SRP (–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å):** –°–ø–ª–∏—Ç—Ç–µ—Ä —Ç–æ–ª—å–∫–æ —Ä–µ–∂–µ—Ç. –≠–º–±–µ–¥–¥–µ—Ä —Ç–æ–ª—å–∫–æ –≤–µ–∫—Ç–æ—Ä–∏–∑—É–µ—Ç. –ë–∞–∑–∞ —Ç–æ–ª—å–∫–æ —Ö—Ä–∞–Ω–∏—Ç. –ü–∞–π–ø–ª–∞–π–Ω —Ç–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥—É–µ—Ç.
2. **OCP (–û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å/–ó–∞–∫—Ä—ã—Ç–æ—Å—Ç—å):** –•–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å Markdown? –¢—ã –ø–∏—à–µ—à—å *–Ω–æ–≤—ã–π* –∫–ª–∞—Å—Å `MarkdownSplitter` –≤ –ø–∞–ø–∫–µ `infrastructure`, –Ω–µ –º–µ–Ω—è—è –Ω–∏ —Å—Ç—Ä–æ—á–∫–∏ –≤ `pipeline.py` –∏–ª–∏ `vector_store.py`.
3. **LSP (–ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ë–∞—Ä–±–∞—Ä—ã –õ–∏—Å–∫–æ–≤):** –õ—é–±–æ–π —Å–ø–ª–∏—Ç—Ç–µ—Ä (—Ö–æ—Ç—å –¥–ª—è –≤–∏–¥–µ–æ) –≤–µ–¥–µ—Ç —Å–µ–±—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ –¥–ª—è –ü–∞–π–ø–ª–∞–π–Ω–∞: "–¥–∞–π –º–Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç, –Ω–∞ —Ç–µ–±–µ —á–∞–Ω–∫–∏".
4. **ISP (–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤):** –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –º–∞–ª–µ–Ω—å–∫–∏–µ –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ.
5. **DIP (–ò–Ω–≤–µ—Ä—Å–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π):** –ü–∞–π–ø–ª–∞–π–Ω –∑–∞–≤–∏—Å–∏—Ç –æ—Ç *–∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π* (Interfaces), –∞ –Ω–µ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ (Infrastructure).

### ‚úÖ –ò—Ç–æ–≥ –§–∞–∑—ã 1

–ù–∞ –≤—ã—Ö–æ–¥–µ —É —Ç–µ–±—è –±—É–¥–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∞, –∫–æ—Ç–æ—Ä—É—é —Ç—ã –ø–æ–¥–∫–ª—é—á–∞–µ—à—å —Ç–∞–∫:

```python
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (–ì–¥–µ-—Ç–æ –≤ config.py)
db = PeeweeVectorStore("my_base.db")
ai = GeminiEmbedder(api_key="...")
splitter = SimpleSplitter()
strategy = BasicContextStrategy()

# –°–±–æ—Ä–∫–∞ —è–¥—Ä–∞
kernel = SemanticCore(db, ai, splitter, strategy)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
doc = Document(content="–ü—Ä–∏–≤–µ—Ç –º–∏—Ä", metadata={"title": "Test"})
kernel.ingest(doc)

results = kernel.search("–º–∏—Ä")
```

–≠—Ç–æ **–∏–¥–µ–∞–ª—å–Ω—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç**. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —É–∂–µ —Å–µ–π—á–∞—Å (—Å —Ç–µ–∫—Å—Ç–æ–º), –Ω–æ –≤ `Document` —É–∂–µ –µ—Å—Ç—å –ø–æ–ª–µ `media_type`, –∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö –µ—Å—Ç—å –º–µ—Å—Ç–æ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.
