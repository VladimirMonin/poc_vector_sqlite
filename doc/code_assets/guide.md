

# üì¶ Legacy Code Reference (Donors)

**–í–ù–ò–ú–ê–ù–ò–ï –ê–ì–ï–ù–¢–£:**
–≠—Ç–æ—Ç –∫–æ–¥ –≤–∑—è—Ç –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞. **–ù–ï –ò–ú–ü–û–†–¢–ò–†–£–ô–¢–ï** —ç—Ç–∏ —Ñ–∞–π–ª—ã –Ω–∞–ø—Ä—è–º—É—é –≤ `semantic_core`.
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ö –∫–∞–∫ **–∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏**, –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∏ –ø—Ä–æ–º–ø—Ç–æ–≤.

–ö–æ–¥ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É `semantic_core` (SOLID, Peewee, Dependency Injection).

---

## üìÇ –ú–∞–ø–ø–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ (–ß—Ç–æ –∏ –ö—É–¥–∞ –±—Ä–∞—Ç—å)

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤-–¥–æ–Ω–æ—Ä–æ–≤ –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≤ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ.

### üîπ –ì—Ä—É–ø–ø–∞ 1: –ë–∞—Ç—á–∏–Ω–≥ –∏ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å (–î–ª—è Phase 5)

–≠—Ç–∏ —Ñ–∞–π–ª—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å –æ—á–µ—Ä–µ–¥—è–º–∏ –∏ Google Batch API.

| –§–∞–π–ª-–¥–æ–Ω–æ—Ä | –ö—É–¥–∞ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –ª–æ–≥–∏–∫—É | –ó–∞—á–µ–º –Ω—É–∂–µ–Ω / –ß—Ç–æ –±—Ä–∞—Ç—å |
| :--- | :--- | :--- |
| `batch_processor.py` | `infrastructure/google/batching.py` | –õ–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è JSONL, –∑–∞–≥—Ä—É–∑–∫–∞ –≤ Cloud, –ø–æ–ª–ª–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞. **–í–∞–∂–Ω–æ:** –ó–∞–º–µ–Ω–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–∞—Ä—Ç–∏–Ω–æ–∫ –Ω–∞ `embedContent`. |
| `manager.py` | `core/batch_manager.py` | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–æ—Ä–∫–µ—Ä–∞: —Ü–∏–∫–ª `submit` -> `poll` -> `retrieve`. –õ–æ–≥–∏–∫–∞ `health_check`. |
| `queue_processor.py` | `core/batch_manager.py` | –õ–æ–≥–∏–∫–∞ **Local Queue** (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ –æ–¥–Ω–æ–º—É —Å Rate Limit). –ü—Ä–∏–≥–æ–¥–∏—Ç—Å—è –¥–ª—è –º–µ–¥–∏–∞ –≤ Phase 6. |

### üîπ –ì—Ä—É–ø–ø–∞ 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ú–µ–¥–∏–∞ (–î–ª—è Phase 6)

–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–∞ —Ñ–∞–π–ª–æ–≤ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ Gemini.

| –§–∞–π–ª-–¥–æ–Ω–æ—Ä | –ö—É–¥–∞ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –ª–æ–≥–∏–∫—É | –ó–∞—á–µ–º –Ω—É–∂–µ–Ω / –ß—Ç–æ –±—Ä–∞—Ç—å |
| :--- | :--- | :--- |
| `image_tokens.py` | `infrastructure/media/utils/tokens.py` | –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥—Å—á–µ—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ (—Ä–µ—Å–∞–π–∑, —Ç–∞–π–ª–∏–Ω–≥). –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –±—é–¥–∂–µ—Ç–∞. |
| `audio_extractor.py` | `infrastructure/media/utils/audio.py` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `pydub`/`ffmpeg` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞—É–¥–∏–æ –∏–∑ –≤–∏–¥–µ–æ –∏ —Å–∂–∞—Ç–∏—è. |
| `media_frame_extractor.py` | `infrastructure/media/utils/video.py` | –õ–æ–≥–∏–∫–∞ —É–º–Ω–æ–π –Ω–∞—Ä–µ–∑–∫–∏ –≤–∏–¥–µ–æ –Ω–∞ –∫–∞–¥—Ä—ã (FPS/Interval modes). |
| `gif_processor.py` | `infrastructure/media/utils/gif.py` | –û–±—Ä–∞–±–æ—Ç–∫–∞ GIF-–∞–Ω–∏–º–∞—Ü–∏–π (—Ä–∞–∑–±–∏–≤–∫–∞ –Ω–∞ –∫–∞–¥—Ä—ã). |
| `file_utils.py` | `infrastructure/media/utils/files.py` | –í–∞–ª–∏–¥–∞—Ü–∏—è MIME-—Ç–∏–ø–æ–≤ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤. |

### üîπ –ì—Ä—É–ø–ø–∞ 3: AI –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã –∏ –ü—Ä–æ–º–ø—Ç—ã (–î–ª—è Phase 6)

–õ–æ–≥–∏–∫–∞ –æ–±—â–µ–Ω–∏—è —Å Gemini API –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

| –§–∞–π–ª-–¥–æ–Ω–æ—Ä | –ö—É–¥–∞ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –ª–æ–≥–∏–∫—É | –ó–∞—á–µ–º –Ω—É–∂–µ–Ω / –ß—Ç–æ –±—Ä–∞—Ç—å |
| :--- | :--- | :--- |
| `video_analyzer.py` | `infrastructure/google/vision.py` | **–°–∞–º—ã–π –≤–∞–∂–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –≤–∏–¥–µ–æ.** –õ–æ–≥–∏–∫–∞ —Å–±–æ—Ä–∫–∏ –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–¢–µ–∫—Å—Ç + –ö–∞–¥—Ä—ã + –ê—É–¥–∏–æ). –ö–æ–Ω—Ç—Ä–æ–ª—å –ª–∏–º–∏—Ç–æ–≤ —Ä–∞–∑–º–µ—Ä–∞. |
| `image_analyzer.py` | `infrastructure/google/vision.py` | –õ–æ–≥–∏–∫–∞ –≤—ã–∑–æ–≤–∞ Gemini Vision –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫. |
| `audio_analyzer.py` | `infrastructure/google/vision.py` | –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞—É–¥–∏–æ-—Ñ–∞–π–ª–æ–≤. |
| `gemini_client.py` | `infrastructure/google/client.py` | –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `generation_config`, `safety_settings`. **–ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –Ω–æ–≤—ã–π –∫–æ–Ω—Ñ–∏–≥!** |
| `analysis.py` | `domain/media.py` | Pydantic-—Å—Ö–µ–º—ã –æ—Ç–≤–µ—Ç–æ–≤ (`VideoAnalysisResponse`, `ImageAnalysisResponse`). –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è Structured Output. |

---

## üõ† –ü—Ä–∞–≤–∏–ª–∞ –ê–¥–∞–ø—Ç–∞—Ü–∏–∏ (Migration Rules)

–ü—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ –∫–æ–¥–∞ —Å–æ–±–ª—é–¥–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞:

1.  **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
    * ‚ùå –£–î–ê–õ–ò–¢–¨: –ò–º–ø–æ—Ä—Ç—ã –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ `config.py` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `GEMINI_API_KEY`).
    * ‚úÖ –í–ù–ï–î–†–ò–¢–¨: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `self.config` (–∫–ª–∞—Å—Å `GeminiConfig`), –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–π —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä.

2.  **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
    * ‚ùå –£–î–ê–õ–ò–¢–¨: –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ª–æ–≥–≥–µ—Ä—ã –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.

3.  **–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö:**
    * ‚ùå –£–î–ê–õ–ò–¢–¨: –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã —Å—Ç–∞—Ä–æ–π –ë–î.
    * ‚úÖ –í–ù–ï–î–†–ò–¢–¨: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –Ω–∞—à–µ–≥–æ `PeeweeVectorStore` –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å DTO.

4.  **–ú–æ–¥–µ–ª–∏:**
    * –ó–∞–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –º–æ–¥–µ–ª–∏ Pydantic –Ω–∞ –Ω–∞—à–∏ DTO –∏–∑ `semantic_core.domain`.
    * –°—Ö–µ–º—ã –¥–ª—è `response_schema` (–∏–∑ `analysis.py`) –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å Pydantic, –Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ `domain`.

5.  **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
    * –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `Pillow`, `pydub`, `imageio` –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `pyproject.toml` –∫–∞–∫ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`extras = ["media"]`).

---

**–ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø:** –ë–µ—Ä–∏—Ç–µ *–∞–ª–≥–æ—Ä–∏—Ç–º—ã* (–∫–∞–∫ —Ä–µ–∑–∞—Ç—å –≤–∏–¥–µ–æ, –∫–∞–∫ —Å—á–∏—Ç–∞—Ç—å —Ç–æ–∫–µ–Ω—ã, –∫–∞–∫ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç), –Ω–æ –≤—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ –∏—Ö –≤ *–Ω–∞—à—É* –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∫–ª–∞—Å—Å–æ–≤.
```