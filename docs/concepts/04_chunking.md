---
title: "Chunking: —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–∞—Ä–µ–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤"
description: "–ö–∞–∫ —Ä–∞–∑–±–∏–≤–∞—Ç—å –±–æ–ª—å—à–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–∞ —á–∞–Ω–∫–∏ –¥–ª—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"
tags: [chunking, splitting, tokens, overlap, smart-parsing]
difficulty: beginner
related: [01_embeddings, 05_smart_parsing]
---

## –ß—Ç–æ —ç—Ç–æ üìå

**Chunking** ‚Äî —Ä–∞–∑–±–∏–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã (—á–∞–Ω–∫–∏) –¥–ª—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ö–∞–∂–¥—ã–π —á–∞–Ω–∫ –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π –≤–µ–∫—Ç–æ—Ä –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.

| –¢–µ—Ä–º–∏–Ω | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| Chunk | –§—Ä–∞–≥–º–µ–Ω—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞ (~500-2000 —Å–∏–º–≤–æ–ª–æ–≤) |
| Overlap | –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –º–µ–∂–¥—É —Å–æ—Å–µ–¥–Ω–∏–º–∏ —á–∞–Ω–∫–∞–º–∏ |
| ChunkType | –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (TEXT, CODE, IMAGE_REF...) |

---

## –ó–∞—á–µ–º –Ω—É–∂–Ω–æ üéØ

**–ü—Ä–æ–±–ª–µ–º–∞**: Gemini embedding API –æ–≥—Ä–∞–Ω–∏—á–µ–Ω ~2000 —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –∑–∞–ø—Ä–æ—Å.

| –Ø–∑—ã–∫ | ~–¢–æ–∫–µ–Ω–æ–≤ | ~–°–∏–º–≤–æ–ª–æ–≤ |
|------|----------|-----------|
| –ê–Ω–≥–ª–∏–π—Å–∫–∏–π | 2000 | 6000-8000 |
| –†—É—Å—Å–∫–∏–π | 2000 | 4000-5000 |
| –ö–æ–¥ Python | 2000 | 5000-7000 |

**–†–µ—à–µ–Ω–∏–µ**: –†–µ–∂–µ–º –¥–æ–∫—É–º–µ–Ω—Ç ‚Üí –≤–µ–∫—Ç–æ—Ä–∏–∑—É–µ–º –∫–∞–∂–¥—ã–π —á–∞–Ω–∫ ‚Üí –∏—â–µ–º –ø–æ —á–∞–Ω–∫–∞–º.

```plantuml
@startuml
title Chunking –±–æ–ª—å—à–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞

rectangle "–î–æ–∫—É–º–µ–Ω—Ç 9000 —Å–∏–º–≤–æ–ª–æ–≤" as doc

rectangle "Chunk 0\n1000 —Å–∏–º–≤–æ–ª–æ–≤" as c0
rectangle "Chunk 1\n1000 —Å–∏–º–≤–æ–ª–æ–≤" as c1
rectangle "Chunk 2\n1000 —Å–∏–º–≤–æ–ª–æ–≤" as c2
rectangle "..." as dots
rectangle "Chunk 8\n1000 —Å–∏–º–≤–æ–ª–æ–≤" as c8

doc --> c0
doc --> c1
doc --> c2
doc --> dots
doc --> c8

c0 --> [Vector 0]
c1 --> [Vector 1]
c2 --> [Vector 2]
c8 --> [Vector 8]

note bottom of c1
  overlap = 200 —Å–∏–º–≤–æ–ª–æ–≤
  –º–µ–∂–¥—É —Å–æ—Å–µ–¥–Ω–∏–º–∏ —á–∞–Ω–∫–∞–º–∏
end note
@enduml
```

---

## ChunkType: —Ç–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ‚öôÔ∏è

```python
class ChunkType(str, Enum):
    TEXT = "text"       # –û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
    CODE = "code"       # –ë–ª–æ–∫ –∫–æ–¥–∞
    TABLE = "table"     # –¢–∞–±–ª–∏—Ü–∞
    IMAGE_REF = "image_ref"   # –°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    AUDIO_REF = "audio_ref"   # –°—Å—ã–ª–∫–∞ –Ω–∞ –∞—É–¥–∏–æ
    VIDEO_REF = "video_ref"   # –°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ
```

| ChunkType | –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è | Metadata |
|-----------|-----------------|----------|
| TEXT | –û–±—ã—á–Ω—ã–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã | headers (breadcrumbs) |
| CODE | \`\`\`python...\`\`\` | language, headers |
| TABLE | Markdown —Ç–∞–±–ª–∏—Ü—ã | headers |
| IMAGE_REF | `![alt](path.png)` | src, alt, headers |
| AUDIO_REF | `[audio](file.mp3)` | src, headers |
| VIDEO_REF | `[video](file.mp4)` | src, headers |

---

## –î–≤–∞ —Å–ø–ª–∏—Ç—Ç–µ—Ä–∞ üîç

### SimpleSplitter (legacy)

–†–µ–∂–µ—Ç –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–∏–º–≤–æ–ª–æ–≤ —Å –ø–æ–∏—Å–∫–æ–º –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫–∏:

```python
SimpleSplitter(
    chunk_size=1000,   # –¶–µ–ª–µ–≤–æ–π —Ä–∞–∑–º–µ—Ä
    overlap=200,       # –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ
    threshold=100      # –û–∫–Ω–æ –ø–æ–∏—Å–∫–∞ \n
)
```

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:
- ‚ùå –ú–æ–∂–µ—Ç —Ä–∞–∑—Ä–µ–∑–∞—Ç—å –∫–æ–¥ –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ
- ‚ùå –ù–µ –ø–æ–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É Markdown
- ‚ùå –¢–µ—Ä—è–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏—é –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

### SmartSplitter (recommended)

–†–∞–±–æ—Ç–∞–µ—Ç —Å AST —á–µ—Ä–µ–∑ `MarkdownNodeParser`:

```python
SmartSplitter(
    parser=MarkdownNodeParser(),
    chunk_size=1000,
    code_chunk_size=2000,
    preserve_code=True,  # –ù–µ —Ä–µ–∑–∞—Ç—å –∫–æ–¥
)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ò–∑–æ–ª–∏—Ä—É–µ—Ç –±–ª–æ–∫–∏ –∫–æ–¥–∞
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç breadcrumbs (–∑–∞–≥–æ–ª–æ–≤–∫–∏)
- ‚úÖ –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –º–µ–ª–∫–∏–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã
- ‚úÖ –¢–∏–ø–∏–∑–∏—Ä—É–µ—Ç —á–∞–Ω–∫–∏ (TEXT/CODE/IMAGE_REF)

---

## Overlap: –∑–∞—á–µ–º –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ üí°

**–ë–µ–∑ overlap**: —Ç–µ—Ä—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö.

```
Chunk 1: "Python ‚Äî —ç—Ç–æ —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä"
Chunk 2: "–∞–Ω–∏—è. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è..."
         ‚ùå –ü–æ—Ç–µ—Ä—è–ª–∏ —Å–≤—è–∑—å!
```

**–° overlap=200**:

```
Chunk 1: "Python ‚Äî —ç—Ç–æ —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è. –û–Ω"
Chunk 2:                  "–∏—Ä–æ–≤–∞–Ω–∏—è. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è..."
                          ‚Üë –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ
         ‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω!
```

**–ü—Ä–∞–≤–∏–ª–æ**: `overlap ‚âà 20% –æ—Ç chunk_size`

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ø–ª–∏—Ç—Ç–µ—Ä–∞ ‚öôÔ∏è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Default | –ö–æ–≥–¥–∞ –º–µ–Ω—è—Ç—å |
|----------|---------|--------------|
| chunk_size | 1000 | –ë–æ–ª—å—à–µ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π |
| overlap | 200 | –ú–µ–Ω—å—à–µ –¥–ª—è –∫–æ–¥–∞ (–º–µ–Ω—å—à–µ –¥—É–±–ª–µ–π) |
| code_chunk_size | 2000 | –î–ª–∏–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ |
| preserve_code | True | False –µ—Å–ª–∏ –∫–æ–¥ –Ω–µ –≤–∞–∂–µ–Ω |

### –ü—Ä–µ—Å–µ—Ç—ã

```python
# –ö–æ—Ä–æ—Ç–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏
SmartSplitter(parser, chunk_size=500, overlap=100)

# –°—Ç–∞—Ç—å–∏ (default)
SmartSplitter(parser, chunk_size=1000, overlap=200)

# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
SmartSplitter(parser, chunk_size=1500, overlap=300)
```

---

## Metadata —á–∞–Ω–∫–æ–≤ üìä

–ö–∞–∂–¥—ã–π —á–∞–Ω–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:

```python
@dataclass
class Chunk:
    content: str           # –¢–µ–∫—Å—Ç
    chunk_index: int       # 0, 1, 2...
    chunk_type: ChunkType  # TEXT/CODE/...
    language: str | None   # "python", "sql"...
    embedding: np.ndarray  # –í–µ–∫—Ç–æ—Ä (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∑–∂–µ)
    parent_doc_id: int     # ID –¥–æ–∫—É–º–µ–Ω—Ç–∞
    metadata: dict         # headers, start_line, end_line
```

**–ü—Ä–∏–º–µ—Ä metadata**:

```json
{
  "headers": ["Installation", "Requirements"],
  "start_line": 15,
  "end_line": 42
}
```

---

## –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å BaseSplitter üìã

```python
class BaseSplitter(ABC):
    @abstractmethod
    def split(self, document: Document) -> list[Chunk]:
        """–†–∞–∑–±–∏–≤–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ —á–∞–Ω–∫–∏ –ë–ï–ó –≤–µ–∫—Ç–æ—Ä–æ–≤."""
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: `SimpleSplitter`, `SmartSplitter`

---

## –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã ‚ö†Ô∏è

| –ù—é–∞–Ω—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| –ß–∞–Ω–∫–∏ –±–µ–∑ –≤–µ–∫—Ç–æ—Ä–æ–≤ | `split()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∞–Ω–∫–∏ —Å `embedding=None` |
| –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ | `embedder.embed_documents()` –∑–∞–ø–æ–ª–Ω—è–µ—Ç –≤–µ–∫—Ç–æ—Ä—ã |
| –ù–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å | overlap —Å–æ–∑–¥–∞—ë—Ç –¥—É–±–ª–∏ —Ç–µ–∫—Å—Ç–∞ ‚Üí –±–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤ |
| Metadata –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è | headers –∏–∑ –ø–∞—Ä—Å–µ—Ä–∞ ‚Üí –≤ —á–∞–Ω–∫ |

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ–º—ã üîó

- [–≠–º–±–µ–¥–¥–∏–Ω–≥–∏](01_embeddings.md) ‚Äî –∫–∞–∫ —á–∞–Ω–∫–∏ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –≤–µ–∫—Ç–æ—Ä—ã
- [Smart Parsing](05_smart_parsing.md) ‚Äî AST-–ø–∞—Ä—Å–∏–Ω–≥ Markdown
- [–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫](03_hybrid_rrf.md) ‚Äî –ø–æ–∏—Å–∫ –ø–æ —á–∞–Ω–∫–∞–º
- [Chunk Types Reference](../reference/chunk-types.md) ‚Äî –ø–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ç–∏–ø–æ–≤
